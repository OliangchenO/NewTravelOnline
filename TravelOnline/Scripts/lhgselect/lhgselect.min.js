/*!
 * lhgcore Linkage Select Plugin v1.0.0
 * Date : 2011-06-13 09:35:11
 * Copyright (c) 2009 - 2011 By Li Hui Gang
 * 修改自ZhouFan的通用JavaScript联动下拉菜单 http://www.raychou.com/chou/
 */
(function(a){a.fn.select=function(b){var c=new a.select(b);c.bindSel(this)},a.select=function(b){var c=this,d=[],e,f,g,h={data:{},value:"",root:"0",file:null,ajax:null,field_name:null,auto:!1,headTxt:""},i=function(b,c){var e=d.length?d[d.length-1].key+","+d[d.length-1].value:h.root;d.push({element:b,key:e,value:f[c]||""}),b.cusHeadOpt=g[c]||"\u8bf7\u9009\u62e9";for(var l=0,m=d.length;l<m;l++)l<c&&a(d[l].element).bind("change",function(){j(b)});c>0&&a(d[c-1].element).bind("change",function(){j(b,d[c].key)}),a(b).bind("change",function(){var b=d[c-1]?d[c].key+","+a(this).val():"0,"+a(this).val();typeof d[c+1]!="undefined"&&(d[c+1].key=b),h.field_name&&a(h.field_name).val(a(this).val()),h.auto&&typeof d[c+1]=="undefined"&&k(b,function(b,e){if(e){var f=a("<select></select>")[0];a(this).after(f),i(f,c+1),j(d[c+1].element,b,e)}})}),j(b,e,f[c])},j=function(b,c,d){a(b).empty().append('<option value="">'+b.cusHeadOpt+"</option>");var e=k(c,function(){j(b,c,d,g)});if(!e){h.auto&&(b.style.display="none");return!1}b.style.display="";var f=1,i=0;for(var l in e){var m=e[l],n="";l===d&&(i=f,n='selected="selected"');var o=a('<option value="'+l+'" '+n+">"+m+"</option>")[0];b.appendChild(o),f++}var p=setTimeout(function(){b.options[i].selected=!0,clearTimeout(p)},0);b.selectedIndex=0,a(b).attr("selectedIndex",i)},k=function(b,c){if(typeof b=="undefined")return null;if(b[b.length-1]===",")return null;if(typeof e[b]=="undefined"){var d=0;for(var f in e){d++;break}h.file&&d===0?a.ajax({type:"GET",url:h.file,success:function(a){e=a,c(b,a)},dataType:"json"}):h.ajax&&a.ajax({type:"GET",url:h.ajax,data:{key:b},success:function(a){e[b]=a,c(b,a)},dataType:"json"})}return e[b]};a.extend(h,b||{}),e=h.data,g=h.headTxt.split(","),f=h.value.split(","),c.bindSel=function(b){typeof b=="string"&&(b=a(b));for(var c=0,d=b.length;c<d;c++)b[c].cusIndex=c,i(b[c],b[c].cusIndex)}}})(window.lhgcore||window.jQuery);