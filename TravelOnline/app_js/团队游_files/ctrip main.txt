function is_weixin() {
    var e = navigator.userAgent.toLowerCase();
    return e.match(/MicroMessenger/i) == "micromessenger" ? !0 : !1
}
define("text", ["module"],
function(e) {
    var t, n, r, i, s = ["Msxml2.XMLHTTP", "Microsoft.XMLHTTP", "Msxml2.XMLHTTP.4.0"],
    o = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
    u = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
    a = typeof location != "undefined" && location.href,
    f = a && location.protocol && location.protocol.replace(/\:/, ""),
    l = a && location.hostname,
    c = a && (location.port || undefined),
    h = [],
    p = e.config && e.config() || {};
    t = {
        version: "2.0.5+",
        strip: function(e) {
            if (e) {
                e = e.replace(o, "");
                var t = e.match(u);
                t && (e = t[1])
            } else e = "";
            return e
        },
        jsEscape: function(e) {
            return e.replace(/(['\\])/g, "\\$1").replace(/[\f]/g, "\\f").replace(/[\b]/g, "\\b").replace(/[\n]/g, "\\n").replace(/[\t]/g, "\\t").replace(/[\r]/g, "\\r").replace(/[\u2028]/g, "\\u2028").replace(/[\u2029]/g, "\\u2029")
        },
        createXhr: p.createXhr ||
        function() {
            var e, t, n;
            if (typeof XMLHttpRequest != "undefined") return new XMLHttpRequest;
            if (typeof ActiveXObject != "undefined") for (t = 0; t < 3; t += 1) {
                n = s[t];
                try {
                    e = new ActiveXObject(n)
                } catch(r) {}
                if (e) {
                    s = [n];
                    break
                }
            }
            return e
        },
        parseName: function(e) {
            var t, n, r, i = !1,
            s = e.indexOf("."),
            o = e.indexOf("./") === 0 || e.indexOf("../") === 0;
            return s !== -1 && (!o || s > 1) ? (t = e.substring(0, s), n = e.substring(s + 1, e.length)) : t = e,
            r = n || t,
            s = r.indexOf("!"),
            s !== -1 && (i = r.substring(s + 1) === "strip", r = r.substring(0, s), n ? n = r: t = r),
            {
                moduleName: t,
                ext: n,
                strip: i
            }
        },
        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
        useXhr: function(e, n, r, i) {
            var s, o, u, a = t.xdRegExp.exec(e);
            return a ? (s = a[2], o = a[3], o = o.split(":"), u = o[1], o = o[0], (!s || s === n) && (!o || o.toLowerCase() === r.toLowerCase()) && (!u && !o || u === i)) : !0
        },
        finishLoad: function(e, n, r, i) {
            r = n ? t.strip(r) : r,
            p.isBuild && (h[e] = r),
            i(r)
        },
        load: function(e, n, r, i) {
            if (i.isBuild && !i.inlineText) {
                r();
                return
            }
            p.isBuild = i.isBuild;
            var s = t.parseName(e),
            o = s.moduleName + (s.ext ? "." + s.ext: ""),
            u = n.toUrl(o),
            h = p.useXhr || t.useXhr; ! a || h(u, f, l, c) ? t.get(u,
            function(n) {
                t.finishLoad(e, s.strip, n, r)
            },
            function(e) {
                r.error && r.error(e)
            }) : n([o],
            function(e) {
                t.finishLoad(s.moduleName + "." + s.ext, s.strip, e, r)
            })
        },
        write: function(e, n, r, i) {
            if (h.hasOwnProperty(n)) {
                var s = t.jsEscape(h[n]);
                r.asModule(e + "!" + n, "define(function () { return '" + s + "';});\n")
            }
        },
        writeFile: function(e, n, r, i, s) {
            var o = t.parseName(n),
            u = o.ext ? "." + o.ext: "",
            a = o.moduleName + u,
            f = r.toUrl(o.moduleName + u) + ".js";
            t.load(a, r,
            function(n) {
                var r = function(e) {
                    return i(f, e)
                };
                r.asModule = function(e, t) {
                    return i.asModule(e, f, t)
                },
                t.write(e, a, r, s)
            },
            s)
        }
    };
    if (p.env === "node" || !p.env && typeof process != "undefined" && process.versions && !!process.versions.node) n = require.nodeRequire("fs"),
    t.get = function(e, t) {
        var r = n.readFileSync(e, "utf8");
        r.indexOf("﻿") === 0 && (r = r.substring(1)),
        t(r)
    };
    else if (p.env === "xhr" || !p.env && t.createXhr()) t.get = function(e, n, r, i) {
        var s = t.createXhr(),
        o;
        s.open("GET", e, !0);
        if (i) for (o in i) i.hasOwnProperty(o) && s.setRequestHeader(o.toLowerCase(), i[o]);
        p.onXhr && p.onXhr(s, e),
        s.onreadystatechange = function(t) {
            var i, o;
            s.readyState === 4 && (i = s.status, i > 399 && i < 600 ? (o = new Error(e + " HTTP status: " + i), o.xhr = s, r(o)) : n(s.responseText))
        },
        s.send(null)
    };
    else if (p.env === "rhino" || !p.env && typeof Packages != "undefined" && typeof java != "undefined") t.get = function(e, t) {
        var n, r, i = "utf-8",
        s = new java.io.File(e),
        o = java.lang.System.getProperty("line.separator"),
        u = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s), i)),
        a = "";
        try {
            n = new java.lang.StringBuffer,
            r = u.readLine(),
            r && r.length() && r.charAt(0) === 65279 && (r = r.substring(1)),
            n.append(r);
            while ((r = u.readLine()) !== null) n.append(o),
            n.append(r);
            a = String(n.toString())
        } finally {
            u.close()
        }
        t(a)
    };
    else if (p.env === "xpconnect" || !p.env && typeof Components != "undefined" && Components.classes && Components.interfaces) r = Components.classes,
    i = Components.interfaces,
    Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),
    t.get = function(e, t) {
        var n, s, o = {},
        u = new FileUtils.File(e);
        try {
            n = r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),
            n.init(u, 1, 0, !1),
            s = r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),
            s.init(n, "utf-8", n.available(), i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),
            s.readString(n.available(), o),
            s.close(),
            n.close(),
            t(o.value)
        } catch(a) {
            throw new Error((u && u.path || "") + ": " + a)
        }
    };
    return t
}),
define("text!templates/index.html", [],
function() {
    return '<div class="body nofoot">\r\n    <div class="top_box index_search">\r\n        <div class="search_col">\r\n            <div class="starting"><span id="g_depart">上海</span></div>\r\n            <div class="search_mod" id="g_dest">目的地、主题或关键字</div>\r\n        </div>\r\n        <p class="hot_motif">\r\n            <a href="javascript:;" data-name="海岛">海岛</a>\r\n            <a href="javascript:;" data-name="古镇">古镇</a>\r\n            <a href="javascript:;" data-name="蜜月">蜜月</a>\r\n            <a href="javascript:;" data-name="赏花">赏花</a>\r\n            <a href="javascript:;" data-name="亲子">亲子</a>\r\n            <a href="javascript:;" data-name="乐园">乐园</a>\r\n        </p>\r\n    </div>\r\n    <table class="motif_list">\r\n        <tbody>\r\n            <tr>\r\n                <td><i class="motif_rim" data-name="周边"></i>周边</td>\r\n                <td><i class="motif_inland" data-name="国内"></i>国内</td>\r\n                <td><i class="motif_hktw" data-name="港澳台"></i>港澳台</td>\r\n                <td><i class="motif_jsk" data-name="日韩"></i>日韩</td>\r\n            </tr>\r\n            <tr>\r\n                <td><i class="motif_asia" data-name="东南亚"></i>东南亚</td>\r\n                <td><i class="motif_europe" data-name="欧洲"></i>欧洲</td>\r\n                <td><i class="motif_america" data-name="美洲"></i>美洲</td>\r\n                <td><i class="motif_australia" data-name="澳中东非"></i>澳中东非</td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n    <div id="c_seckill"></div>\r\n    <div class="homerecommend">\r\n        <div class="home_base_loading base_loading" style="display:none"><i></i>加载中</div>\r\n        <div class="sift_product hidden"></div>\r\n    </div>\r\n</div>\r\n<div style="height:48px;">\r\n    <footer class="bottom_tab_wrap">\r\n        <ul class="bottom_tab">\r\n            <li><a class="index current">团队游首页</a></li>\r\n            <li><a class="my_collection" href="javascript:;">我的收藏</a></li>\r\n            <li><a id="team_helper" class="team_helper">团队助手</a></li>\r\n        </ul>\r\n    </footer>\r\n</div>'
}),
define("TourStore", ["cStore", "cBase", "cUtility"],
function(e, t, n) {
    var r = {},
    i = window.TOURCACHE || (window.TOURCACHE = {}),
    s = new t.Class(e, {
        __propertys__: function() {},
        initialize: function($super, e) {
            $super(e)
        }
    });
    return r.CustomStore = function(e, n) {
        return new t.Class(s, {
            __propertys__: function() {
                this.key = e,
                this.lifeTime = n
            },
            initialize: function($super, e) {
                $super(e)
            }
        })
    },
    r.DetailVisaStore = r.CustomStore("VACATIONS-DETAIL-VISA", "1d"),
    r.DetailBookNoteStore = r.CustomStore("VACATIONS-DETAIL-BOOKING-NOTE", "1d"),
    r.DetailPicStore = r.CustomStore("VACATIONS-DETAIL-PIC", "1d"),
    r.OrderDetailListStore = r.CustomStore("VACATIONS-ORDER-DETAIL-LIST", "1d"),
    r.ProdListParamStore = r.CustomStore("VACATIONS_PRODUCT_LIST_PARAM", "1d"),
    r.CityHistoryStore = r.CustomStore("VACATIONS_CITY_HISTORY", "365d"),
    r.GeoLocationStore = r.CustomStore("VACATIONS_GEOLOCATION", "1d"),
    r.BookStep2Store = r.CustomStore("TOUR-BOOK-STEP2", "1000d"),
    r.BookStep2GUIDStore = r.CustomStore("TOUR-BOOK-STEP2-GUID", "1000d"),
    r.BookStep2BaoxianStore = r.CustomStore("TOUR-BOOK-STEP2-BAOXIAN", "1000d"),
    r.BookStep2ChoosedResourceStore = r.CustomStore("TOUR-BOOK-STEP2-CHOOSEDRESOURCE", "1000d"),
    r.BookStep2HotelStore = r.CustomStore("TOUR-BOOK-STEP2-HOTEL", "1000d"),
    r.BookStep2SingleStore = r.CustomStore("TOUR-BOOK-STEP2-SINGLE", "1000d"),
    r.BookStep2OptionalStore = r.CustomStore("TOUR-BOOK-STEP2-OPTIONAL", "1000d"),
    r.BookStep3OrderData = r.CustomStore("TOUR-BOOK-STEP3-ORDER-DATA", "1000d"),
    r.PassengersStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-COMMON-PASSENGERS",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.AddressStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "S-TOUR-ADDRESS",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderDataSaveStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-DATA-STORE",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderParamStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-PARAM",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-FORM",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.TempPassengerStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-TMPPSG",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderCreateStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-CREATE",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.BookingResourceSearch = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-RESOURCE-SEARCH",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderDefaultStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-DEFAULT",
            this.lifeTime = "30D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderNoRvStrore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-NORVPARAM",
            this.lifeTime = "2D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.SourceSignStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-SOURCE-SIGN",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.AreaStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-SOURCE-AREA",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OrderModificationStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "TOUR-ORDER-Modification",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.PassengerEditStore = new t.Class(s, {
        __propertys__: function() {
            this.key = "U_PASSENGER_EDIT",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r
}),
define("res/scripts/util", [],
function() {
    function a(e) {
        var n = t.call(e);
        return e !== undefined && e !== null && (n == r.OBJECT_OBJECT || n == r.OBJECT_ARRAY ? !_.isEmpty(e) : !0)
    }
    var e = {},
    t = Object.prototype.toString,
    n = Array.prototype.slice,
    r = e.CONST = {
        OBJECT_DATE: "[object Date]",
        OBJECT_STRING: "[object String]",
        OBJECT_OBJECT: "[object Object]",
        OBJECT_ARRAY: "[object Array]",
        STORE_DETAIL: "detail",
        STORE_DETAIL_RETURN_CASH: "detail.return.cash",
        STORE_BOOKING_CALENDAR: "select.calendar",
        STORE_BOOKING_STEP1: "booking.step1",
        STORE_BOOKING_STEP2: "booking.step2",
        STORE_BOOKING_CHOOSED_RESOURCE: "booking.choosed.resource",
        STORE_BOOKING_HOTEL: "booking.hotel",
        STORE_BOOKING_SINGLE: "booking.single",
        STORE_BOOKING_OPTIONAL: "booking.optional",
        STORE_BOOKING_GUID: "booking.guid.manager",
        STORE_BOOKING_TMP_ORDER: "booking.tmp.order",
        STORE_BOOKING_STEP3: "booking.step3",
        STORE_ORDER_DETAIL_OPTION: "order.detail.option"
    },
    i = e.int = function(e) {
        return parseInt(e, 10)
    },
    s = {
        search_list: "vacationslist",
        detail: "detail",
        detail_select_calendar: "select.calendar",
        detail_return_cash: "detail.return.cash",
        detail_booking_note: "detail.booking.note",
        detail_visa: "detail.visa",
        select_calendar: "select.calendar",
        detail_picture_list: "detail.picture.list",
        detail_picture_detail: "detail.picture.detail",
        booking_step1: "booking.step1",
        booking_step2: "booking.step2",
        booking_select_hotel: "booking.hotel",
        booking_select_single: "booking.select.single",
        booking_select_optional: "booking.select.optional",
        order: "order",
        order_intention: "orderintention",
        order_route: "order.route",
        order_detail_list: "order.detail.list",
        order_detail_list_info: "order.detail.list.info"
    };
    e.getPath = function(t, n, r) {
        _.isUndefined(r) && (r = !0);
        var i = s[t] || "";
        return (r ? "#": "") + i + e.paramStringify(n)
    },
    e.paramStringify = function(t, n) {
        if (!t) return "";
        _.isUndefined(n) && (n = !0);
        var r = _.keys(t),
        i = r.length,
        s = "";
        return _.each(r,
        function(r, o) {
            var u = e.date.stringify(t[r]);
            _.isUndefined(u) && (u = ""),
            n && o == 0 && (s += "?"),
            s += r + "=" + u,
            o != i - 1 && (s += "&")
        }),
        s
    };
    var o = /.*?\?(.*)/,
    u = {};
    e.paramParse = function(t) {
        if (!t) {
            var n = location.hash;
            t = n.substr(1).match(o),
            t = t && t[1];
            if (!t) return {}
        }
        if (!u[t]) {
            var r = {};
            _.each(t.split("&"),
            function(t) {
                var n = t.match(/([^=]+)=?(.*)/),
                i = n[2],
                s = parseFloat(i);
                s + "" == i && (i = s),
                i = e.date.parse(i),
                r[n[1]] = i
            }),
            u[t] = r
        }
        return u[t]
    },
    e.assertError = function(e) {
        var t = "[Assertion failed] ";
        throw t + (e || "")
    },
    e.assert = function(t, n) {
        t || e.assertError(n)
    },
    e.assertEqual = function(t, n, r) {
        t != n && e.assertError(r)
    },
    e.assertNotEqual = function(t, n, r) {
        t == n && e.assertError(r)
    },
    e.assertDeepEqual = function(t, n, r) {
        t !== n && e.assertError(r)
    },
    e.assertNotDeepEqual = function(t, n, r) {
        t === n && e.assertError(r)
    },
    e.ensureAll = function(e, t) {
        return e && _.every(t,
        function(t) {
            return a(e[t])
        })
    },
    e.ensureSome = function(e, t) {
        return e && _.some(t,
        function(t) {
            return a(e[t])
        })
    },
    e.copyJSON = function(e) {
        return JSON.parse(JSON.stringify(e))
    };
    var f = "_dd",
    l = "dd_";
    e.date = {
        stringify: function(e, n, i) {
            return n = n || f,
            i = i || l,
            t.call(e) == r.OBJECT_DATE ? n + e.getTime() + i: e
        },
        parse: function(t, n, r) {
            n = n || f,
            r = r || l;
            var i = new RegExp("^" + n + "\\d+" + r + "$");
            return _.isString(t) && t.match(i) ? new Date(e.int(t.substr(n.length, t.length - (n.length + r.length)))) : t
        },
        transform: function(t) {
            var n = t.match(/^\/Date\((\d+)\+\d+\)\/$/);
            if (n) {
                var r = e.int(n[1]);
                return e.calendar.format(new Date(r))
            }
            return t
        }
    };
    var c = {},
    h = function(e) {
        this.KEY = e,
        this.storage = window.localStorage,
        this.not_store_key = "storage_data"
    };
    h.prototype._getStore = function() {
        var e = this.storage.getItem(this.KEY);
        return e ? JSON.parse(e) : {}
    },
    h.prototype.get = function(t) {
        var n = this._getStore();
        return _.each(n,
        function(t, r) {
            n[r] = e.date.parse(t)
        }),
        _.isUndefined(t) ? n: n[t]
    },
    h.prototype.set = function(n, i) {
        var s = this._getStore();
        if (t.call(n) == r.OBJECT_OBJECT) {
            var o = _.extend(s, n),
            u = i || [];
            u.push(this.not_store_key),
            _.each(u,
            function(e, t) {
                delete o[e]
            }),
            _.each(o,
            function(t, n) {
                o[n] = e.date.stringify(t)
            }),
            this.storage.setItem(this.KEY, JSON.stringify(o))
        } else n != this.not_store_key && (s[n] = i, this.storage.setItem(this.KEY, JSON.stringify(s)));
        return this
    },
    h.prototype.setAttr = function(e, t) {
        var n = this._getStore();
        _.isObject(t) ? _.extend(n[e], t) : n[e] = t,
        this.storage.setItem(this.KEY, JSON.stringify(n))
    },
    h.prototype.remove = function(e) {
        var t = this._getStore();
        return delete t[e],
        this.storage.setItem(this.KEY, JSON.stringify(t)),
        this
    },
    h.prototype.clear = function() {
        return this.storage.removeItem(this.KEY),
        this
    },
    e.getStorage = function(e) {
        return c[e] || (c[e] = new h(e)),
        c[e]
    },
    e.memoryCache = {
        _cache: {},
        get: function(e) {
            return this._cache[e]
        },
        set: function(e, t) {
            return this._cache[e] = t,
            this
        },
        remove: function(e) {
            return delete this._cache[e],
            this
        }
    };
    var p = e.pad = function(e, t, n, r) {
        return e = e.toString(),
        e.length < t && (n = (new Array(t)).join(n || " "), r ? e = (n + e).substr( - t) : e = (e + n).substring(0, t)),
        e
    };
    return e.calendar = {
        strToDate: function(e) {
            if (e instanceof Date || !e) return e;
            var t = e.split("-"),
            n,
            r,
            s;
            return t.length != 3 || !(n = i(t[0])) || !(r = i(t[1])) || !(s = i(t[2])) ? e: new Date(n, r - 1, s)
        },
        getFullMonth: function(e) {
            return i(e instanceof Date ? e.getMonth() : e) + 1
        },
        format: function(t, n) {
            return (t = e.calendar.strToDate(t)) ? (n = n || "yyyy-mm-dd", t = n.replace(/y+|m+|d+|H+|M+|s+/g,
            function(e) {
                var n = e.substr(0, 1),
                r = e.length;
                switch (n) {
                case "y":
                    return t.getFullYear().toString().substr(4 - r);
                case "m":
                    return p(t.getMonth() + 1, r, "0", !0);
                case "d":
                    return p(t.getDate(), r, "0", !0);
                case "H":
                    return p(t.getHours(), r, "0", !0);
                case "M":
                    return p(t.getMinutes(), r, "0", !0);
                case "s":
                    return p(t.getSeconds(), r, "0", !0)
                }
            }), t) : t
        }
    },
    e.extendDeep = function(n, i) {
        if (t.call(i) == r.OBJECT_OBJECT) {
            var s = {};
            for (var o in n) s[o] = n[o];
            for (var u in i) s[u] = e.extendDeep(s[u], i[u]);
            return s
        }
        return i
    },
    e.helper = {
        dateFormat: function(n, i) {
            _.isUndefined(i) && (i = 1),
            t.call(n) == r.OBJECT_DATE && (n = e.date.stringify(n));
            var s, o;
            return i == 1 && (s = n.split("-"), o = s[1] + "月" + s[2] + "日"),
            o
        },
        strdate: function(e) {
            return typeof e == "string" ? new Date(Date.parse(e.replace(/-/g, "/"))) : e
        }
    },
    e.getEnvCode = function(e) {
        var t = location.host;
        if (e && e.isInApp()) {
            var n = parseInt(e.isPreProduction());
            return isNaN(n) || [0, 1, 2].indexOf(n) < 0 ? 3 : n
        }
        return t.match(/^m\.fat/i) || t.match(/^(localhost|172\.16|127\.0)/i) || t.match(/^(192\.168\.253\.1)/i) ? 0 : t.match(/^(10\.8)/i) ? 1 : t.match(/^m\.uat/i) ? 2 : 3
    },
    e.getQueryString = function(e) {
        var t = new RegExp("(^|&)" + e + "=([^&]*)(&|$)", "i"),
        n = window.location.hash.split("?")[1] ? window.location.hash.split("?")[1].match(t) : null;
        return n != null ? unescape(n[2]) : null
    },
    e.setGuid = function() {
        var e = function() {
            return ((1 + Math.random()) * 65536 | 0).toString(16).substring(1)
        };
        return e() + e() + "-" + e() + "-" + e() + "-" + e() + "-" + e() + e() + e()
    },
    e.fixInertia = function(e) {
        var t = e,
        n = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAA1JREFUGFdj+P//PwMACPwC/ohfBuAAAAAASUVORK5CYII=",
        r = '<img src="' + n + '" alt=""/>',
        i = [r, r, r],
        s = '<div class="nonpic" style="display:none">' + i.join("") + "</div>";
        t.$el.append(s),
        setTimeout(function() {
            var e = t.$el.find(".nonpic img");
            e.each(function(e, t) {
                $(t).attr("src", "")
            })
        },
        13)
    },
    e
}),
define("TourModel", ["cModel", "cBase", "TourStore", "res/scripts/util", "cUtility"],
function(e, t, n, r, i) {
    var s = 3,
    o = function(e) {
        var t, n;
        return s === 0 ? (t = e.test.domain, n = e.test.path) : s === 1 ? (t = e.bastion.domain, n = e.bastion.path) : s === 2 ? (t = e.uat.domain, n = e.uat.path) : (t = e.pro.domain, n = e.pro.path),
        {
            domain: t,
            path: n
        }
    },
    u = {},
    a = new t.Class(e, {
        __propertys__: function() {
            var e = {
                test: {
                    domain: "m.fat19.qa.nt.ctripcorp.com",
                    path: "restapi.tour/vacationapi/"
                },
                bastion: {
                    domain: "10.8.2.111",
                    path: "restapi/vacationapi/"
                },
                uat: {
                    domain: "m.uat.qa.ctripcorp.com",
                    path: "restapi/vacationapi/"
                },
                pro: {
                    domain: "m.ctrip.com",
                    path: "restapi/vacationapi/"
                }
            };
            this.baseurl = o(e),
            this.method = "POST",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        },
        vaGet: function(e) {
            return r.memoryCache.get(e)
        },
        vaGetCache: function(e) {
            return this.vaGet(e || this._buildurl())
        },
        vaSet: function(e, t) {
            return r.memoryCache.set(e, t)
        },
        vaRemove: function(e) {
            return r.memoryCache.remove(e)
        },
        vaExec: function(e) {
            function s(t, n) {
                return t || (o(n), r.vaRemove(e.cacheKey)),
                t
            }
            function o(t) {
                var r = n[0];
                Object.prototype.toString.call(r) !== "[object Object]" && (r = {
                    originError: r
                }),
                r.errmsg = t || r.errmsg || r.msg,
                e.onError && e.onError.call(i, r)
            }
            function u(t) {
                e.onAlways && e.onAlways.apply(i, t)
            }
            e = _.extend({
                cacheInMemory: !0,
                cacheKey: this._buildurl()
            },
            e);
            var t, n, r = this,
            i = e.scope || this;
            return this.execute(function(t) {
                n = arguments,
                t.errno == 0 ? (e.cacheInMemory && r.vaSet(e.cacheKey, t.data), e.onComplete && e.onComplete.call(i, t.data, s)) : o(),
                u(n)
            },
            function() {
                n = arguments,
                o(),
                u(n)
            },
            e.ajaxOnly, i, e.onAbort)
        },
        _buildurl: function() {
            return this.protocol + "://" + this.baseurl.domain + "/" + this.baseurl.path + (typeof this.url == "function" ? this.url() : this.url) + r.paramStringify(this.param)
        }
    }),
    f = new t.Class(a, {
        __propertys__: function() {
            var e = {
                test: {
                    domain: "gateway.m.fws.qa.nt.ctripcorp.com",
                    path: "restapi/soa2/"
                },
                bastion: {
                    domain: "10.8.14.28:8080",
                    path: "restapi/soa2/"
                },
                uat: {
                    domain: "gateway.m.uat.qa.ctripcorp.com",
                    path: "restapi/soa2/"
                },
                pro: {
                    domain: "m.ctrip.com",
                    path: "restapi/soa2/"
                }
            };
            this.baseurl = o(e)
        },
        initialize: function($super, e) {
            $super(e)
        }
    });
    return u.DetailModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productdetail",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.DetailBookingNoteModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productdetail",
            this.param = {},
            this.result = n.DetailBookNoteStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.DetailVisaModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productdetail",
            this.param = {},
            this.result = n.DetailVisaStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.DetailPicModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productdetail",
            this.param = {},
            this.result = n.DetailPicStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/bookform",
            this.param = {
                dataItms: "2,3,4,5,6,7,8,9"
            },
            this.result = n.OrderStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.BookingPriceCalendar = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productcalendar",
            this.result = null,
            this.dataformat = function(e) {
                return e
            }
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.BookingResourceSearch = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/resourcesearch",
            this.result = n.BookingResourceSearch.getInstance(),
            this.dataformat = function(e) {
                return e
            }
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.BookingResourceHotelSearch = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/hotelsearch",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.BookingSelectSingle = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/singleresource",
            this.result = null,
            this.dataformat = function(e) {
                return e
            }
        },
        initialize: function() {}
    }),
    u.QuestionModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/productdetail",
            this.param = {
                pId: 0,
                reqType: [6],
                start: 1,
                count: 3
            },
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.PassengersModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/bookform",
            this.param = {
                dataItms: "1,10"
            },
            this.result = n.PassengersStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.PassengersListModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10090/GetMemberUsers.json",
            this.param = {}
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.PassengerEditModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10090/MutateMemberUser.json",
            this.param = {},
            this.param = n.PassengerEditStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderContractOrder = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/bookform",
            this.param = {
                dataItms: "11"
            },
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.VacationsListModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10124/json/ProductSearch",
            this.param = {
                SaleCityId: 2,
                StartCityId: 2,
                KeyWord: "beijing",
                AddressSelectorId: 0,
                LineType: 1,
                Start: 1,
                ReturnCount: 100
            },
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.DestSearchList = new t.Class(a, {
        __propertys__: function() {
            this.url = "product/addresstip",
            this.param = {
                key: "",
                depCityId: 0
            },
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.CreateOrderModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/createorder",
            this.param = {},
            this.result = n.OrderCreateStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.SaveOrderModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/booksave",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.SaveTempOrderModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/saveTempOrder",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.CouponVerifyModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/promovalid",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderSubmitModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/submit",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderDetailModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/orderdetail",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderDetailListModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/orderresource",
            this.param = {},
            this.result = n.OrderDetailListStore.getInstance()
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderCancelModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/ordercancel",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderModificationModel = new t.Class(a, {
        __propertys__: function() {
            this.url = "booking/OrderEdit",
            this.param = {},
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.homeInfoModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10124/json/GetHomeInfo",
            this.param = {
                SalesCityID: 2
            },
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.AnonymousUserModel = new t.Class(a, {
        __propertys__: function() {
            var e = {
                test: {
                    domain: "restful.m.fat19.qa.nt.ctripcorp.com",
                    path: "restapi5/"
                },
                bastion: {
                    domain: "10.8.5.99",
                    path: "restapi/"
                },
                uat: {
                    domain: "restful.m.uat.qa.ctripcorp.com",
                    path: "restapi/"
                },
                pro: {
                    domain: "wpg.ctrip.com",
                    path: "restapi/"
                }
            };
            this.baseurl = o(e),
            this.url = "User/Nonmember/Login",
            this.param = {
                uuid: 0,
                ver: 0
            },
            this.protocol = "https"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.CsKillAdModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10043/json/GetSecKillSetting",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.CsKillModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10043/json/GetProducts",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.PresaleModel = new t.Class(a, {
        __propertys__: function() {
            this.baseurl = {
                domain: "gateway.m.fws.qa.nt.ctripcorp.com",
                path: "restapi/soa2/"
            },
            this.url = "10043/json/GetPreSaleMoudles",
            this.result = null,
            this.param = {
                DebugTime: "41775.6280787037"
            }
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderCommentModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10135/json/ProductCommentQuestion"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.OrderCommentSubmitModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10135/json/ProductCommentSubmit"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.GetMyCollectionModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10108/json/GetMyFavorites",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.InMyCollectionModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10108/json/IsMyFavorites",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.AddCollectionModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10108/json/MyFavoritesAdd",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u.RemoveCollectionModel = new t.Class(f, {
        __propertys__: function() {
            this.url = "10108/json/MyFavoritesDelete",
            this.result = null
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    u
}),
define("res/scripts/widget/Timer", [],
function() {
    function e() {}
    return e.prototype = {
        constructor: "Timer",
        timered: function(e) {
            var t = this;
            this.timer = setTimeout(function() {
                clearTimeout(t.timer),
                e(),
                t.timered(e)
            },
            1e3)
        },
        mend: function(e) {
            return e.toString().length === 1 ? "0" + e: e
        },
        getTimerStatus: function() {
            var e = this,
            t = e.d1,
            n = e.d2,
            r = e.d3,
            i = this.dateDiff(new Date((new Date).getTime() + t), e.saleStartTime);
            return i >= 1 ? "noStarted": n < 864e5 && n > 1e3 ? (e.d2 = n - 1e3, "upcomingStart") : r > 1e3 ? (e.d3 = r - 1e3, "start") : "end"
        },
        getLastTime: function(e) {
            var t, n, r, i, s, o;
            return t = e % 864e5,
            i = Math.floor(t / 36e5),
            n = t % 36e5,
            s = Math.floor(n / 6e4),
            r = n % 6e4,
            o = Math.round(r / 1e3),
            {
                hour: this.mend(i),
                minute: this.mend(s),
                second: this.mend(o)
            }
        },
        dateDiff: function(e, t) {
            return t.getFullYear() > e.getFullYear() ? 1 : t.getMonth() > e.getMonth() ? 1 : t.getDate() - e.getDate()
        },
        getLocalTime: function(e) {
            var t = new Date,
            n = new Date(e.SaleStartTime),
            r = new Date(e.SaleEndTime),
            i = new Date(e.ServerTime),
            s = {},
            o = 0,
            u = 0,
            a = 0,
            f = 0;
            return this.d1 = o = i.getTime() - t.getTime(),
            this.d2 = u = n.getTime() - t.getTime() - o,
            this.d3 = a = r.getTime() - t.getTime() - o,
            f = this.dateDiff(new Date(t.getTime() + o), n),
            this.saleStartTime = n,
            f >= 1 ? s = {
                cskillStatus: "noStarted",
                lastTime: {
                    month: n.getMonth() + 1,
                    date: n.getDate()
                }
            }: u < 864e5 && u > 0 ? s = {
                cskillStatus: "upcomingStart",
                lastTime: this.getLastTime(u)
            }: a > 0 ? s = {
                cskillStatus: "start",
                lastTime: this.getLastTime(a)
            }: s = {
                cskillStatus: "end"
            },
            s
        }
    },
    e
}),
define("views/index", ["libs", "c", "cBasePageView", "text!templates/index.html", "cWidgetFactory", "cWidgetGeolocation", "TourStore", "res/data/cities", "TourModel", "cWidgetGuider", "res/scripts/widget/Timer"],
function(e, t, n, r, i, s, o, u, a, f, l) {
    var c, h, p, d = u.pySort,
    v, m, g, y = "上海",
    b = "2",
    w = o.ProdListParamStore.getInstance(),
    E = o.GeoLocationStore.getInstance(),
    S = i.create("Guider"),
    x = t.utility.isInApp(),
    T = new l,
    N = window.screen.width,
    C = N <= 480 ? "M480": "M640",
    k = n.extend({
        hasAd: 1,
        pageid: t.utility.isInApp() ? "220078": "220001",
        homeInfoModel: a.homeInfoModel.getInstance(),
        render: function() {
            this.$el.html(r)
        },
        onCreate: function() {
            this.injectHeaderView(),
            this.render()
        },
        events: {
            "click .starting": "getDepart",
            "click #g_dest": "getDest",
            "click .hot_motif": "goHot",
            "click .motif_list td": "goMot",
            "click #c_seckill": "goCsList",
            "click #team_helper": "goTeamHelper",
            "click .my_collection": "goCollect"
        },
        onLoad: function() {
            var e = this;
            this.headerview.set({
                title: "团队游",
                back: !0,
                view: this,
                tel: null,
                home: !0,
                events: {
                    returnHandler: function() {
                        S.apply({
                            callback: function() {
                                e.back("#vacations")
                            },
                            hybridCallback: function() {
                                S.backToLastPage({})
                            }
                        })
                    },
                    homeHandler: function() {
                        this.jump("/html5/")
                    }
                }
            }),
            g = w.get() || {
                destKwd: "",
                selectorId: "",
                dCtyName: "",
                dCtyId: "",
                sCtyId: "",
                vLocal: {},
                vDepart: {}
            },
            this.headerview.show(),
            this.turning(),
            this.getCskill(),
            !x && e.getHomeInfo()
        },
        getCskill: function() {
            var e = this,
            t = function(t) {
                var n = t.ImageUrl ? t.ImageUrl: "http://pic.c-ctrip.com/vacation_v2/h5/group_travel/pic_none.png",
                r = {},
                s = T.getTimerStatus(),
                o = '<table class="c_seckill"><tbody><tr>                                <td>                                <i class="icon_seckill"></i>';
                s === "noStarted" ? (r = i.lastTime, o += '<p class="date_seckill">' + r.month + "月" + r.date + "日开抢</p>") : s === "upcomingStart" ? (r = T.getLastTime(T.d2), o += '<p class="time_seckill"><span>' + r.hour + "</span><em>:</em><span>" + r.minute + "</span><em>:</em><span>" + r.second + "</span></p>") : s === "start" && (o += '<p class="date_seckill">火热抢购中</p>'),
                o += '</td>                                <td>                                    <div class="index_seckill_banner">                                        <img src="' + n + '">                                    </div>                                </td>                            </tr></tbody></table>',
                e.$el.find("#c_seckill").html(o)
            },
            n = function() {
                var t = e.$el.find("#c_seckill p"),
                n = {},
                r = T.getTimerStatus();
                switch (r) {
                case "noStarted":
                    n = i.lastTime,
                    t.removeClass().addClass("date_seckill").html(n.month + "月" + n.date + "日开抢");
                    break;
                case "upcomingStart":
                    n = T.getLastTime(T.d2),
                    t.removeClass().addClass("time_seckill").html("<span>" + n.hour + "</span><em>:</em><span>" + n.minute + "</span><em>:</em><span>" + n.second + "</span>");
                    break;
                case "start":
                    t.removeClass().addClass("date_seckill").html("火热抢购中");
                    break;
                case "end":
                    t.remove()
                }
            },
            r = a.CsKillAdModel.getInstance(),
            i = {};
            r.param = {
                EnvironmentType: C
            },
            r.excute(function(e) {
                var r = e.data;
                e.ResponseStatus.Ack === "Success" ? (i = T.getLocalTime(r.SecKillSetting), t(r.SecKillSetting), T.timered(n)) : this.showToast(e.ResponseStatus.Errors[0].Message)
            },
            function() {
                this.showToast("网络错误，请稍候重试。")
            },
            !1, this)
        },
        showToast: function(e, n) {
            n || (n = function() {}),
            this.toast || (this.toast = new t.ui.Toast),
            this.toast.show(e, 2, n, !0)
        },
        getDepart: function() {
            this.showLoading();
            var e = !localStorage.length; (E.get() || {}).startLocating || this.Locating(),
            document.selectedDepart = v.data("id") != undefined ? {
                name: v.text(),
                id: v.data("id")
            }: undefined,
            e ? ($("body").html(""), location.hash = "#vacationcity", location.reload()) : this.forward("#vacationcity")
        },
        getDest: function() {
            this.showLoading(),
            g.dCtyName || (g.dCtyName = v.text(), g.sCtyId = v.data("id")),
            g.dCtyId = g.sCtyId,
            g.linetype = 1,
            g.renew = 1,
            w.set(g);
            var e = !localStorage.length;
            e ? ($("body").html(""), location.hash = "#destination", location.reload()) : this.forward("#destination")
        },
        groupSearch: function() {
            g.dCtyName || (g.dCtyName = v.text(), g.sCtyId = v.data("id")),
            g.destKwd || (g.destKwd = m.text(), g.selectorId = m.data("sltid")),
            g.dCtyId = g.sCtyId,
            g.linetype = 1,
            g.renew = 1,
            w.set(g),
            this.forward("#vacationslist")
        },
        onShow: function() {
            var e = this;
            h = !1,
            p = E.get() || {},
            v = $("#g_depart"),
            m = $("#g_dest"),
            g = w.get() || {
                destKwd: "",
                selectorId: "",
                dCtyName: "",
                dCtyId: "",
                sCtyId: "",
                vLocal: {},
                vDepart: {},
                vDestino: {}
            },
            g.dCtyName ? (v.text(g.dCtyName), v.data("id", g.sCtyId), h = 1) : p.name ? (h = 1, v.text(p.name), v.data("id", p.id), g.dCtyName = p.name, g.sCtyId = p.id, w.set(g)) : (v.text(y), v.data("id", b), e.Locating())
        },
        onHide: function() {},
        Locating: function() {
            p = E.get() || {},
            p.startLocating = 1,
            E.set(p),
            c = i.create("Geolocation"),
            c.requestCityInfo(function(e) {
                for (var t = 0,
                n = d.length; t < n; t++) if (e.city.indexOf(d[t].name) > -1) {
                    g.dCtyName || (v.text(d[t].name), v.data("id", d[t].id)),
                    p = {
                        name: d[t].name,
                        id: d[t].id
                    },
                    h = 1;
                    break
                }
                h || (g.dCtyName || (v.text(y), v.data("id", b)), p = {
                    fail: 1
                },
                h = 1),
                E.set(p),
                g.dCtyName = v.text(),
                g.sCtyId = v.data("id"),
                w.set(g)
            },
            function(e) {
                h || (g.dCtyName || (v.text(y), v.data("id", b)), h = 1, p = {
                    fail: 1
                },
                E.set(p), g.dCtyName = v.text(), g.sCtyId = v.data("id"), w.set(g))
            })
        },
        goHot: function(e) {
            g.destKwd = $(e.target).data("name"),
            g.selectorId = 0,
            this.groupSearch()
        },
        goMot: function(e) {
            g.destKwd = $(e.target).closest("td").find("i").data("name"),
            g.selectorId = 0,
            this.groupSearch()
        },
        getHomeInfo: function() {
            var e = this,
            t = e.$el.find(".home_base_loading"),
            n = e.$el.find(".sift_product");
            t.show(),
            n.hide(),
            e.homeInfoModel.param.SalesCityID = $("#g_depart").data("id") || b,
            e.homeInfoModel.excute(function(r) {
                if (r.ResponseStatus && r.ResponseStatus.Ack && r.ResponseStatus.Ack == "Success" && r.Data && r.Data.RecommendProductList) {
                    var i = {
                        RecommendProductList: []
                    },
                    s = r.Data.RecommendProductList || [],
                    o = s.length;
                    for (var u = 0; u < 5 && u < o; u++) i.RecommendProductList.push(s[u]);
                    i.saleCityId = e.homeInfoModel.param.SalesCityID;
                    var a = '<h2>精选产品</h2>		                <ul>                        <%_.each(data.RecommendProductList, function(v,k){ %>                            <li>				                <a href="#detail?productId=<%=v.ProductId %>&saleCityId=<%=data.saleCityId %>&departCityId=0&from=index">					                <div class="product_pic"><img src="<%=v.BigPicUrl %>" alt=""></div>                                    <div class="product_title">                                        <strong class="base_price"><%if(v.Price){ %><dfn>¥</dfn><%=v.Price %><%} else{%>实时计价<%} %></strong>						                <h3><em><%=v.ProductName %></em></h3>						            </div>                                    <%if(v.PromotionalTalkLst && v.PromotionalTalkLst.length){ %><span class="product_tips"><em><%=v.PromotionalTalkLst[0] %></em><%if(v.PromotionalTalkLst[1]){ %><em><%=v.PromotionalTalkLst[1] %></em><%} %></span><%} %>				                </a>			                </li>                        <%}) %>		                </ul>';
                    t.hide();
                    var f = _.template(a)({
                        data: i
                    });
                    o ? (n.html(f).show(), n.removeClass("hidden")) : n.hide()
                } else t.hide(),
                n.hide()
            },
            function(e) {
                t.hide(),
                n.hide()
            },
            !1, this)
        },
        goCsList: function() {
            this.forward("#cskill.list")
        },
        goTeamHelper: function() {
            var e = "/webapp/tourassistant/index.html#index?from=/webapp/tour/index.html#index";
            x ? S.cross({
                path: "tourassistant",
                param: "index.html#index?from=/webapp/tour/index.html#index"
            }) : this.jump(e)
        },
        goCollect: function() {
            this.forward("collectionlist")
        }
    });
    return k
}),
define("text!templates/vacationslist.html", [],
function() {
    return '<div class="register_pro content_list" style="padding:0px">\r\n<%var tabStatistics=data.tabStatistics; %>\r\n<%if(!!tabStatistics && !!tabStatistics.tabs){ %>\r\n<nav class="tpye_tab" <%if(!!data.isInApp){ %>style="top:0"<%} %>>\r\n        <%var tabClass=[\'\',\'vDepart\',\'vDestino\',\'vLocal\'],tabName=[\'\', \'出发地参团\',\'目的地参团\',\'一日游\'], tabSort=[1,2,3]; %>\r\n        <%_.each(tabSort,function(v,k){ %>\r\n            <%if(!!tabStatistics[tabClass[v]]){ %>\r\n            <li class="<%=tabClass[v] %> <% if(data.linetype==v){ %>on<% } %>" data-linetype="<%=v %>" <%if(!!tabStatistics.tabs && tabStatistics.tabs<3){ %>style="width:<%=100/tabStatistics.tabs %>%"<%} %>><%=tabName[v] %></li>\r\n            <%} %>\r\n        <%}) %>\r\n</nav>\r\n<%} %>\r\n<!--<div class="scrollproduct" style="overflow:hidden;height:<%=data.scrollproductHeight %>px;">-->\r\n<div class="product_list_box" style="padding-top:42px">\r\n    <div class="product_list">\r\n    <%var promotion=[\'\',\'立减\',\'早订优惠\',\'多人立减\',\'贵宾专享\']; %>\r\n    <%_.each(data.products, function(v,k){%>\r\n    <ul class="hot_list_tab btn_active" data-pid="<%=v.ProductId %>&saleCityId=<%=data.sCityId %>&departCityId=<%=v.DepartCityId %>">\r\n        <li class="hot_img">\r\n            <img width="142px" height="80px" alt="" src="http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png" data-src="<% if(v.Img && !!v.Img.trim()){%><%=v.Img%><%}else{ %>http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png<%} %>">\r\n        </li>\r\n        <li class="hot_vacation">\r\n            <%if(v.IsPromo){ %><i class="benefit">惠</i><%} %>\r\n            <div class="ellipsis"><p class="xname"><%=v.Title%></p></div>\r\n            <div class="price_wrap">\r\n                <div class="pices">\r\n                    <%if(!!v.MinPrice){ %>\r\n                    <dfn>¥</dfn>\r\n                    <span><%=v.MinPrice%></span>\r\n                    起\r\n                    <%}else{ %>\r\n                    <span class="font14">实时计价</span>\r\n                    <%} %>\r\n                </div>\r\n                <%if(v.Level && v.Level>1){ %><i class="diamond diamond_<%=v.Level %>"></i><%} %>\r\n            </div>\r\n            <div class="other">\r\n                <%if(!!v.Score){ %><p class="score"><span><%=v.Score.toFixed(1) %></span>分</p><%} %>\r\n                <%if(!!v.DepartCityName && v.DepartCityId!=data.sCityId){ %><span class="city"><%=v.DepartCityName %>出发</span><%} %>     \r\n                <div class="float_right">\r\n                    <%if(v.IsCanCashBack){ %><i class="orange"><dfn>返</dfn><%if(v.CashBackAmount && !isNaN(v.CashBackAmount)){ %><%=parseInt(v.CashBackAmount) %><%} %></i><%} %>\r\n                    <%if(v.IsShowWifi){ %><i class="wifi"></i><%} %>\r\n                    <%if(!!v.SpecialTag && !!v.SpecialTag.trim()){ %> <i class="green"><%=v.SpecialTag %></i><%} %>\r\n                </div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n    <%})%>\r\n    </div>\r\n    <div class="no_more" style="display:none">没有更多结果了</div>\r\n    <div class="base_loading" style="display:none"><i></i>加载中</div>\r\n    <div class="wireless_failure" style="display:none">\r\n        <div class="no_wifi">\r\n            <i class="wifi_ico"></i>\r\n            <p>网络不给力，请稍后再试试吧</p>\r\n            <a class="try_again" href="javascript:;">重试</a>\r\n        </div>\r\n        <div class="dial_service">\r\n            <p>或者拨打携程客服电话</p>\r\n            <a class="dial_btn" data-num="8008206666" href="tel:8008206666">联系客服</a>\r\n        </div>\r\n    </div>\r\n    <div class="error" <%if(data.products) {%>style="display:none"<%} %>>\r\n            <i class="error_ico"></i>\r\n            <p>没有找到符合条件的结果，<br>请修改条件重新查询</p>\r\n    </div>\r\n</div>\r\n<!--</div>-->\r\n<div class="footer">\r\n<%if(!!tabStatistics && !!tabStatistics.tabs){ %>\r\n    <ul class="tab_list">\r\n    <li class="districtsum">\r\n        <span><%=data.districtSelectedName %></span><i class="icon_b icon_all_hui"></i>\r\n        <div class="hide_div_b districtlist" style="display:none">\r\n            <div class="scroll_districtlist" style="max-height:338px;overflow:hidden">\r\n            <%if(data.districtSum){ %>\r\n            <div class="inner_wrap" style="height:auto;max-height:none">\r\n                <h4 class="area_title no_arrow" data-districtname="目的地" data-districtid="notset">全部<%if(data.districtSum.TotalCount){ %>(<%=data.districtSum.TotalCount %>)<%} %></h4>\r\n                <%_.each(data.districtSum.ParentDistrictList,function(v,k){ %>\r\n                <h4 class="area_title"><%=v.Name %>(<%=v.TotalCount %>)</h4>   \r\n                    <div class="area_subnav hidden">\r\n                        <a href="javascript:;" data-districtid="<%=v.Id %>" data-districtname="<%=v.Name %>" data-districtlabel="<%=v.Label %>" data-districttype="<%=v.Type %>">全部<%=v.Name %></a>\r\n                        <%_.each(v.ChildDistrictList,function(w,l){ %>\r\n                        <a href="javascript:;" data-districtid="<%=w.Id %>" data-districtname="<%=w.Name %>" data-districtlabel="<%=w.Label %>"><%=w.Name %>(<%=w.TotalCount %>)</a>\r\n                        <%}) %>\r\n                    </div>\r\n                <%}) %>\r\n            </div>\r\n            <%} %>\r\n            </div>\r\n        </div>\r\n    </li>\r\n    <li class="shaixuan <%if(!!data.hasfilter){ %>on<%} %>">筛选<i class="icon_b <%if(!!data.hasfilter){ %>icon_sx_blue<%}else{ %>icon_sx_hui<%} %>"></i><div class="hide_div_b" style="display:none"><div class="sxcontent inner_wrap" style="max-height:<%=(document.body.offsetHeight*2/3)%>px;overflow:hidden;padding-bottom:60px;"></div></div></li>\r\n    <%var crecommend=[\'综合推荐\',\'游玩天数\',\'游玩天数\',\'价格\',\'价格\',\'销量\']; var sortBy=[0,5,3,4]; %>\r\n    <li class="crecommend" <% if(data.isLocal){ %>style="width:50%;"<%} %>><%=crecommend[data.sortType] %><i class="icon_b <%if(data.sortType==3){ %>icon_top_hui<%}else{ %>icon_bottom_hui<%} %>"></i>\r\n        <dl class="hide_div" style="display:none">\r\n        <%_.each(sortBy, function(v,k){ %>\r\n            <dd <%if(v==data.sortType){ %>class="on"<%} %>><%=crecommend[v] %><i class="<%if(v==3){ %>up<%}else{ %>down<%} %>"></i></dd>\r\n        <%}) %>\r\n        </dl>\r\n    </li>\r\n</ul>\r\n<%} %>\r\n</div>\r\n<div class="warp_z" style="display:none"></div>\r\n</div>\r\n'
}),
define("text!templates/shaixuan.html", [],
function() {
    return '<div class="sxiscroll" style="overflow:hidden;max-height:<%=(document.body.offsetHeight*2/3)%>px;">\r\n<div class="" style="">\r\n    <%_.each(data, function(v,k){%>\r\n    <%if(v.type=="isSale" || v.type=="isPromo"){ %>\r\n    <p class="list_filter_radio js_onOff" data-type="<%=v.type %>"><%=v.name %><a href="javascript:;" class="<%if(v.key){%>btn_on<%}else{%>btn_off<%} %>"></a></p>\r\n    <%}else if(v.type=="goTime"){ %>\r\n    <dl class="list_filter_item sxdatepicker">\r\n        <dt>出发时间</dt>\r\n        <dd>\r\n            <span class="date starttime datepicker" index="<%=v.values.departStart.index %>"><%=v.values.departStart.value %></span>\r\n            ~\r\n            <span class="date endtime datepicker" index="<%=v.values.departEnd.index %>"><%=v.values.departEnd.value %></span>\r\n        </dd>\r\n    </dl>\r\n    <dl class="datapickerbox list_filter_item" style="display:none">\r\n        <dd>\r\n            <div class="datecontainer">\r\n                <div class="subcon1"></div>\r\n                <div class="subcon2"></div>\r\n            </div>\r\n        </dd>\r\n    </dl>\r\n    <%}else if(v.type=="L"){ %>\r\n    <%var _text=""; %>\r\n    <%_.each(v.list, function(l,lindex){%>\r\n    <%if(l.isSelect){_text+=l.text;} %>\r\n    <%}) %>\r\n    <dl class="list_filter_item">\r\n        <dt>游玩线路</dt>\r\n        <dd class="triparea arrow_down"><%=_text %></dd>\r\n    </dl>\r\n    <%if(v.list && v.list.length){ %>\r\n    <div class="list_filter_checkbox triparealist" data-type="<%=v.type %>" style="display:none">\r\n    <%_.each(v.list, function(l,lindex){%>\r\n        <p <% if(l.key==\'notset\'){%>class="notset"<%} %>  data-key="<%=l.key %>" data-index="<%=lindex %>"><i class="checkbox_ico tripareacb <%if(l.isSelect){ %>current<%} %>"></i><%=l.text %></p>\r\n    <%}) %>\r\n    </div>\r\n    <%} %>\r\n    <%}else{ %>\r\n    <%var multipleList="U,T,F"; %>\r\n    <dl class="list_filter_item" data-index="<%=k%>" data-type="<%=v.type%>" <%if(multipleList.indexOf(v.type)>-1){ %>data-multiple="1"<%} %>>\r\n        <dt><%=v.name %></dt>\r\n        <dd>\r\n            <%if(v.list && v.list.length){ %>\r\n                <%_.each(v.list, function(l,lindex){%>\r\n                    <%if(l.text!=\'无钻\' && l.text!=\'当地参团\'){ %>\r\n                    <a class="<%if(l.isSelect){ %>selected<%} %>" href="javascript:;" data-key="<%=l.key %>" data-index="<%=lindex %>"><%=l.text.replace("-日","日以上")%></a>\r\n                    <%} %>\r\n                <%}) %>\r\n            <%}else{ %>\r\n            <a class="selected" href="javascript:;"><%=v.text %></a>\r\n            <%} %>\r\n        </dd>\r\n    </dl>\r\n            <%} %>\r\n    <%}) %>\r\n    <!--留白专用-->\r\n    <div class="" style="height:60px;"></div>\r\n</div>\r\n</div>\r\n<div class="filter_btn_wrap" style="position:absolute;bottom:0;width:96%;z-index:10000">\r\n        <a class="reset btn_reset" href="javascript:;">重设</a>\r\n        <a class="ok btn_ok" id="js_finishBtn" href="javascript:;">确定</a>\r\n    </div>'
}),
define("text!templates/filterlist.html", [],
function() {
    return '<div class="content">\r\n    <ul class="item_select" id="js_filter_select">\r\n        <%_.each(data, function(v,k){%>\r\n            <%if(v.text!=\'无钻\' && v.text!=\'当地参团\'){ %><li class="<%if(v.isSelect){ %>cur<%} %>" data-key="<%=v.key%>" data-id="<%=k%>"> <%=v.text.replace("-日","日以上")%></li><%} %>\r\n        <%})%>\r\n    </ul>\r\n</div>'
}),
define("text!templates/fakeVlist.html", [],
function() {
    return '<div class="register_pro content_list" style="padding:0px">\r\n<nav class="tpye_tab" <%if(!!data.isInApp){ %>style="top:0"<%} %>>\r\n            <li class="vDepart on" data-linetype="1" style="width:50%">出发地参团</li>\r\n            <li class="vLocal " data-linetype="3" style="width:50%">一日游</li>\r\n</nav>\r\n<div class="footer">\r\n<ul class="tab_list">\r\n    <li class="districtsum"><span>目的地</span><i class="icon_b icon_all_hui"></i></li>\r\n    <li class="shaixuan ">筛选<i class="icon_b icon_sx_hui"></i></li>\r\n    <li class="crecommend">综合推荐<i class="icon_b icon_bottom_hui"></i>\r\n    </li>\r\n</ul>\r\n</div>\r\n</div>'
}),
define("res/data/iscroll", [],
function() {
    return function(e, t, n) {
        function s(e, n) {
            this.wrapper = typeof e == "string" ? t.querySelector(e) : e,
            this.scroller = this.wrapper.children[0],
            this.scrollerStyle = this.scroller.style,
            this.options = {
                resizeScrollbars: !0,
                mouseWheelSpeed: 20,
                snapThreshold: .334,
                startX: 0,
                startY: 0,
                scrollY: !0,
                directionLockThreshold: 5,
                momentum: !0,
                bounce: !0,
                bounceTime: 600,
                bounceEasing: "",
                preventDefault: !0,
                preventDefaultException: {
                    tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT)$/
                },
                HWCompositing: !0,
                useTransition: !0,
                useTransform: !0
            };
            for (var r in n) this.options[r] = n[r];
            this.translateZ = this.options.HWCompositing && i.hasPerspective ? " translateZ(0)": "",
            this.options.useTransition = i.hasTransition && this.options.useTransition,
            this.options.useTransform = i.hasTransform && this.options.useTransform,
            this.options.eventPassthrough = this.options.eventPassthrough === !0 ? "vertical": this.options.eventPassthrough,
            this.options.preventDefault = !this.options.eventPassthrough && this.options.preventDefault,
            this.options.scrollY = this.options.eventPassthrough == "vertical" ? !1 : this.options.scrollY,
            this.options.scrollX = this.options.eventPassthrough == "horizontal" ? !1 : this.options.scrollX,
            this.options.freeScroll = this.options.freeScroll && !this.options.eventPassthrough,
            this.options.directionLockThreshold = this.options.eventPassthrough ? 0 : this.options.directionLockThreshold,
            this.options.bounceEasing = typeof this.options.bounceEasing == "string" ? i.ease[this.options.bounceEasing] || i.ease.circular: this.options.bounceEasing,
            this.options.resizePolling = this.options.resizePolling === undefined ? 60 : this.options.resizePolling,
            this.options.tap === !0 && (this.options.tap = "tap"),
            this.options.shrinkScrollbars == "scale" && (this.options.useTransition = !1),
            this.options.invertWheelDirection = this.options.invertWheelDirection ? -1 : 1,
            this.x = 0,
            this.y = 0,
            this.directionX = 0,
            this.directionY = 0,
            this._events = {},
            this._init(),
            this.refresh(),
            this.scrollTo(this.options.startX, this.options.startY),
            this.enable()
        }
        function o(e, n, r) {
            var i = t.createElement("div"),
            s = t.createElement("div");
            return r === !0 && (i.style.cssText = "position:absolute;z-index:9999", s.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),
            s.className = "iScrollIndicator",
            e == "h" ? (r === !0 && (i.style.cssText += ";height:7px;left:2px;right:2px;bottom:0", s.style.height = "100%"), i.className = "iScrollHorizontalScrollbar") : (r === !0 && (i.style.cssText += ";width:7px;bottom:2px;top:2px;right:1px", s.style.width = "100%"), i.className = "iScrollVerticalScrollbar"),
            i.style.cssText += ";overflow:hidden",
            n || (i.style.pointerEvents = "none"),
            i.appendChild(s),
            i
        }
        function u(n, r) {
            this.wrapper = typeof r.el == "string" ? t.querySelector(r.el) : r.el,
            this.wrapperStyle = this.wrapper.style,
            this.indicator = this.wrapper.children[0],
            this.indicatorStyle = this.indicator.style,
            this.scroller = n,
            this.options = {
                listenX: !0,
                listenY: !0,
                interactive: !1,
                resize: !0,
                defaultScrollbars: !1,
                shrink: !1,
                fade: !1,
                speedRatioX: 0,
                speedRatioY: 0
            };
            for (var s in r) this.options[s] = r[s];
            this.sizeRatioX = 1,
            this.sizeRatioY = 1,
            this.maxPosX = 0,
            this.maxPosY = 0,
            this.options.interactive && (this.options.disableTouch || (i.addEvent(this.indicator, "touchstart", this), i.addEvent(e, "touchend", this)), this.options.disablePointer || (i.addEvent(this.indicator, "MSPointerDown", this), i.addEvent(e, "MSPointerUp", this)), this.options.disableMouse || (i.addEvent(this.indicator, "mousedown", this), i.addEvent(e, "mouseup", this))),
            this.options.fade && (this.wrapperStyle[i.style.transform] = this.scroller.translateZ, this.wrapperStyle[i.style.transitionDuration] = i.isBadAndroid ? "0.001s": "0ms", this.wrapperStyle.opacity = "0")
        }
        var r = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame ||
        function(t) {
            e.setTimeout(t, 1e3 / 60)
        },
        i = function() {
            function o(e) {
                return s === !1 ? !1 : s === "" ? e: s + e.charAt(0).toUpperCase() + e.substr(1)
            }
            var r = {},
            i = t.createElement("div").style,
            s = function() {
                var e = ["t", "webkitT", "MozT", "msT", "OT"],
                t,
                n = 0,
                r = e.length;
                for (; n < r; n++) {
                    t = e[n] + "ransform";
                    if (t in i) return e[n].substr(0, e[n].length - 1)
                }
                return ! 1
            } ();
            r.getTime = Date.now ||
            function() {
                return (new Date).getTime()
            },
            r.extend = function(e, t) {
                for (var n in t) e[n] = t[n]
            },
            r.addEvent = function(e, t, n, r) {
                e.addEventListener(t, n, !!r)
            },
            r.removeEvent = function(e, t, n, r) {
                e.removeEventListener(t, n, !!r)
            },
            r.momentum = function(e, t, r, i, s, o) {
                var u = e - t,
                a = n.abs(u) / r,
                f,
                l;
                return o = o === undefined ? 6e-4: o,
                f = e + a * a / (2 * o) * (u < 0 ? -1 : 1),
                l = a / o,
                f < i ? (f = s ? i - s / 2.5 * (a / 8) : i, u = n.abs(f - e), l = u / a) : f > 0 && (f = s ? s / 2.5 * (a / 8) : 0, u = n.abs(e) + f, l = u / a),
                {
                    destination: n.round(f),
                    duration: l
                }
            };
            var u = o("transform");
            return r.extend(r, {
                hasTransform: u !== !1,
                hasPerspective: o("perspective") in i,
                hasTouch: "ontouchstart" in e,
                hasPointer: navigator.msPointerEnabled,
                hasTransition: o("transition") in i
            }),
            r.isBadAndroid = /Android /.test(e.navigator.appVersion) && !/Chrome\/\d/.test(e.navigator.appVersion),
            r.extend(r.style = {},
            {
                transform: u,
                transitionTimingFunction: o("transitionTimingFunction"),
                transitionDuration: o("transitionDuration"),
                transitionDelay: o("transitionDelay"),
                transformOrigin: o("transformOrigin")
            }),
            r.hasClass = function(e, t) {
                var n = new RegExp("(^|\\s)" + t + "(\\s|$)");
                return n.test(e.className)
            },
            r.addClass = function(e, t) {
                if (r.hasClass(e, t)) return;
                var n = e.className.split(" ");
                n.push(t),
                e.className = n.join(" ")
            },
            r.removeClass = function(e, t) {
                if (!r.hasClass(e, t)) return;
                var n = new RegExp("(^|\\s)" + t + "(\\s|$)", "g");
                e.className = e.className.replace(n, " ")
            },
            r.offset = function(e) {
                var t = -e.offsetLeft,
                n = -e.offsetTop;
                while (e = e.offsetParent) t -= e.offsetLeft,
                n -= e.offsetTop;
                return {
                    left: t,
                    top: n
                }
            },
            r.preventDefaultException = function(e, t) {
                for (var n in t) if (t[n].test(e[n])) return ! 0;
                return ! 1
            },
            r.extend(r.eventType = {},
            {
                touchstart: 1,
                touchmove: 1,
                touchend: 1,
                mousedown: 2,
                mousemove: 2,
                mouseup: 2,
                MSPointerDown: 3,
                MSPointerMove: 3,
                MSPointerUp: 3
            }),
            r.extend(r.ease = {},
            {
                quadratic: {
                    style: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
                    fn: function(e) {
                        return e * (2 - e)
                    }
                },
                circular: {
                    style: "cubic-bezier(0.1, 0.57, 0.1, 1)",
                    fn: function(e) {
                        return n.sqrt(1 - --e * e)
                    }
                },
                back: {
                    style: "cubic-bezier(0.175, 0.885, 0.32, 1.275)",
                    fn: function(e) {
                        var t = 4;
                        return (e -= 1) * e * ((t + 1) * e + t) + 1
                    }
                },
                bounce: {
                    style: "",
                    fn: function(e) {
                        return (e /= 1) < 1 / 2.75 ? 7.5625 * e * e: e < 2 / 2.75 ? 7.5625 * (e -= 1.5 / 2.75) * e + .75 : e < 2.5 / 2.75 ? 7.5625 * (e -= 2.25 / 2.75) * e + .9375 : 7.5625 * (e -= 2.625 / 2.75) * e + .984375
                    }
                },
                elastic: {
                    style: "",
                    fn: function(e) {
                        var t = .22,
                        r = .4;
                        return e === 0 ? 0 : e == 1 ? 1 : r * n.pow(2, -10 * e) * n.sin((e - t / 4) * 2 * n.PI / t) + 1
                    }
                }
            }),
            r.tap = function(e, n) {
                var r = t.createEvent("Event");
                r.initEvent(n, !0, !0),
                r.pageX = e.pageX,
                r.pageY = e.pageY,
                e.target.dispatchEvent(r)
            },
            r.click = function(e) {
                var n = e.target,
                r;
                /(SELECT|INPUT|TEXTAREA)/i.test(n.tagName) || (r = t.createEvent("MouseEvents"), r.initMouseEvent("click", !0, !0, e.view, 1, n.screenX, n.screenY, n.clientX, n.clientY, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, 0, null), r._constructed = !0, n.dispatchEvent(r))
            },
            r
        } ();
        s.prototype = {
            version: "5.1.1",
            _init: function() {
                this._initEvents(),
                (this.options.scrollbars || this.options.indicators) && this._initIndicators(),
                this.options.mouseWheel && this._initWheel(),
                this.options.snap && this._initSnap(),
                this.options.keyBindings && this._initKeys()
            },
            destroy: function() {
                this._initEvents(!0),
                this._execEvent("destroy")
            },
            _transitionEnd: function(e) {
                if (e.target != this.scroller || !this.isInTransition) return;
                this._transitionTime(),
                this.resetPosition(this.options.bounceTime) || (this.isInTransition = !1, this._execEvent("scrollEnd"))
            },
            _start: function(e) {
                if (i.eventType[e.type] != 1 && e.button !== 0) return;
                if (!this.enabled || this.initiated && i.eventType[e.type] !== this.initiated) return;
                this.options.preventDefault && !i.isBadAndroid && !i.preventDefaultException(e.target, this.options.preventDefaultException) && e.preventDefault();
                var t = e.touches ? e.touches[0] : e,
                r;
                this.initiated = i.eventType[e.type],
                this.moved = !1,
                this.distX = 0,
                this.distY = 0,
                this.directionX = 0,
                this.directionY = 0,
                this.directionLocked = 0,
                this._transitionTime(),
                this.startTime = i.getTime(),
                this.options.useTransition && this.isInTransition ? (this.isInTransition = !1, r = this.getComputedPosition(), this._translate(n.round(r.x), n.round(r.y)), this._execEvent("scrollEnd")) : !this.options.useTransition && this.isAnimating && (this.isAnimating = !1, this._execEvent("scrollEnd")),
                this.startX = this.x,
                this.startY = this.y,
                this.absStartX = this.x,
                this.absStartY = this.y,
                this.pointX = t.pageX,
                this.pointY = t.pageY,
                this._execEvent("beforeScrollStart")
            },
            _move: function(e) {
                if (!this.enabled || i.eventType[e.type] !== this.initiated) return;
                this.options.preventDefault && e.preventDefault();
                var t = e.touches ? e.touches[0] : e,
                r = t.pageX - this.pointX,
                s = t.pageY - this.pointY,
                o = i.getTime(),
                u,
                a,
                f,
                l;
                this.pointX = t.pageX,
                this.pointY = t.pageY,
                this.distX += r,
                this.distY += s,
                f = n.abs(this.distX),
                l = n.abs(this.distY);
                if (o - this.endTime > 300 && f < 10 && l < 10) return; ! this.directionLocked && !this.options.freeScroll && (f > l + this.options.directionLockThreshold ? this.directionLocked = "h": l >= f + this.options.directionLockThreshold ? this.directionLocked = "v": this.directionLocked = "n");
                if (this.directionLocked == "h") {
                    if (this.options.eventPassthrough == "vertical") e.preventDefault();
                    else if (this.options.eventPassthrough == "horizontal") {
                        this.initiated = !1;
                        return
                    }
                    s = 0
                } else if (this.directionLocked == "v") {
                    if (this.options.eventPassthrough == "horizontal") e.preventDefault();
                    else if (this.options.eventPassthrough == "vertical") {
                        this.initiated = !1;
                        return
                    }
                    r = 0
                }
                r = this.hasHorizontalScroll ? r: 0,
                s = this.hasVerticalScroll ? s: 0,
                u = this.x + r,
                a = this.y + s;
                if (u > 0 || u < this.maxScrollX) u = this.options.bounce ? this.x + r / 3 : u > 0 ? 0 : this.maxScrollX;
                if (a > 0 || a < this.maxScrollY) a = this.options.bounce ? this.y + s / 3 : a > 0 ? 0 : this.maxScrollY;
                this.directionX = r > 0 ? -1 : r < 0 ? 1 : 0,
                this.directionY = s > 0 ? -1 : s < 0 ? 1 : 0,
                this.moved || this._execEvent("scrollStart"),
                this.moved = !0,
                this._translate(u, a),
                o - this.startTime > 300 && (this.startTime = o, this.startX = this.x, this.startY = this.y)
            },
            _end: function(e) {
                if (!this.enabled || i.eventType[e.type] !== this.initiated) return;
                this.options.preventDefault && !i.preventDefaultException(e.target, this.options.preventDefaultException) && e.preventDefault();
                var t = e.changedTouches ? e.changedTouches[0] : e,
                r,
                s,
                o = i.getTime() - this.startTime,
                u = n.round(this.x),
                a = n.round(this.y),
                f = n.abs(u - this.startX),
                l = n.abs(a - this.startY),
                c = 0,
                h = "";
                this.isInTransition = 0,
                this.initiated = 0,
                this.endTime = i.getTime();
                if (this.resetPosition(this.options.bounceTime)) return;
                this.scrollTo(u, a);
                if (!this.moved) {
                    this.options.tap && i.tap(e, this.options.tap),
                    this.options.click && i.click(e),
                    this._execEvent("scrollCancel");
                    return
                }
                if (this._events.flick && o < 200 && f < 100 && l < 100) {
                    this._execEvent("flick");
                    return
                }
                this.options.momentum && o < 300 && (r = this.hasHorizontalScroll ? i.momentum(this.x, this.startX, o, this.maxScrollX, this.options.bounce ? this.wrapperWidth: 0, this.options.deceleration) : {
                    destination: u,
                    duration: 0
                },
                s = this.hasVerticalScroll ? i.momentum(this.y, this.startY, o, this.maxScrollY, this.options.bounce ? this.wrapperHeight: 0, this.options.deceleration) : {
                    destination: a,
                    duration: 0
                },
                u = r.destination, a = s.destination, c = n.max(r.duration, s.duration), this.isInTransition = 1);
                if (this.options.snap) {
                    var p = this._nearestSnap(u, a);
                    this.currentPage = p,
                    c = this.options.snapSpeed || n.max(n.max(n.min(n.abs(u - p.x), 1e3), n.min(n.abs(a - p.y), 1e3)), 300),
                    u = p.x,
                    a = p.y,
                    this.directionX = 0,
                    this.directionY = 0,
                    h = this.options.bounceEasing
                }
                if (u != this.x || a != this.y) {
                    if (u > 0 || u < this.maxScrollX || a > 0 || a < this.maxScrollY) h = i.ease.quadratic;
                    this.scrollTo(u, a, c, h);
                    return
                }
                this._execEvent("scrollEnd")
            },
            _resize: function() {
                var e = this;
                clearTimeout(this.resizeTimeout),
                this.resizeTimeout = setTimeout(function() {
                    e.refresh()
                },
                this.options.resizePolling)
            },
            resetPosition: function(e) {
                var t = this.x,
                n = this.y;
                return e = e || 0,
                !this.hasHorizontalScroll || this.x > 0 ? t = 0 : this.x < this.maxScrollX && (t = this.maxScrollX),
                !this.hasVerticalScroll || this.y > 0 ? n = 0 : this.y < this.maxScrollY && (n = this.maxScrollY),
                t == this.x && n == this.y ? !1 : (this.scrollTo(t, n, e, this.options.bounceEasing), !0)
            },
            disable: function() {
                this.enabled = !1
            },
            enable: function() {
                this.enabled = !0
            },
            refresh: function() {
                var e = this.wrapper.offsetHeight;
                this.wrapperWidth = this.wrapper.clientWidth,
                this.wrapperHeight = this.wrapper.clientHeight,
                this.scrollerWidth = this.scroller.offsetWidth,
                this.scrollerHeight = this.scroller.offsetHeight,
                this.maxScrollX = this.wrapperWidth - this.scrollerWidth,
                this.maxScrollY = this.wrapperHeight - this.scrollerHeight,
                this.hasHorizontalScroll = this.options.scrollX && this.maxScrollX < 0,
                this.hasVerticalScroll = this.options.scrollY && this.maxScrollY < 0,
                this.hasHorizontalScroll || (this.maxScrollX = 0, this.scrollerWidth = this.wrapperWidth),
                this.hasVerticalScroll || (this.maxScrollY = 0, this.scrollerHeight = this.wrapperHeight),
                this.endTime = 0,
                this.directionX = 0,
                this.directionY = 0,
                this.wrapperOffset = i.offset(this.wrapper),
                this._execEvent("refresh"),
                this.resetPosition()
            },
            on: function(e, t) {
                this._events[e] || (this._events[e] = []),
                this._events[e].push(t)
            },
            off: function(e, t) {
                if (!this._events[e]) return;
                var n = this._events[e].indexOf(t);
                n > -1 && this._events[e].splice(n, 1)
            },
            _execEvent: function(e) {
                if (!this._events[e]) return;
                var t = 0,
                n = this._events[e].length;
                if (!n) return;
                for (; t < n; t++) this._events[e][t].apply(this, [].slice.call(arguments, 1))
            },
            scrollBy: function(e, t, n, r) {
                e = this.x + e,
                t = this.y + t,
                n = n || 0,
                this.scrollTo(e, t, n, r)
            },
            scrollTo: function(e, t, n, r) {
                r = r || i.ease.circular,
                this.isInTransition = this.options.useTransition && n > 0,
                !n || this.options.useTransition && r.style ? (this._transitionTimingFunction(r.style), this._transitionTime(n), this._translate(e, t)) : this._animate(e, t, n, r.fn)
            },
            scrollToElement: function(e, t, r, s, o) {
                e = e.nodeType ? e: this.scroller.querySelector(e);
                if (!e) return;
                var u = i.offset(e);
                u.left -= this.wrapperOffset.left,
                u.top -= this.wrapperOffset.top,
                r === !0 && (r = n.round(e.offsetWidth / 2 - this.wrapper.offsetWidth / 2)),
                s === !0 && (s = n.round(e.offsetHeight / 2 - this.wrapper.offsetHeight / 2)),
                u.left -= r || 0,
                u.top -= s || 0,
                u.left = u.left > 0 ? 0 : u.left < this.maxScrollX ? this.maxScrollX: u.left,
                u.top = u.top > 0 ? 0 : u.top < this.maxScrollY ? this.maxScrollY: u.top,
                t = t === undefined || t === null || t === "auto" ? n.max(n.abs(this.x - u.left), n.abs(this.y - u.top)) : t,
                this.scrollTo(u.left, u.top, t, o)
            },
            _transitionTime: function(e) {
                e = e || 0,
                this.scrollerStyle[i.style.transitionDuration] = e + "ms",
                !e && i.isBadAndroid && (this.scrollerStyle[i.style.transitionDuration] = "0.001s");
                if (this.indicators) for (var t = this.indicators.length; t--;) this.indicators[t].transitionTime(e)
            },
            _transitionTimingFunction: function(e) {
                this.scrollerStyle[i.style.transitionTimingFunction] = e;
                if (this.indicators) for (var t = this.indicators.length; t--;) this.indicators[t].transitionTimingFunction(e)
            },
            _translate: function(e, t) {
                this.options.useTransform ? this.scrollerStyle[i.style.transform] = "translate(" + e + "px," + t + "px)" + this.translateZ: (e = n.round(e), t = n.round(t), this.scrollerStyle.left = e + "px", this.scrollerStyle.top = t + "px"),
                this.x = e,
                this.y = t;
                if (this.indicators) for (var r = this.indicators.length; r--;) this.indicators[r].updatePosition()
            },
            _initEvents: function(t) {
                var n = t ? i.removeEvent: i.addEvent,
                r = this.options.bindToWrapper ? this.wrapper: e;
                n(e, "orientationchange", this),
                n(e, "resize", this),
                this.options.click && n(this.wrapper, "click", this, !0),
                this.options.disableMouse || (n(this.wrapper, "mousedown", this), n(r, "mousemove", this), n(r, "mousecancel", this), n(r, "mouseup", this)),
                i.hasPointer && !this.options.disablePointer && (n(this.wrapper, "MSPointerDown", this), n(r, "MSPointerMove", this), n(r, "MSPointerCancel", this), n(r, "MSPointerUp", this)),
                i.hasTouch && !this.options.disableTouch && (n(this.wrapper, "touchstart", this), n(r, "touchmove", this), n(r, "touchcancel", this), n(r, "touchend", this)),
                n(this.scroller, "transitionend", this),
                n(this.scroller, "webkitTransitionEnd", this),
                n(this.scroller, "oTransitionEnd", this),
                n(this.scroller, "MSTransitionEnd", this)
            },
            getComputedPosition: function() {
                var t = e.getComputedStyle(this.scroller, null),
                n,
                r;
                return this.options.useTransform ? (t = t[i.style.transform].split(")")[0].split(", "), n = +(t[12] || t[4]), r = +(t[13] || t[5])) : (n = +t.left.replace(/[^-\d.]/g, ""), r = +t.top.replace(/[^-\d.]/g, "")),
                {
                    x: n,
                    y: r
                }
            },
            _initIndicators: function() {
                function a(e) {
                    for (var t = i.indicators.length; t--;) e.call(i.indicators[t])
                }
                var e = this.options.interactiveScrollbars,
                t = typeof this.options.scrollbars != "string",
                n = [],
                r,
                i = this;
                this.indicators = [],
                this.options.scrollbars && (this.options.scrollY && (r = {
                    el: o("v", e, this.options.scrollbars),
                    interactive: e,
                    defaultScrollbars: !0,
                    customStyle: t,
                    resize: this.options.resizeScrollbars,
                    shrink: this.options.shrinkScrollbars,
                    fade: this.options.fadeScrollbars,
                    listenX: !1
                },
                this.wrapper.appendChild(r.el), n.push(r)), this.options.scrollX && (r = {
                    el: o("h", e, this.options.scrollbars),
                    interactive: e,
                    defaultScrollbars: !0,
                    customStyle: t,
                    resize: this.options.resizeScrollbars,
                    shrink: this.options.shrinkScrollbars,
                    fade: this.options.fadeScrollbars,
                    listenY: !1
                },
                this.wrapper.appendChild(r.el), n.push(r))),
                this.options.indicators && (n = n.concat(this.options.indicators));
                for (var s = n.length; s--;) this.indicators.push(new u(this, n[s]));
                this.options.fadeScrollbars && (this.on("scrollEnd",
                function() {
                    a(function() {
                        this.fade()
                    })
                }), this.on("scrollCancel",
                function() {
                    a(function() {
                        this.fade()
                    })
                }), this.on("scrollStart",
                function() {
                    a(function() {
                        this.fade(1)
                    })
                }), this.on("beforeScrollStart",
                function() {
                    a(function() {
                        this.fade(1, !0)
                    })
                })),
                this.on("refresh",
                function() {
                    a(function() {
                        this.refresh()
                    })
                }),
                this.on("destroy",
                function() {
                    a(function() {
                        this.destroy()
                    }),
                    delete this.indicators
                })
            },
            _initWheel: function() {
                i.addEvent(this.wrapper, "wheel", this),
                i.addEvent(this.wrapper, "mousewheel", this),
                i.addEvent(this.wrapper, "DOMMouseScroll", this),
                this.on("destroy",
                function() {
                    i.removeEvent(this.wrapper, "wheel", this),
                    i.removeEvent(this.wrapper, "mousewheel", this),
                    i.removeEvent(this.wrapper, "DOMMouseScroll", this)
                })
            },
            _wheel: function(e) {
                if (!this.enabled) return;
                e.preventDefault(),
                e.stopPropagation();
                var t, r, i, s, o = this;
                this.wheelTimeout === undefined && o._execEvent("scrollStart"),
                clearTimeout(this.wheelTimeout),
                this.wheelTimeout = setTimeout(function() {
                    o._execEvent("scrollEnd"),
                    o.wheelTimeout = undefined
                },
                400);
                if ("deltaX" in e) t = -e.deltaX,
                r = -e.deltaY;
                else if ("wheelDeltaX" in e) t = e.wheelDeltaX / 120 * this.options.mouseWheelSpeed,
                r = e.wheelDeltaY / 120 * this.options.mouseWheelSpeed;
                else if ("wheelDelta" in e) t = r = e.wheelDelta / 120 * this.options.mouseWheelSpeed;
                else {
                    if (! ("detail" in e)) return;
                    t = r = -e.detail / 3 * this.options.mouseWheelSpeed
                }
                t *= this.options.invertWheelDirection,
                r *= this.options.invertWheelDirection,
                this.hasVerticalScroll || (t = r, r = 0);
                if (this.options.snap) {
                    i = this.currentPage.pageX,
                    s = this.currentPage.pageY,
                    t > 0 ? i--:t < 0 && i++,
                    r > 0 ? s--:r < 0 && s++,
                    this.goToPage(i, s);
                    return
                }
                i = this.x + n.round(this.hasHorizontalScroll ? t: 0),
                s = this.y + n.round(this.hasVerticalScroll ? r: 0),
                i > 0 ? i = 0 : i < this.maxScrollX && (i = this.maxScrollX),
                s > 0 ? s = 0 : s < this.maxScrollY && (s = this.maxScrollY),
                this.scrollTo(i, s, 0)
            },
            _initSnap: function() {
                this.currentPage = {},
                typeof this.options.snap == "string" && (this.options.snap = this.scroller.querySelectorAll(this.options.snap)),
                this.on("refresh",
                function() {
                    var e = 0,
                    t, r = 0,
                    i, s, o, u = 0,
                    a, f = this.options.snapStepX || this.wrapperWidth,
                    l = this.options.snapStepY || this.wrapperHeight,
                    c;
                    this.pages = [];
                    if (!this.wrapperWidth || !this.wrapperHeight || !this.scrollerWidth || !this.scrollerHeight) return;
                    if (this.options.snap === !0) {
                        s = n.round(f / 2),
                        o = n.round(l / 2);
                        while (u > -this.scrollerWidth) {
                            this.pages[e] = [],
                            t = 0,
                            a = 0;
                            while (a > -this.scrollerHeight) this.pages[e][t] = {
                                x: n.max(u, this.maxScrollX),
                                y: n.max(a, this.maxScrollY),
                                width: f,
                                height: l,
                                cx: u - s,
                                cy: a - o
                            },
                            a -= l,
                            t++;
                            u -= f,
                            e++
                        }
                    } else {
                        c = this.options.snap,
                        t = c.length,
                        i = -1;
                        for (; e < t; e++) {
                            if (e === 0 || c[e].offsetLeft <= c[e - 1].offsetLeft) r = 0,
                            i++;
                            this.pages[r] || (this.pages[r] = []),
                            u = n.max( - c[e].offsetLeft, this.maxScrollX),
                            a = n.max( - c[e].offsetTop, this.maxScrollY),
                            s = u - n.round(c[e].offsetWidth / 2),
                            o = a - n.round(c[e].offsetHeight / 2),
                            this.pages[r][i] = {
                                x: u,
                                y: a,
                                width: c[e].offsetWidth,
                                height: c[e].offsetHeight,
                                cx: s,
                                cy: o
                            },
                            u > this.maxScrollX && r++
                        }
                    }
                    this.goToPage(this.currentPage.pageX || 0, this.currentPage.pageY || 0, 0),
                    this.options.snapThreshold % 1 === 0 ? (this.snapThresholdX = this.options.snapThreshold, this.snapThresholdY = this.options.snapThreshold) : (this.snapThresholdX = n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width * this.options.snapThreshold), this.snapThresholdY = n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height * this.options.snapThreshold))
                }),
                this.on("flick",
                function() {
                    var e = this.options.snapSpeed || n.max(n.max(n.min(n.abs(this.x - this.startX), 1e3), n.min(n.abs(this.y - this.startY), 1e3)), 300);
                    this.goToPage(this.currentPage.pageX + this.directionX, this.currentPage.pageY + this.directionY, e)
                })
            },
            _nearestSnap: function(e, t) {
                if (!this.pages.length) return {
                    x: 0,
                    y: 0,
                    pageX: 0,
                    pageY: 0
                };
                var r = 0,
                i = this.pages.length,
                s = 0;
                if (n.abs(e - this.absStartX) < this.snapThresholdX && n.abs(t - this.absStartY) < this.snapThresholdY) return this.currentPage;
                e > 0 ? e = 0 : e < this.maxScrollX && (e = this.maxScrollX),
                t > 0 ? t = 0 : t < this.maxScrollY && (t = this.maxScrollY);
                for (; r < i; r++) if (e >= this.pages[r][0].cx) {
                    e = this.pages[r][0].x;
                    break
                }
                i = this.pages[r].length;
                for (; s < i; s++) if (t >= this.pages[0][s].cy) {
                    t = this.pages[0][s].y;
                    break
                }
                return r == this.currentPage.pageX && (r += this.directionX, r < 0 ? r = 0 : r >= this.pages.length && (r = this.pages.length - 1), e = this.pages[r][0].x),
                s == this.currentPage.pageY && (s += this.directionY, s < 0 ? s = 0 : s >= this.pages[0].length && (s = this.pages[0].length - 1), t = this.pages[0][s].y),
                {
                    x: e,
                    y: t,
                    pageX: r,
                    pageY: s
                }
            },
            goToPage: function(e, t, r, i) {
                i = i || this.options.bounceEasing,
                e >= this.pages.length ? e = this.pages.length - 1 : e < 0 && (e = 0),
                t >= this.pages[e].length ? t = this.pages[e].length - 1 : t < 0 && (t = 0);
                var s = this.pages[e][t].x,
                o = this.pages[e][t].y;
                r = r === undefined ? this.options.snapSpeed || n.max(n.max(n.min(n.abs(s - this.x), 1e3), n.min(n.abs(o - this.y), 1e3)), 300) : r,
                this.currentPage = {
                    x: s,
                    y: o,
                    pageX: e,
                    pageY: t
                },
                this.scrollTo(s, o, r, i)
            },
            next: function(e, t) {
                var n = this.currentPage.pageX,
                r = this.currentPage.pageY;
                n++,
                n >= this.pages.length && this.hasVerticalScroll && (n = 0, r++),
                this.goToPage(n, r, e, t)
            },
            prev: function(e, t) {
                var n = this.currentPage.pageX,
                r = this.currentPage.pageY;
                n--,
                n < 0 && this.hasVerticalScroll && (n = 0, r--),
                this.goToPage(n, r, e, t)
            },
            _initKeys: function(t) {
                var n = {
                    pageUp: 33,
                    pageDown: 34,
                    end: 35,
                    home: 36,
                    left: 37,
                    up: 38,
                    right: 39,
                    down: 40
                },
                r;
                if (typeof this.options.keyBindings == "object") for (r in this.options.keyBindings) typeof this.options.keyBindings[r] == "string" && (this.options.keyBindings[r] = this.options.keyBindings[r].toUpperCase().charCodeAt(0));
                else this.options.keyBindings = {};
                for (r in n) this.options.keyBindings[r] = this.options.keyBindings[r] || n[r];
                i.addEvent(e, "keydown", this),
                this.on("destroy",
                function() {
                    i.removeEvent(e, "keydown", this)
                })
            },
            _key: function(e) {
                if (!this.enabled) return;
                var t = this.options.snap,
                r = t ? this.currentPage.pageX: this.x,
                s = t ? this.currentPage.pageY: this.y,
                o = i.getTime(),
                u = this.keyTime || 0,
                a = .25,
                f;
                this.options.useTransition && this.isInTransition && (f = this.getComputedPosition(), this._translate(n.round(f.x), n.round(f.y)), this.isInTransition = !1),
                this.keyAcceleration = o - u < 200 ? n.min(this.keyAcceleration + a, 50) : 0;
                switch (e.keyCode) {
                case this.options.keyBindings.pageUp:
                    this.hasHorizontalScroll && !this.hasVerticalScroll ? r += t ? 1 : this.wrapperWidth: s += t ? 1 : this.wrapperHeight;
                    break;
                case this.options.keyBindings.pageDown:
                    this.hasHorizontalScroll && !this.hasVerticalScroll ? r -= t ? 1 : this.wrapperWidth: s -= t ? 1 : this.wrapperHeight;
                    break;
                case this.options.keyBindings.end:
                    r = t ? this.pages.length - 1 : this.maxScrollX,
                    s = t ? this.pages[0].length - 1 : this.maxScrollY;
                    break;
                case this.options.keyBindings.home:
                    r = 0,
                    s = 0;
                    break;
                case this.options.keyBindings.left:
                    r += t ? -1 : 5 + this.keyAcceleration >> 0;
                    break;
                case this.options.keyBindings.up:
                    s += t ? 1 : 5 + this.keyAcceleration >> 0;
                    break;
                case this.options.keyBindings.right:
                    r -= t ? -1 : 5 + this.keyAcceleration >> 0;
                    break;
                case this.options.keyBindings.down:
                    s -= t ? 1 : 5 + this.keyAcceleration >> 0;
                    break;
                default:
                    return
                }
                if (t) {
                    this.goToPage(r, s);
                    return
                }
                r > 0 ? (r = 0, this.keyAcceleration = 0) : r < this.maxScrollX && (r = this.maxScrollX, this.keyAcceleration = 0),
                s > 0 ? (s = 0, this.keyAcceleration = 0) : s < this.maxScrollY && (s = this.maxScrollY, this.keyAcceleration = 0),
                this.scrollTo(r, s, 0),
                this.keyTime = o
            },
            _animate: function(e, t, n, s) {
                function c() {
                    var h = i.getTime(),
                    p,
                    d,
                    v;
                    if (h >= l) {
                        o.isAnimating = !1,
                        o._translate(e, t),
                        o.resetPosition(o.options.bounceTime) || o._execEvent("scrollEnd");
                        return
                    }
                    h = (h - f) / n,
                    v = s(h),
                    p = (e - u) * v + u,
                    d = (t - a) * v + a,
                    o._translate(p, d),
                    o.isAnimating && r(c)
                }
                var o = this,
                u = this.x,
                a = this.y,
                f = i.getTime(),
                l = f + n;
                this.isAnimating = !0,
                c()
            },
            handleEvent: function(e) {
                switch (e.type) {
                case "touchstart":
                case "MSPointerDown":
                case "mousedown":
                    this._start(e);
                    break;
                case "touchmove":
                case "MSPointerMove":
                case "mousemove":
                    this._move(e);
                    break;
                case "touchend":
                case "MSPointerUp":
                case "mouseup":
                case "touchcancel":
                case "MSPointerCancel":
                case "mousecancel":
                    this._end(e);
                    break;
                case "orientationchange":
                case "resize":
                    this._resize();
                    break;
                case "transitionend":
                case "webkitTransitionEnd":
                case "oTransitionEnd":
                case "MSTransitionEnd":
                    this._transitionEnd(e);
                    break;
                case "wheel":
                case "DOMMouseScroll":
                case "mousewheel":
                    this._wheel(e);
                    break;
                case "keydown":
                    this._key(e);
                    break;
                case "click":
                    e._constructed || (e.preventDefault(), e.stopPropagation())
                }
            }
        },
        u.prototype = {
            handleEvent: function(e) {
                switch (e.type) {
                case "touchstart":
                case "MSPointerDown":
                case "mousedown":
                    this._start(e);
                    break;
                case "touchmove":
                case "MSPointerMove":
                case "mousemove":
                    this._move(e);
                    break;
                case "touchend":
                case "MSPointerUp":
                case "mouseup":
                case "touchcancel":
                case "MSPointerCancel":
                case "mousecancel":
                    this._end(e)
                }
            },
            destroy: function() {
                this.options.interactive && (i.removeEvent(this.indicator, "touchstart", this), i.removeEvent(this.indicator, "MSPointerDown", this), i.removeEvent(this.indicator, "mousedown", this), i.removeEvent(e, "touchmove", this), i.removeEvent(e, "MSPointerMove", this), i.removeEvent(e, "mousemove", this), i.removeEvent(e, "touchend", this), i.removeEvent(e, "MSPointerUp", this), i.removeEvent(e, "mouseup", this)),
                this.options.defaultScrollbars && this.wrapper.parentNode.removeChild(this.wrapper)
            },
            _start: function(t) {
                var n = t.touches ? t.touches[0] : t;
                t.preventDefault(),
                t.stopPropagation(),
                this.transitionTime(),
                this.initiated = !0,
                this.moved = !1,
                this.lastPointX = n.pageX,
                this.lastPointY = n.pageY,
                this.startTime = i.getTime(),
                this.options.disableTouch || i.addEvent(e, "touchmove", this),
                this.options.disablePointer || i.addEvent(e, "MSPointerMove", this),
                this.options.disableMouse || i.addEvent(e, "mousemove", this),
                this.scroller._execEvent("beforeScrollStart")
            },
            _move: function(e) {
                var t = e.touches ? e.touches[0] : e,
                n,
                r,
                s,
                o,
                u = i.getTime();
                this.moved || this.scroller._execEvent("scrollStart"),
                this.moved = !0,
                n = t.pageX - this.lastPointX,
                this.lastPointX = t.pageX,
                r = t.pageY - this.lastPointY,
                this.lastPointY = t.pageY,
                s = this.x + n,
                o = this.y + r,
                this._pos(s, o),
                e.preventDefault(),
                e.stopPropagation()
            },
            _end: function(t) {
                if (!this.initiated) return;
                this.initiated = !1,
                t.preventDefault(),
                t.stopPropagation(),
                i.removeEvent(e, "touchmove", this),
                i.removeEvent(e, "MSPointerMove", this),
                i.removeEvent(e, "mousemove", this);
                if (this.scroller.options.snap) {
                    var r = this.scroller._nearestSnap(this.scroller.x, this.scroller.y),
                    s = this.options.snapSpeed || n.max(n.max(n.min(n.abs(this.scroller.x - r.x), 1e3), n.min(n.abs(this.scroller.y - r.y), 1e3)), 300);
                    if (this.scroller.x != r.x || this.scroller.y != r.y) this.scroller.directionX = 0,
                    this.scroller.directionY = 0,
                    this.scroller.currentPage = r,
                    this.scroller.scrollTo(r.x, r.y, s, this.scroller.options.bounceEasing)
                }
                this.moved && this.scroller._execEvent("scrollEnd")
            },
            transitionTime: function(e) {
                e = e || 0,
                this.indicatorStyle[i.style.transitionDuration] = e + "ms",
                !e && i.isBadAndroid && (this.indicatorStyle[i.style.transitionDuration] = "0.001s")
            },
            transitionTimingFunction: function(e) {
                this.indicatorStyle[i.style.transitionTimingFunction] = e
            },
            refresh: function() {
                this.transitionTime(),
                this.options.listenX && !this.options.listenY ? this.indicatorStyle.display = this.scroller.hasHorizontalScroll ? "block": "none": this.options.listenY && !this.options.listenX ? this.indicatorStyle.display = this.scroller.hasVerticalScroll ? "block": "none": this.indicatorStyle.display = this.scroller.hasHorizontalScroll || this.scroller.hasVerticalScroll ? "block": "none",
                this.scroller.hasHorizontalScroll && this.scroller.hasVerticalScroll ? (i.addClass(this.wrapper, "iScrollBothScrollbars"), i.removeClass(this.wrapper, "iScrollLoneScrollbar"), this.options.defaultScrollbars && this.options.customStyle && (this.options.listenX ? this.wrapper.style.right = "8px": this.wrapper.style.bottom = "8px")) : (i.removeClass(this.wrapper, "iScrollBothScrollbars"), i.addClass(this.wrapper, "iScrollLoneScrollbar"), this.options.defaultScrollbars && this.options.customStyle && (this.options.listenX ? this.wrapper.style.right = "2px": this.wrapper.style.bottom = "2px"));
                var e = this.wrapper.offsetHeight;
                this.options.listenX && (this.wrapperWidth = this.wrapper.clientWidth, this.options.resize ? (this.indicatorWidth = n.max(n.round(this.wrapperWidth * this.wrapperWidth / (this.scroller.scrollerWidth || this.wrapperWidth || 1)), 8), this.indicatorStyle.width = this.indicatorWidth + "px") : this.indicatorWidth = this.indicator.clientWidth, this.maxPosX = this.wrapperWidth - this.indicatorWidth, this.options.shrink == "clip" ? (this.minBoundaryX = -this.indicatorWidth + 8, this.maxBoundaryX = this.wrapperWidth - 8) : (this.minBoundaryX = 0, this.maxBoundaryX = this.maxPosX), this.sizeRatioX = this.options.speedRatioX || this.scroller.maxScrollX && this.maxPosX / this.scroller.maxScrollX),
                this.options.listenY && (this.wrapperHeight = this.wrapper.clientHeight, this.options.resize ? (this.indicatorHeight = n.max(n.round(this.wrapperHeight * this.wrapperHeight / (this.scroller.scrollerHeight || this.wrapperHeight || 1)), 8), this.indicatorStyle.height = this.indicatorHeight + "px") : this.indicatorHeight = this.indicator.clientHeight, this.maxPosY = this.wrapperHeight - this.indicatorHeight, this.options.shrink == "clip" ? (this.minBoundaryY = -this.indicatorHeight + 8, this.maxBoundaryY = this.wrapperHeight - 8) : (this.minBoundaryY = 0, this.maxBoundaryY = this.maxPosY), this.maxPosY = this.wrapperHeight - this.indicatorHeight, this.sizeRatioY = this.options.speedRatioY || this.scroller.maxScrollY && this.maxPosY / this.scroller.maxScrollY),
                this.updatePosition()
            },
            updatePosition: function() {
                var e = this.options.listenX && n.round(this.sizeRatioX * this.scroller.x) || 0,
                t = this.options.listenY && n.round(this.sizeRatioY * this.scroller.y) || 0;
                this.options.ignoreBoundaries || (e < this.minBoundaryX ? (this.options.shrink == "scale" && (this.width = n.max(this.indicatorWidth + e, 8), this.indicatorStyle.width = this.width + "px"), e = this.minBoundaryX) : e > this.maxBoundaryX ? this.options.shrink == "scale" ? (this.width = n.max(this.indicatorWidth - (e - this.maxPosX), 8), this.indicatorStyle.width = this.width + "px", e = this.maxPosX + this.indicatorWidth - this.width) : e = this.maxBoundaryX: this.options.shrink == "scale" && this.width != this.indicatorWidth && (this.width = this.indicatorWidth, this.indicatorStyle.width = this.width + "px"), t < this.minBoundaryY ? (this.options.shrink == "scale" && (this.height = n.max(this.indicatorHeight + t * 3, 8), this.indicatorStyle.height = this.height + "px"), t = this.minBoundaryY) : t > this.maxBoundaryY ? this.options.shrink == "scale" ? (this.height = n.max(this.indicatorHeight - (t - this.maxPosY) * 3, 8), this.indicatorStyle.height = this.height + "px", t = this.maxPosY + this.indicatorHeight - this.height) : t = this.maxBoundaryY: this.options.shrink == "scale" && this.height != this.indicatorHeight && (this.height = this.indicatorHeight, this.indicatorStyle.height = this.height + "px")),
                this.x = e,
                this.y = t,
                this.scroller.options.useTransform ? this.indicatorStyle[i.style.transform] = "translate(" + e + "px," + t + "px)" + this.scroller.translateZ: (this.indicatorStyle.left = e + "px", this.indicatorStyle.top = t + "px")
            },
            _pos: function(e, t) {
                e < 0 ? e = 0 : e > this.maxPosX && (e = this.maxPosX),
                t < 0 ? t = 0 : t > this.maxPosY && (t = this.maxPosY),
                e = this.options.listenX ? n.round(e / this.sizeRatioX) : this.scroller.x,
                t = this.options.listenY ? n.round(t / this.sizeRatioY) : this.scroller.y,
                this.scroller.scrollTo(e, t)
            },
            fade: function(e, t) {
                if (t && !this.visible) return;
                clearTimeout(this.fadeTimeout),
                this.fadeTimeout = null;
                var n = e ? 250 : 500,
                r = e ? 0 : 300;
                e = e ? "1": "0",
                this.wrapperStyle[i.style.transitionDuration] = n + "ms",
                this.fadeTimeout = setTimeout(function(e) {
                    this.wrapperStyle.opacity = e,
                    this.visible = +e
                }.bind(this, e), r)
            }
        },
        s.utils = i,
        typeof module != "undefined" && module.exports ? module.exports = s: e.IScroll = s
    } (window, document, Math)
}),
define("views/vacationslist", ["libs", "c", "cBasePageView", "text!templates/vacationslist.html", "text!templates/shaixuan.html", "text!templates/filterlist.html", "text!templates/fakeVlist.html", "TourModel", "TourStore", "cWidgetFactory", "cWidgetGeolocation", "res/data/cities", "cUIScrollRadio", "res/data/iscroll", "cWidgetGuider"],
function(e, t, n, r, i, s, o, u, a, f, l, c, h) {
    function pt(e, t) {
        var n = 1,
        r = [],
        i = [];
        if (!e || !t || e.length != t.length) ! e && !t ? n = 1 : n = 0;
        else {
            for (var s = 0,
            o = e.length; s < o; s++) r.push(e[s]);
            for (var u = 0,
            a = t.length; u < a; u++) i.push(t[u]);
            var f = r.length;
            for (var l = 0; l < f; l++) {
                if (!n) break;
                for (var c = 0; c < f; c++) {
                    if ($.type(r[l]) == $.type(i[c])) if ($.type(r[l]) == "object") {
                        var h = 1,
                        p = 1,
                        d = 1;
                        for (var v in r[l]) h += 1,
                        r[l][v] == i[c][v] && (p += 1);
                        for (var m in i[c]) d += 1;
                        if (h == p && h == d) {
                            i.splice(c, 1),
                            r.splice(l, 1),
                            l--,
                            f--;
                            break
                        }
                    } else if (r[l] == i[c]) {
                        i.splice(c, 1),
                        r.splice(l, 1),
                        l--,
                        f--;
                        break
                    }
                    if (c == f - 1) {
                        n = 0;
                        break
                    }
                }
            }
        }
        return n
    }
    var p, d = {
        vLocal: 0,
        vDepart: 0,
        vDestino: 0
    },
    v = {},
    m,
    g,
    y = 26,
    b,
    w,
    E,
    S,
    x,
    T,
    N,
    C,
    k,
    L,
    A,
    O,
    M,
    D,
    P,
    H,
    B,
    j = [],
    F,
    I = {
        B: "目的地",
        U: "行程天数",
        T: "产品等级",
        F: "交通",
        P: "产品类型",
        S: "出发城市",
        L: "游玩线路"
    },
    q = {
        d: "B",
        g: "T",
        h: "F",
        n: "P",
        u: "U"
    },
    R = "上海",
    U = 2,
    z = a.ProdListParamStore.getInstance(),
    W = z.get() || {
        vLocal: {},
        vDepart: {},
        vDestino: {}
    },
    X = f.create("Guider"),
    V = a.GeoLocationStore.getInstance(),
    J,
    K,
    Q = ["", "vDepart", "vDestino", "vLocal"],
    G = {
        vLocal: {},
        vDepart: {},
        vDestino: {}
    },
    Y = {
        vLocal: {},
        vDepart: {},
        vDestino: {}
    },
    Z = {
        vLocal: {},
        vDepart: {},
        vDestino: {}
    },
    et = {
        vLocal: 0,
        vDepart: 0,
        vDestino: 0
    },
    tt = {
        vLocal: 0,
        vDepart: 0,
        vDestino: 0
    },
    nt = {
        vLocal: 0,
        vDepart: 0,
        vDestino: 0
    },
    rt = {
        vLocal: {},
        vDepart: {},
        vDestino: {}
    },
    it = {},
    st = {
        vLocal: 0,
        vDepart: 0,
        vDestino: 0
    },
    ot = {
        vLocal: 1,
        vDepart: 1,
        vDestino: 1
    },
    ut = c.pySort,
    at,
    ft,
    lt = new Date,
    ct = [],
    ht = n.extend({
        hasAd: 1,
        vacationsListModel: u.VacationsListModel.getInstance(),
        pageid: t.utility.isInApp() ? "220079": "220002",
        render: function(e) {
            var t = this.initTemplate();
            this.$el.html(t({
                data: e
            })),
            O = this.$el.find(".base_loading"),
            this._checkImgPos = $.proxy(this.checkImgPos, this)
        },
        onCreate: function() {
            this.injectHeaderView()
        },
        events: {
            "click .districtsum": "districtSelect",
            "click .crecommend": "crecommend",
            "click .shaixuan": "displaySX",
            "touchstart .datecontainer": "disableSXiscroll",
            "touchend .datecontainer": "enableSXiscroll",
            "click .datepicker": "showDatePicker",
            "click .js_onOff": "filterOnOff",
            "click .btn_ok": "filterSubmit",
            "click .btn_reset": "setDefault",
            "click .item_select": "filterSelect",
            "click .list_filter_item": "filterSelectNew",
            "click .triparea": "hideShowTripArea",
            "click .triparealist": "TripAreaSelect",
            "click .hot_list_tab": "detail",
            "click .tpye_tab li": "tabSwitch",
            "click .try_again": "tryAgain",
            "touchstart .warp_z": "warp_zTouch",
            "touchmove .warp_z": "stopMove",
            "touchmove .districtlist": "stopMove",
            "touchstart .product_list_box": "getScroll",
            "touchend .product_list_box": "BarHiding",
            "click .dial_btn": "Dial"
        },
        stopMove: function() {
            event.preventDefault()
        },
        warp_zTouch: function() {
            $(".hide_div_b").hide(),
            $(".crecommend dl").hide(),
            $(".warp_z").hide(),
            this.getOrig()
        },
        getScroll: function() {
            C = event.targetTouches[0].clientY
        },
        BarHiding: function() {
            var e = 0;
            if (event.changedTouches && !$(".districtlist").height()) {
                if ($(".product_list_box").height() > document.body.offsetHeight && C - e > event.changedTouches[0].clientY && document.body.scrollTop > 42) $(".tpye_tab").hasClass("hide") || ($(".tpye_tab").addClass("hide"), $(".footer").addClass("hide")),
                C = event.changedTouches[0].clientY;
                else if (C + e < event.changedTouches[0].clientY || document.body.scrollTop < 42) $(".tpye_tab").hasClass("hide") && ($(".tpye_tab").removeClass("hide"), $(".footer").removeClass("hide")),
                C = event.changedTouches[0].clientY;
                k = undefined
            } else if (!$(".districtlist").height()) {
                k == undefined && (k = document.body.scrollTop);
                if ($(".product_list_box").height() > document.body.offsetHeight && k + e < document.body.scrollTop && document.body.scrollTop > 42) $(".tpye_tab").hasClass("hide") || ($(".tpye_tab").addClass("hide"), $(".footer").addClass("hide")),
                k = document.body.scrollTop;
                else if (k - e > document.body.scrollTop || document.body.scrollTop < 42) $(".tpye_tab").hasClass("hide") && ($(".tpye_tab").removeClass("hide"), $(".footer").removeClass("hide")),
                k = document.body.scrollTop
            }
        },
        getDepartCity: function(e) {
            var t = {
                CityId: U,
                CityName: R
            },
            n = ut.length;
            if (isNaN(e)) {
                for (var r = 0; r < n; r++) if (e.indexOf(ut[r].name) > -1) {
                    t = {
                        CityId: ut[r].id,
                        CityName: ut[r].name
                    };
                    break
                }
            } else for (var i = 0; i < n; i++) if (e == ut[i].id) {
                t = {
                    CityId: ut[i].id,
                    CityName: ut[i].name
                };
                break
            }
            return t
        },
        onLoad: function(e) {
            function l() {
                if (!W.renew && !!v.products && v.products.length && n.vacationsListModel.param.SaleCityId == S && r.departureDate == i.departureDate && r.sortType == i.sortType && b == T && pt(r.qparams, i.qparams) && r.isSale == i.isSale && r.isPromo == i.isPromo && W.selectorId == n.vacationsListModel.param.AddressSelectorId) {
                    var e = N + " - " + (n.vacationsListModel.param.KeyWord == "周边" ? "周边": n.vacationsListModel.param.KeyWord),
                    t = "共" + d[A] + "条",
                    s = {
                        title: L ? e: undefined,
                        subtitle: t,
                        customtitle: L ? undefined: '<h1 class="list">' + e + '<span class="sum">' + t + "</span>" + "</h1>",
                        home: !0,
                        homefunc: function(e) {
                            W.frompage = undefined,
                            z.set(W),
                            n.jump("/html5/")
                        },
                        returnfunc: function() {
                            var e = W.frompage || "";
                            W.frompage = undefined,
                            z.set(W),
                            e ? e == "nopage" ? L ? X.backToLastPage({}) : n.back() : n.jump(e) : n.back("#index")
                        }
                    };
                    clearTimeout(w),
                    n.render(v),
                    n.headerUpdate(s, 1),
                    n.hideLoading(),
                    n.turning(),
                    v.products && v.products.length < y && $(".no_more").show(),
                    $(window).bind("scroll", showNext),
                    n.referrer != "index" && window.scrollTo(n.scrollPos ? n.scrollPos.x: 0, et[A])
                } else Y[A] = {},
                v = {},
                n.getRenderData();
                W.linetype = E,
                W.sCtyId = S || U,
                W.dCtyId = x || S || U,
                W.destKwd = T || "三亚",
                W.dCtyName = N || R,
                W.selectorId == undefined && (W.selectorId = 0),
                z.set(W),
                setTimeout(function() {
                    $(window).bind("scroll",
                    function() {
                        n.BarHiding()
                    })
                },
                0)
            }
            var n = this;
            n.referrer = e || "",
            n.showLoading(),
            W = z.get() || {
                vLocal: {},
                vDepart: {},
                vDestino: {}
            },
            L = t.utility.isInApp(),
            !!n.tabScrollY && (et = n.tabScrollY),
            showNext = function() {
                n.onWindowScroll(n)
            },
            E = ( !! n.getQuery("type") && !isNaN(n.getQuery("type")) ? n.getQuery("type") : W.linetype) || 1;
            if (E - 1 + 1 == 4) E = 3;
            else if (E - 1 + 1 > 4 || E - 1 + 1 < 1) E = 1;
            S = n.getQuery("salecity") || W.sCtyId,
            x = n.getQuery("scity") || W.dCtyId,
            T = n.getQuery("kwd") || W.destKwd,
            N = n.getQuery("sname") || W.dCtyName,
            B = n.getQuery("filter") ? n.getQuery("filter").match(/\D\d+-?\d*/g) : "",
            W.frompage || (W.frompage = n.getQuery("from"), z.set(W)),
            A = Q[E];
            var r = W[A],
            i = G[A];
            v = Y[A],
            j = [],
            F = undefined;
            if (B) {
                var s;
                for (var u = 0,
                a = B.length; u < a; u++) s = B[u].match(/\D|\d+-?\d*/g) || [],
                s.length > 1 && s[0] == "y" ? F = !!(s[1] - 1 + 1) : s.length > 1 && s[0] && j.push({
                    LabelType: q[s[0]],
                    LabelKey: s[1]
                })
            }
            if (x != undefined && isNaN(x)) {
                var f = n.getDepartCity(x);
                x = f.CityId,
                N = f.CityName
            }
            W.renew && (w = setTimeout(function() {
                var e = (N || R) + " - " + ((T == "周边" ? "周边": T) || "三亚"),
                t = {
                    title: e,
                    subtitle: " ",
                    customtitle: L ? undefined: '<h1 class="list">' + e + '<span class="sum">' + " " + "</span>" + "</h1>",
                    home: !0
                };
                n.headerUpdate(t, 1),
                n.$el.html(_.template(o)({
                    data: {
                        isInApp: L
                    }
                })),
                n.turning(),
                n.showLoading()
            },
            500));
            if (S != undefined && (isNaN(S) || !N || n.vacationsListModel.param.SaleCityId != S)) {
                var f = n.getDepartCity(S);
                S = f.CityId,
                N = f.CityName,
                l()
            } else S ? l() : n.Locating(function() {
                var e = V.get();
                e.fail || (S = e.id, N = e.name),
                l()
            })
        },
        getRenderData: function() {
            var e = this,
            n;
            et[A] = 0;
            if (W.renew || e.vacationsListModel.param.SaleCityId != S || e.vacationsListModel.param.KeyWord != T) W.renew = 0,
            W.vLocal = {},
            W.vDepart = {},
            W.vDestino = {},
            z.set(W),
            Y = {
                vLocal: {},
                vDepart: {},
                vDestino: {}
            },
            Z = {
                vLocal: {},
                vDepart: {},
                vDestino: {}
            },
            rt = {
                vLocal: {},
                vDepart: {},
                vDestino: {}
            },
            it = {},
            st = {
                vLocal: 0,
                vDepart: 0,
                vDestino: 0
            },
            ot = {
                vLocal: 1,
                vDepart: 1,
                vDestino: 1
            },
            F = !!L && t.utility.getAppSys && t.utility.getAppSys() == "youth" ? 1 : F;
            n = W[A],
            tt[A] = undefined,
            nt[A] = 0,
            b = T,
            j.length && (n.qparams = j, z.set(W)),
            F != undefined && (n.isPromo = F, z.set(W)),
            e.vacationsListModel.param = {
                SaleCityId: S || U,
                StartCityId: 0,
                KeyWord: (T == "周边" ? "周边": T) || "三亚",
                AddressSelectorId: W.selectorId || 0,
                LineType: E,
                Start: 0,
                ReturnCount: y,
                FilterLabelList: n.qparams && n.qparams.length ? n.qparams: j || [],
                IsSaleMode: n.isSale ? 1 : 0,
                IsPromotions: n.isPromo ? 1 : 0,
                OrderType: n.sortType || 0,
                DepartureDate: n.departureDate
            },
            e.vacationsListModel.excute(function(t) {
                if (t.ResponseStatus && t.ResponseStatus.Ack && t.ResponseStatus.Ack == "Success") {
                    var r = t.Data;
                    d[A] = r.TotalCount;
                    var i = (N || R) + " - " + (e.vacationsListModel.param.KeyWord == "周边" ? "周边": e.vacationsListModel.param.KeyWord),
                    s = "共" + r.TotalCount + "条",
                    o = {
                        title: L ? i: undefined,
                        subtitle: s,
                        customtitle: L ? undefined: '<h1 class="list">' + i + '<span class="sum">' + s + "</span>" + "</h1>",
                        home: !0,
                        homefunc: function(t) {
                            W.frompage = undefined,
                            z.set(W),
                            e.jump("/html5/")
                        },
                        returnfunc: function() {
                            var t = W.frompage || "";
                            W.frompage = undefined,
                            z.set(W),
                            t ? t == "nopage" ? L ? X.backToLastPage({}) : e.back() : e.jump(t) : e.back("#index")
                        }
                    }; ! n || (v.sortType = n.sortType || 0);
                    var u = Z[A];
                    if (JSON.stringify(u) == "{}" && r.FilterLabelList) for (var a = 0,
                    f = r.FilterLabelList.length; a < f; a++) u[r.FilterLabelList[a].LabelType] || (u[r.FilterLabelList[a].LabelType] = []),
                    u[r.FilterLabelList[a].LabelType].push({
                        key: r.FilterLabelList[a].LabelKey,
                        text: r.FilterLabelList[a].LabelText + (r.FilterLabelList[a].LabelType == "U" ? "日": "")
                    });
                    var l = 0,
                    c = e.vacationsListModel.param.FilterLabelList;
                    for (var h = 0,
                    p = c.length; h < p; h++) if (c[h].LabelType == "B" || c[h].LabelType == "G") {
                        l = 1;
                        break
                    } ! st[A] && r.DistrictSum && !l ? (rt[A] = r.DistrictSum, st[A] = 1) : !st[A] && l && ot[A] && (rt[A] = r.DistrictSum || {
                        ParentDistrictList: [],
                        TotalCount: 0
                    },
                    rt[A].TotalCount = 0);
                    if (JSON.stringify(it) == "{}") {
                        it = {
                            vLocal: 0,
                            vDepart: 0,
                            vDestino: 0,
                            tabs: 0
                        };
                        if (r.TabStatisticList) {
                            var m = r.TabStatisticList;
                            for (var a = 0,
                            g = m.length; a < g; a++) {
                                var b = m[a].Value; ! b || (it[Q[m[a].Key]] = m[a].Value, it.tabs += 1)
                            }
                        }
                    }
                    v.products = r.ProductInfoList,
                    v.districtSum = rt[A],
                    v.tabStatistics = it,
                    v.districtSelectedName = n.DSName || "目的地",
                    v.linetype = E,
                    v.localCity = e.vacationsListModel.param.KeyWord,
                    v.sCityId = e.vacationsListModel.param.SaleCityId,
                    v.hasfilter = !!n.isSale || !!n.isPromo || !!n.departureDate || n.qparams && (n.qparams.length > 1 || n.qparams.length == 1 && n.qparams[0].LabelType != "B" && n.qparams[0].LabelType != "G"),
                    v.isInApp = L,
                    v.scrollproductHeight = document.body.offsetHeight - 48,
                    Y[A] = v,
                    clearTimeout(w),
                    e.render(v),
                    e.headerUpdate(o, 1),
                    e.hideLoading(),
                    e.turning(),
                    r.TotalCount < y && (tt[A] = 2, !!r.TotalCount && $(".no_more").show()),
                    G[A] = (z.get() || {
                        vLocal: {},
                        vDepart: {},
                        vDestino: {}
                    })[A],
                    $(window).bind("scroll", showNext)
                } else clearTimeout(w),
                e.hideLoading(),
                e.showToast((t.ResponseStatus && t.ResponseStatus.Errors ? t.ResponseStatus.Errors.join("") : "") + "<br/>请返回重新选择城市。",
                function() {
                    e.back("#index")
                })
            },
            function(t) {
                clearTimeout(w);
                var n = {
                    title: N + " - " + (e.vacationsListModel.param.KeyWord == "周边" ? "周边": e.vacationsListModel.param.KeyWord),
                    home: !0,
                    homefunc: function(t) {
                        W.frompage = undefined,
                        z.set(W),
                        e.jump("/html5/")
                    },
                    returnfunc: function() {
                        var t = W.frompage || "";
                        W.frompage = undefined,
                        z.set(W),
                        t ? t == "nopage" ? L ? X.backToLastPage({}) : e.back() : e.jump(t) : e.back("#index")
                    }
                };
                e.headerUpdate(n, 1),
                e.render({
                    sortType: 0,
                    isInApp: L
                }),
                e.hideLoading(),
                e.turning(),
                $(window).unbind("scroll", showNext),
                $(".wireless_failure").show(),
                $(".error").hide()
            },
            !1, this)
        },
        onWindowScroll: function(e) {
            function t() {
                var t = $("#headerview")[0].clientHeight + $(".product_list")[0].clientHeight;
                m + $(window).height() > t && !tt[A] && v.products && e.addmore()
            } !! v.products && !O.height() && !tt[A] && O.show(),
            tt[A] == 2 ? ($(window).unbind("scroll", showNext), !!v.products && $(".no_more").show()) : (m = document.documentElement.scrollTop || document.body.scrollTop, clearTimeout(g), g = setTimeout(t, 300))
        },
        iScrollStart: function(e, t) {
            t.directionY > 0 ? !$(".tpye_tab").height() || ($(".tpye_tab").hide(), $(".footer").hide()) : t.directionY < 0 && ($(".tpye_tab").height() || ($(".tpye_tab").show(), $(".footer").show())),
            !!v.products && !O.height() && !tt[A] && O.show()
        },
        iScrollEnd: function(e, t) {
            t.directionY > 0 ? !$(".tpye_tab").height() || ($(".tpye_tab").hide(), $(".footer").hide()) : t.directionY < 0 && ($(".tpye_tab").height() || ($(".tpye_tab").show(), $(".footer").show()));
            var n = e.$el.find(".product_list_box").height(),
            r = H.height();
            tt[A] == 2 ? !!v.products && $(".no_more").show() : t.y + n < r + 300 && !tt[A] && v.products && e.addmore("",
            function() {
                D.refresh()
            })
        },
        initTemplate: function() {
            return _.template(r)
        },
        addmore: function(e, t) {
            var n = this;
            nt[A] += y,
            n.vacationsListModel.param.Start = nt[A],
            n.vacationsListModel.param.LineType = E,
            n.vacationsListModel.excute(function(e) {
                if (n.vacationsListModel.param.LineType == E) if (e.ResponseStatus && e.ResponseStatus.Ack && e.ResponseStatus.Ack == "Success") {
                    var r = e.Data;
                    r.sCityId = n.vacationsListModel.param.SaleCityId,
                    tt[A] = 1;
                    if (!r.ProductInfoList || !r.ProductInfoList.length) tt[A] = 2,
                    $(".no_more").show();
                    else {
                        var i = '<%_.each(data.ProductInfoList, function(v,k){%>                            <ul class="hot_list_tab btn_active" data-pid="<%=v.ProductId %>&saleCityId=<%=data.sCityId %>&departCityId=<%=v.DepartCityId %>">                                <li class="hot_img">                                    <img width="142px" height="80px" alt="" src="http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png" data-src="<% if(v.Img && !!v.Img.trim()){%><%=v.Img%><%}else{ %>http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png<%} %>">                                </li>                                <li class="hot_vacation">                                    <%if(v.IsPromo){ %><i class="benefit">惠</i><%} %>                                    <div class="ellipsis"><p class="xname"><%=v.Title%></p></div>                                    <div class="price_wrap">                                        <div class="pices">                                            <%if(!!v.MinPrice){ %>                                            <dfn>¥</dfn>                                            <span><%=v.MinPrice%></span>起                                            <%}else{ %>                                            <span class="font14">实时计价</span>                                            <%} %>                                        </div>                                        <%if(v.Level && v.Level>1){ %><i class="diamond diamond_<%=v.Level %>"></i><%} %>                                    </div>                                    <div class="other">                                        <%if(!!v.Score){ %><p class="Score"><span><%=v.Score.toFixed(1) %></span>分</p><%} %>                                        <%if(!!v.DepartCityName && v.DepartCityId!=data.sCityId){ %><span class="city"><%=v.DepartCityName %>出发</span><%} %>                                        <div class="float_right">                                            <%if(v.IsCanCashBack){ %><i class="orange"><dfn>返</dfn><%if(v.CashBackAmount && !isNaN(v.CashBackAmount)){ %><%=parseInt(v.CashBackAmount) %><%} %></i><%} %>                                            <%if(v.IsShowWifi){ %><i class="wifi"></i><%} %>                                            <%if(!!v.SpecialTag && !!v.SpecialTag.trim()){ %> <i class="green"><%=v.SpecialTag %></i><%} %>                                        </div>                                    </div>                                </li>                            </ul>                            <%})%>',
                        s = _.template(i),
                        o = $(s({
                            data: r
                        }));
                        n.$el.find(".product_list").append(o),
                        n.correctImage(o);
                        var u = Y[A];
                        u.products = (u.products && u.products.length ? u.products: []).concat(r.ProductInfoList),
                        r.ProductInfoList.length == y ? tt[A] = 0 : (tt[A] = 2, $(".no_more").show())
                    }
                    t && $.type(t) == "function" && t.apply(null),
                    O.hide()
                } else $(".no_more").show(),
                O.hide()
            },
            function(e) {
                tt[A] = 2,
                $(".no_more").show(),
                O.hide()
            },
            !1, this)
        },
        districtSelect: function(e) {
            var t = e.currentTarget,
            n = e.target || e.srcElement,
            r = $(n);
            if (n == t || n.nodeName.toLowerCase() == "i" || n.nodeName.toLowerCase() == "span" || r.data("districtname")) {
                $(".districtlist", $(t)).toggle(),
                $("dl, .hide_div_b", $(t).siblings()).hide();
                if (r.data("districtname")) {
                    var i = r.data("districtname"),
                    s = r.data("districtlabel") || "B";
                    $("span", $(t)).text(i);
                    var o = 1,
                    u = r.data("districtid");
                    for (var a = 1; a < 4; a++) {
                        var f = W[Q[a]];
                        a == E ? ot[Q[a]] = 0 : ot[Q[a]] = 1;
                        if (f.qparams) for (var l = 0,
                        c = f.qparams.length; l < c; l++) {
                            if ((f.qparams[l].LabelType == "B" || f.qparams[l].LabelType == "G") && u != "notset") {
                                f.qparams[l].LabelType = s,
                                f.qparams[l].LabelKey = u,
                                f.qparams[l].LabelText = i,
                                o = 0;
                                break
                            }
                            if (f.qparams[l].LabelType == "B" || f.qparams[l].LabelType == "G") {
                                f.qparams.splice(l, 1);
                                break
                            }
                        }
                        if (o && u != "notset") {
                            if (!f.qparams || !f.qparams.length) f.qparams = [];
                            f.qparams.push({
                                LabelType: s,
                                LabelKey: u,
                                LabelText: i
                            })
                        }
                        f.DSName = i
                    }
                    z.set(W),
                    this.onLoad()
                }
                $(".districtlist", $(t)).height() && M.refresh()
            }
            if (r.hasClass("area_title")) {
                r.siblings(".area_title").removeClass("area_cur");
                var h = r.next(".area_subnav"),
                p = !h.hasClass("hidden");
                r.siblings(".area_subnav").addClass("hidden"),
                r.toggleClass("area_cur"),
                p ? h.addClass("hidden") : h.removeClass("hidden"),
                M.refresh()
            }
            if (n == t || n.nodeName.toLowerCase() == "i" || n.nodeName.toLowerCase() == "span") $(".districtlist", $(t)).height() ? ($(".warp_z").show(), this.getOrig()) : $(".warp_z").hide()
        },
        crecommend: function(e) {
            var t = e.currentTarget,
            n = e.target || e.srcElement;
            $("dl", $(t)).toggle(),
            $(".hide_div_b", $(t).siblings()).hide();
            if ($(n.parentNode).hasClass("hide_div")) {
                var r = [0, 5, 3, 4];
                W[A].sortType = r[$(n).index()],
                z.set(W),
                this.onLoad()
            }
            $("dl", $(t)).height() ? ($(".warp_z").show(), this.getOrig()) : $(".warp_z").hide()
        },
        displaySX: function(e) {
            var t = e.currentTarget,
            n = e.target || e.srcElement;
            if (t == n || $(n).hasClass("icon_b")) $("dl, .hide_div_b", $(t).siblings()).hide(),
            $(".hide_div_b", $(t)).toggle(),
            $(window).unbind("scroll", showNext),
            et[Q[W.linetype]] = window.scrollY,
            $(".hide_div_b", $(t)).css("display") != "none" && this.shaixuan(),
            $(".hide_div_b", $(t)).height() ? $(".warp_z").show() : ($(".warp_z").hide(), this.getOrig())
        },
        shaixuan: function() {
            var e = this,
            t = [],
            n = Z[A],
            r = W[A];
            for (var s in n) {
                filterData = {
                    type: s,
                    name: I[s],
                    key: -1,
                    text: "不限",
                    list: n[s]
                };
                for (var o = 0,
                u = filterData.list.length; o < u; o++) filterData.list[o].isSelect = 0;
                filterData.list[0].key != "notset" && filterData.list.unshift({
                    key: "notset",
                    text: "不限"
                });
                var a = 0;
                if (r.qparams) {
                    var f = r.qparams;
                    for (var l = 0,
                    c = f.length; l < c; l++) if (f[l].LabelType == s) {
                        filterData.list[0].isSelect = 0;
                        for (var h = 0,
                        p = filterData.list.length; h < p; h++) if (filterData.list[h].key == f[l].LabelKey) {
                            filterData.list[h].isSelect = 1,
                            filterData.key = filterData.list[h].key;
                            break
                        }
                        a = 1
                    }
                }
                if (!a) for (var h = 0,
                p = filterData.list.length; h < p; h++) filterData.list[h].isSelect = h == 0 ? 1 : 0; !! I[s] && t.push(filterData)
            }
            var d = r.isSale || 0,
            v = r.isPromo || 0;
            t.push({
                type: "isSale",
                key: d,
                name: "只看携程自营产品"
            }),
            t.push({
                type: "isPromo",
                key: v,
                name: "只看优惠促销产品"
            });
            var m = ["", ""],
            g = W[A].departureDate ? W[A].departureDate.split(",") : ["最早出发", "最晚出发"],
            y = lt.getFullYear();
            for (var b = 0,
            w = g.length; b < w; b++) {
                g[b] || (g[b] = b ? "最晚出发": "最早出发");
                if (g[b].indexOf("最") == -1) {
                    var E = g[b].split("-");
                    E.length == 3 && (m[b] = E[0] - y + "," + (E[1] - 1) + "," + (E[2] - 1))
                }
            }
            t.push({
                type: "goTime",
                key: "",
                values: {
                    departStart: {
                        index: m[0],
                        value: g[0].replace(/(\d+)-(\d+)-(\d+)/, "$1年$2月$3日")
                    },
                    departEnd: {
                        index: m[1],
                        value: g[1].replace(/(\d+)-(\d+)-(\d+)/, "$1年$2月$3日")
                    }
                },
                name: "出发时间"
            }),
            t.sort(function(e, t) {
                var n = "P,U,T,S,goTime,L,F,isSale,isPromo";
                return n.indexOf(e.type) - n.indexOf(t.type)
            });
            var S = {
                title: "筛选",
                btn: {
                    title: "恢复默认",
                    id: "confirmBtn",
                    classname: "righthead",
                    func: function(t) {
                        e.setDefault()
                    }
                },
                commit: {
                    id: "confirmBtn",
                    callback: function() {
                        e.setDefault()
                    }
                },
                returnfunc: function() {
                    W[A] = G[A],
                    z.set(W),
                    X.apply({
                        callback: function() {
                            e.onLoad()
                        },
                        hybridCallback: function() {
                            e.showLoading(),
                            e.back("#vacationslist"),
                            e.$el.html(""),
                            setTimeout(function() {
                                e.onLoad()
                            },
                            10)
                        }
                    })
                }
            };
            this.$el.find(".sxcontent").html(_.template(i)({
                data: t
            })),
            P = new IScroll(".sxiscroll", {
                bindToWrapper: !0,
                mouseWheel: !0
            })
        },
        disableSXiscroll: function(e) {
            P && P.disable()
        },
        enableSXiscroll: function(e) {
            P && P.enable()
        },
        showDatePicker: function(e) {
            var t = this,
            n = $(e.target),
            r = this.$el.find(".datapickerbox");
            if (n.hasClass("current")) r.hide(),
            n.removeClass("current");
            else {
                r.show(),
                n.addClass("current").siblings("span").removeClass("current");
                var i = n.attr("index");
                i = i ? i.split(",") : [0];
                var s = [],
                o = [],
                u = [],
                a = [],
                f = lt.getFullYear(),
                l = lt.getMonth() + 1,
                c = lt.getDate();
                for (var p = 0; p < 10; p++) o.push({
                    key: f + p + "年"
                });
                for (var p = 0,
                d; p < 12; p++) d = p + 1,
                d == l && !i[1] && (i[1] = p),
                d < 10 && (d = "0" + d),
                u.push({
                    key: d + "月"
                });
                for (var v = 0,
                m; v < 31; v++) m = v + 1,
                m == c && !i[2] && (i[2] = v),
                m < 10 && (m = "0" + m),
                a.push({
                    key: m + "日"
                });
                var g = t.$el.find(".datecontainer"),
                y = {
                    data: [o, u],
                    title: "",
                    index: [i[0], i[1]],
                    disItemNum: 3,
                    cancel: "cancel",
                    ok: "ok",
                    okClick: function(e) {
                        0
                    },
                    cancelClick: function() {
                        0
                    },
                    changed: [function(e) {
                        var t = parseInt(s[1]) - 1;
                        if (t == 1) {
                            var r, o = parseInt(e.key);
                            o % 4 == 0 && o % 100 != 0 || o % 400 == 0 ? r = 1 : r = 0;
                            var u = [28, 29, 30, 31],
                            a = u[r];
                            i[2] > a && (i[2] = a)
                        }
                        s[0] = e.key,
                        i[0] = e.index,
                        n.attr("index", i.join(",")),
                        n.text(s.join("")),
                        t == 1 && w(a)
                    },
                    function(e) {
                        var t = parseInt(s[0]),
                        r = ", 3, 5, 8, 10",
                        o,
                        u = e.index,
                        a,
                        f;
                        u == 1 && (t % 4 == 0 && t % 100 != 0 || t % 400 == 0) ? o = 1 : u == 1 ? o = 0 : r.indexOf(u) > -1 ? o = 2 : o = 3,
                        a = [28, 29, 30, 31],
                        f = a[o],
                        s[1] = e.key,
                        i[1] = e.index,
                        i[2] > f && (i[2] = f),
                        n.attr("index", i.join(",")),
                        n.text(s.join("")),
                        w(f)
                    },
                    function(e) {
                        s[2] = e.key,
                        i[2] = e.index,
                        n.attr("index", i.join(",")),
                        n.text(s.join(""))
                    }]
                },
                b = {
                    data: [a],
                    title: "",
                    index: [i[2]],
                    disItemNum: 3,
                    changed: [function(e) {
                        s[2] = e.key,
                        i[2] = e.index,
                        n.attr("index", i.join(",")),
                        n.text(s.join(""))
                    }]
                };
                at ? (at.hide(), ft.hide(), at = new h(y), ft = new h(b)) : (at = new h(y), ft = new h(b)),
                at.rootBox = g.find(".subcon1"),
                ft.rootBox = g.find(".subcon2"),
                at.show(),
                ft.show(),
                at.mask.hide(),
                ft.mask.hide(),
                g.find("li.current").each(function(e, t) {
                    s[e] = $(t).text()
                }),
                n.text(s.join(""));
                function w(e) {
                    a = [];
                    for (var t = 0,
                    n; t < e; t++) n = t + 1,
                    n == c && !i[2] && (i[2] = t),
                    n < 10 && (n = "0" + n),
                    a.push({
                        key: n + "日"
                    });
                    ft.hide(),
                    b.data = [a],
                    b.index = [i[2]],
                    ft = new h(b),
                    ft.rootBox = g.find(".subcon2"),
                    ft.show(),
                    ft.mask.hide()
                }
                var E = $(".sxcontent").height() - $(".filter_btn_wrap").height(),
                S = E - $(".datapickerbox").height(),
                x = $(".datapickerbox").offset().top - $(".sxcontent").offset().top;
                S < x && P.scrollTo(0, P.y - (x - S))
            }
            P && P.refresh()
        },
        setDefault: function() {
            W[A] = {},
            this.shaixuan()
        },
        filterSubmit: function(e) {
            this.getDepartureDate(),
            z.set(W);
            var t = this;
            $(e.target).closest(".hide_div_b").hide(),
            t.$el.find(".warp_z").hide(),
            t.onLoad()
        },
        filterChoose: function() {
            var e = this;
            p = $(arguments[0].currentTarget).data("type");
            var t = {
                title: I[p],
                returnfunc: function() {
                    e.shaixuan()
                }
            };
            e.headerUpdate(t);
            var n = Z[A][p],
            r = _.template(s);
            n[0].key != "notset" && n.unshift({
                key: "notset",
                text: "不限"
            });
            var i = 0,
            o = W[A];
            if (o.qparams) {
                var u = o.qparams;
                for (var a = 0,
                f = u.length; a < f; a++) if (u[a].LabelType == p) {
                    for (var l = 0,
                    c = n.length; l < c; l++) n[l].isSelect = 0,
                    n[l].key == u[a].LabelKey && (n[l].isSelect = 1);
                    i = 1;
                    break
                }
            }
            if (!i) for (var l = 0,
            c = n.length; l < c; l++) n[l].isSelect = l == 0 ? 1 : 0;
            this.$el.html(r({
                data: n
            }))
        },
        filterSelect: function(e) {
            var t = this,
            n = e.target || e.srcElement,
            r = 1,
            i = $(n).data("key"),
            s = W[A];
            if (s.qparams) for (var o = 0,
            u = s.qparams.length; o < u; o++) s.qparams[o].LabelType == p && i != "notset" ? (s.qparams[o].LabelKey = i, s.qparams[o].LabelText = $(n).text(), r = 0) : s.qparams[o].LabelType == p && (s.qparams.splice(o, 1), u--, o--);
            else s.qparams = [];
            r && i != "notset" && s.qparams.push({
                LabelType: p,
                LabelKey: i,
                LabelText: $(n).text()
            }),
            t.shaixuan()
        },
        getOrig: function() {
            var e = {};
            for (var t in G[A]) if ($.type(G[A][t]) == "array") {
                e[t] = [];
                for (var n = 0,
                r = G[A][t].length; n < r; n++) e[t][n] = _.clone(G[A][t][n])
            } else e[t] = _.clone(G[A][t]);
            W[A] = e,
            z.set(W)
        },
        getDepartureDate: function() {
            var e = this.$el.find(".starttime").text().match(/\d+/g) || [],
            t = this.$el.find(".endtime").text().match(/\d+/g) || [];
            e = e.join("-"),
            t = t.join("-");
            if (e && t && (new Date(e)).getTime() > (new Date(t)).getTime()) {
                var n = e;
                e = t,
                t = n
            }
            var r = e + "," + t;
            W[A].departureDate = r == "," ? undefined: r
        },
        filterSelectNew: function(e) {
            var t = this,
            n = e.target || e.srcElement;
            $target = $(n);
            var r = e.currentTarget;
            p = $(r).data("type");
            var i = $target.data("key"),
            s = W[A],
            o = $(r).data("multiple");
            if (n.tagName.toLowerCase() == "a") {
                s.qparams = s.qparams || [];
                var u = s.qparams.length;
                o ? i == "notset" ? $target.addClass("selected").siblings("a").removeClass("selected") : ($target.toggleClass("selected"), $target.parent().find(".selected").length ? $target.siblings("a").eq(0).removeClass("selected") : $target.siblings("a").eq(0).addClass("selected")) : $target.addClass("selected").siblings("a").removeClass("selected");
                var a = $target.hasClass("selected"),
                f = 1;
                for (var l = 0; l < u; l++) if (s.qparams[l].LabelType == p) {
                    if (i == "notset") {
                        s.qparams.splice(l, 1),
                        u--,
                        l--;
                        continue
                    }
                    if (o && !a && s.qparams[l].LabelKey == i) {
                        s.qparams.splice(l, 1),
                        u--,
                        l--;
                        break
                    }
                    if (!o) {
                        s.qparams[l].LabelKey = i,
                        s.qparams[l].LabelText = $target.text(),
                        f = 0;
                        break
                    }
                }
                i != "notset" && (o && a || !o && f) && s.qparams.push({
                    LabelType: p,
                    LabelKey: i,
                    LabelText: $target.text()
                })
            }
        },
        hideShowTripArea: function(e) {
            var t = e.target || e.srcElement,
            n = $(t);
            n.toggleClass("arrow_up arrow_down"),
            this.$el.find(".triparealist").toggle(),
            P.refresh()
        },
        TripAreaSelect: function(e) {
            var t = e.target || e.srcElement,
            n = e.currentTarget,
            r = $(t),
            i = $(n).data("type"),
            s = W[A] || [];
            if (r.closest("p")) {
                var o = r.closest("p");
                o.hasClass("notset") ? (o.find("i").addClass("current"), o.siblings("p").find("i").removeClass("current"), ct = ["不限"]) : (o.find("i").toggleClass("current"), o.find("i").hasClass("current") || o.siblings("p").not("p.notset").find("i.current").length ? (o.siblings("p.notset").find("i").removeClass("current"), ct[0] = "", ct[o.data("index")] = o.find("i").hasClass("current") ? o.text() : "") : (o.siblings("p.notset").find("i").addClass("current"), ct = ["不限"])),
                this.$el.find(".triparea").text(ct.join(" ").trim().replace(/\s+/g, "；")),
                s.qparams = s.qparams || [];
                var u = o.data("key"),
                a = s.qparams,
                f = a.length,
                l = 0,
                c = o.find("i").hasClass("current");
                for (var h = 0; h < f; h++) if (s.qparams[h].LabelType == i) {
                    if (u == "notset") {
                        s.qparams.splice(h, 1),
                        f--,
                        h--;
                        continue
                    }
                    if (s.qparams[h].LabelKey == u) {
                        if (!c) {
                            s.qparams.splice(h, 1),
                            f--,
                            h--;
                            break
                        }
                        l = 1
                    }
                }
                u != "notset" && c && !l && s.qparams.push({
                    LabelType: i,
                    LabelKey: u,
                    LabelText: o.text()
                })
            }
        },
        filterOnOff: function() {
            var e = arguments[0].currentTarget,
            t = W[A];
            $("a", e).toggleClass("btn_on btn_off"),
            p = $(e).data("type");
            var n = $("a", e).hasClass("btn_on");
            p == "isSale" ? t.isSale = n: t.isPromo = n
        },
        tabSwitch: function(e) {
            $(window).unbind("scroll"),
            et[Q[W.linetype]] = window.scrollY;
            var t = this,
            n = e.target || e.srcElement,
            r = $(n);
            r.hasClass("on") || (r.addClass("on"), r.siblings("li").removeClass("on"), W.linetype = r.data("linetype"), z.set(W), this.getQuery("type") ? t.back("#vacationslist") : t.onLoad())
        },
        headerUpdate: function(e, t) {
            var n = this;
            n.headerview.set({
                title: e.title,
                subtitle: e.subtitle,
                customtitle: e.customtitle,
                back: !0,
                view: this,
                tel: null,
                home: e.home,
                custom: e.custom ? e.custom.html: "",
                btn: e.btn,
                bindEvents: function(t) {
                    e.custom && e.custom.class && t.on("click", e.custom.class, e.custom.func),
                    e.btn && e.btn.classname && t.on("click", "." + e.btn.classname, e.btn.func)
                },
                events: {
                    returnHandler: e.returnfunc,
                    homeHandler: e.homefunc
                },
                commit: e.commit
            }),
            n.headerview.show()
        },
        onShow: function() {
            this.$el.find(".product_list").length && ($(window).bind("scroll", this._checkImgPos), $(window).bind("touchmove", this._checkImgPos)),
            this.checkImgPos();
            var e = this,
            t = 0;
            this.correctImage($(".product_list")),
            M = new IScroll(".scroll_districtlist", {
                bindToWrapper: !0,
                mouseWheel: !0
            })
        },
        onHide: function() {
            $(window).unbind("touchmove"),
            $(window).unbind("scroll")
        },
        detail: function(e) {
            et[A] = window.scrollY,
            this.tabScrollY = et,
            $(".tpye_tab").show(),
            $(".footer").show(),
            this.forward("#detail?productId=" + $(e.currentTarget).data("pid"))
        },
        showToast: function(e, n) {
            n || (n = function() {}),
            this.toast || (this.toast = new t.ui.Toast),
            this.toast.show(e, 2, n, !0)
        },
        correctImage: function(e) {
            var t = $("img", e);
            t.each(function(e, t) {
                var n = $(t);
                t.onload = function() {
                    n.show("fast")
                },
                t.onerror = function() {
                    n.attr("src", "http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png")
                }
            })
        },
        tryAgain: function() {
            this.onLoad()
        },
        Dial: function(e) {
            var t = $(e.currentTarget).data("num");
            return X.apply({
                hybridCallback: function() {
                    return e.preventDefault(),
                    X.callPhone({
                        tel: t
                    }),
                    !1
                },
                callback: function() {
                    return ! 0
                }
            })
        },
        checkImgPos: function() {
            var e = this,
            t = this.$el.find(".product_list");
            if (t.find("img").length) {
                var n = t.find("ul");
                n.each(function(t, n) {
                    document.body.scrollTop + document.body.offsetHeight > $(n).offset().top && e.loadImgsInDom($(n))
                })
            }
        },
        loadImgsInDom: function(e) {
            if (e.length < 1) return;
            $.type(e) != "array" && (e = $(e));
            var t = $("img", e);
            t.each(function(e, t) {
                var n = $(t),
                r = n.attr("data-src");
                n.attr("src") != r && (n.css("display", "none"), t.onload = function() {
                    n.show()
                },
                t.onerror = function() {
                    n.show()
                },
                n.attr("src", r))
            })
        },
        Locating: function(e) {
            var t = 0;
            J = V.get() || {},
            !J.fail && !J.name ? (K = f.create("Geolocation"), K.requestCityInfo(function(n) {
                for (var r = 0,
                i = ut.length; r < i; r++) if (n.city.indexOf(ut[r].name) > -1) {
                    J = {
                        name: ut[r].name,
                        id: ut[r].id
                    },
                    t = 1;
                    break
                }
                t || (J = {
                    fail: 1
                }),
                V.set(J),
                $.type(e) == "function" && e()
            },
            function(t) {
                J = {
                    fail: 1
                },
                V.set(J),
                $.type(e) == "function" && e()
            })) : e()
        }
    });
    return ht
}),
define("VaBaseView", ["cBasePageView", "res/scripts/util", "TourStore", "cWidgetFactory"],
function(e, t, n, r) {
    var i = Array.prototype.slice,
    s = Object.prototype.toString,
    o = t.CONST,
    u = {
        TYPE_OBJECT: "[object Object]",
        TYPE_ARRAY: "[object Array]"
    },
    a = {
        back_forward: null
    },
    f = function() {
        var e = [n.OrderParamStore, n.OrderDataSaveStore, n.TempPassengerStore];
        return {
            "order.detail": e,
            "order.sback": e
        }
    } (),
    l,
    c = e.extend({
        hasAd: 1,
        delegateEvents: function() {
            var t = this.events,
            n = this.constructor.__super__.events;
            return n && t !== n && (t = _.isFunction(t) ? t.call(this) : t, n = _.isFunction(n) ? n.call(this) : n, this.events = _.extend({},
            n, t)),
            e.__super__.delegateEvents.apply(this, arguments)
        },
        __onLoad: function(n) {
            window.vaStorage = this.vaStorage;
            var r = e.__super__.__onLoad.apply(this, arguments),
            s = i.call(arguments),
            o;
            a.back_forward && a.back_forward.viewname == n && (o = a.back_forward.data);
            var o = _.extend(o || {},
            t.paramParse()),
            u = this.vaStorage.get();
            return o = _.extend({},
            u, o),
            o[this.vaStorage.not_store_key] = u,
            s.unshift(o),
            this.vaOnLoad && (delete a.back_forward, this.vaOnLoad.apply(this, s)),
            this.clearStore(),
            r
        },
        vaStorage: t.getStorage("VACATION_TOURE_VIEW"),
        vaBack: function(e, t) {
            var n = arguments;
            return s.call(e) == u.TYPE_OBJECT && (n = i.call(arguments, 1), a.back_forward = {
                viewname: this.viewname,
                data: e
            }),
            this.back.apply(this, n)
        },
        vaForward: function(e, t) {
            var n = arguments;
            s.call(e) == u.TYPE_OBJECT && (n = i.call(arguments, 1), a.back_forward = {
                viewname: this.viewname,
                data: e
            });
            if (!n[0]) throw TypeError("[vaForward] no URL was provided.");
            return this.forward.apply(this, n)
        },
        vaJump: function(e, t) {
            var n = arguments;
            s.call(e) == u.TYPE_OBJECT && (n = i.call(arguments, 1), a.back_forward = {
                viewname: this.viewname,
                data: e
            });
            if (!n[0]) throw TypeError("[vaJump] no URL was provided.");
            return this.jump.apply(this, n)
        },
        vaShowLoading: function(e) {
            l = setTimeout($.proxy(function() {
                this.showLoading()
            },
            this), e || 300)
        },
        vaHideLoading: function() {
            l && clearTimeout(l),
            this.hideLoading()
        },
        _storageInStep: [{
            name: o.STORE_DETAIL,
            contain: []
        },
        {
            name: o.STORE_BOOKING_STEP1,
            contain: [o.STORE_BOOKING_CALENDAR, o.STORE_BOOKING_STEP1]
        },
        {
            name: o.STORE_BOOKING_STEP2,
            contain: [o.STORE_BOOKING_STEP2, o.STORE_BOOKING_CHOOSED_RESOURCE, o.STORE_BOOKING_HOTEL, o.STORE_BOOKING_SINGLE, o.STORE_BOOKING_OPTIONAL, o.STORE_BOOKING_TMP_ORDER]
        },
        {
            name: o.STORE_BOOKING_STEP3,
            contain: []
        }],
        util: t,
        clearStore: function() {
            var e, t = location.hash.slice(1);
            if (!t) return;
            var n = t.split("?")[0];
            if (e = f[n]) if (s.call(e) === u.TYPE_ARRAY) for (var r = 0,
            i = e.length; r < i; r++) e[r].getInstance().remove();
            else e.getInstance().remove()
        }
    });
    return c
}),
define("text!templates/detail.html", [],
function() {
    return '<div class="body">\r\n    <div class="banner_box" id="js_detail_pic_slide">\r\n    </div>\r\n    <div class="start_share">\r\n        <div class="float_left"><% if(data.detailInfo && !_.isEmpty(data.detailInfo.departName)) { %><span class="start_city"><%=data.detailInfo.departName %>出发</span><% } %></div>\r\n        <div class="float_right">\r\n            <a id="js_share" class="share_ico" style="display:none"></a>\r\n            <a id="js_collect" class="collect_ico"></a>\r\n        </div>\r\n    </div>\r\n    <ul class="detail_tab">\r\n        <li class="current">概要</li>\r\n        <li><%if(data.travelDay){ %><%=data.travelDay %>日<%}else{ %>暂无<%} %>行程</li>\r\n        <li><%if(productType===""){ %> <%=data.commentNum %>条点评<%}else{ %> 秒杀细则 <%} %></li>\r\n    </ul>\r\n    <div style="display: none;" class="tab_loading">\r\n        <div style="" class="cui-breaking-load"> <div class="cui-i cui-m-logo"></div> <div class="cui-i cui-w-loading"></div></div>\r\n    </div>\r\n    <div class="profile_box js_tab_showbox">\r\n        <%if(data.detailInfo){ %>\r\n        <div class="product_wrap">\r\n            <h2><%=data.detailInfo.title %></h2>\r\n            <div class="price_box">\r\n\r\n                <% if(productType!=="cskill") { %>\r\n                <% if(data.detailInfo.price == 0) { %>\r\n                <p class="price font14">实时计价</p>\r\n                <% } else { %>\r\n                <p class="price"><dfn>¥</dfn><%=data.detailInfo.price %><em>起</em></p>\r\n                <%} %>\r\n                <%} %>\r\n\r\n                <% if(data.detailInfo.isCashBack) { %><i class="orange"><dfn>返</dfn><%=data.detailInfo.cashBackAmount %></i><%} %>\r\n                <% if(data.detailInfo.isWifi) { %><i class="wifi">免费WiFi</i><%} %>\r\n                <% if(!_.isEmpty(data.detailInfo.specialTags)) { %>\r\n                <% _.each(data.detailInfo.specialTags, function (v, k) { %>\r\n                <i class="green"><%=v %></i>\r\n                <% }) %>\r\n                <% } %>\r\n                <% if(productType==="cskill") { %>\r\n\r\n                <% if(secKillSetting.cskillStatus === "start") {%>\r\n                <span class="seckill_time js_seckillttime">距离结束<%= secKillSetting.lastTime.hour %>:<%= secKillSetting.lastTime.minute %>:<%= secKillSetting.lastTime.second %></span>\r\n                <% } else {%>\r\n                <span class="seckill_time js_seckillttime" style="display:none"></span>\r\n                <% } %>\r\n                <% } %>\r\n            </div>\r\n            <% if(productType==="cskill") { %>\r\n            <div class="seckill_price">\r\n                <div class="seckill_priceleft">\r\n                    <p><span>秒杀价</span><% if( cskillData.PromotionPrice >0 ){ %><span><dfn>¥</dfn><%= cskillData.PromotionPrice %><em>起</em></span><% } else {%> <span>实时计价</span><% } %></p>\r\n                    <p>市场价&nbsp;<dfn>¥</dfn><del><%=cskillData.MarketPrice%></del>起</p>\r\n                </div>\r\n                <div class="seckill_priceright">\r\n                    <% if(cskillData.Inventory >-99999 && cskillData.Inventory < 99999) { %>\r\n                    <% if(cskillData.Inventory > 10) { %>\r\n                    <p>名额充足</p>\r\n                    <% } else { %>\r\n                    <p>剩余<span><%= cskillData.Inventory %></span>位</p>\r\n                    <% } %>\r\n                    <% } %>\r\n                    <p> <% if(cskillData.Inventory != 0) {%> <%= cskillData.Schedule %>出发 <% } %></p>\r\n                </div>\r\n            </div>\r\n            <%} %>\r\n            <% if(!_.isEmpty(data.detailInfo.promos)) { %>\r\n            <% _.each(data.detailInfo.promos, function (v, k) { %>\r\n            <p class="onsale_text"><%=v %></p>\r\n            <% }) %>\r\n            <% } %>\r\n            <div class="corp_box_wrap">\r\n                <div class="corp_box">\r\n                    <span class="corp"><%=data.detailInfo.vendor %></span>\r\n                    <span class="number">编号:<%=data.detailInfo.pId %></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="recommend_wrap">\r\n            <% if(data.detailInfo.recommends) { %>\r\n            <div class="recommend_detail">\r\n                <div class="recommend_txt">\r\n                    <h3>产品经理推荐</h3>\r\n                    <ul>\r\n                        <% _.each(data.detailInfo.recommends, function (v, k) { %>\r\n                        <li <% if(k > 2) { %>class="js_more_Content" style="display:none"<% } %>><%=v.desc %> <% if(v.url) { %><a href="<%=v.url %>" target="_blank">查看更多>></a><% } %></li>\r\n                        <% }) %>\r\n                    </ul>\r\n                    <% if(data.detailInfo.recommends.length > 3) { %><div class="more_text"><a class="js_more_Content_btn" href="javascript:void(0);">更多</a></div><% } %>\r\n                </div>\r\n            </div>\r\n            <% } %>\r\n\r\n            <% var isCost = _.every(_.pluck(data.detailInfo.costs, "descs"), function(key) { return key == \'\' }) %>\r\n            <% if(!isCost) { %>\r\n            <div class="recommend_detail">\r\n                <div class="recommend_txt">\r\n                    <h3>费用说明</h3>\r\n                    <% _.each(data.detailInfo.costs, function (v, k) { %>\r\n                    <div><strong><%=v.cateory%></strong></div>\r\n                    <ul>\r\n                        <% if(v.descs.length > 0) { %>\r\n                        <% _.each(v.descs, function (m, n) { %>\r\n                        <li><%=m %></li>\r\n                        <% }) %>\r\n                        <% } %>\r\n                    </ul>\r\n                    <% }) %>\r\n                </div>\r\n            </div>\r\n            <% } %>\r\n            <ul class="more_info">\r\n                <% if(productType==="") { %>\r\n                <li class="btn_active"><a href="#booking.step1">出发班期与价格日历</a></li>\r\n                <%}%>\r\n                <% if(data.detailInfo.isCashBack) { %>\r\n                <li class="btn_active"><a href="#detail.return.cash">返现说明</a></li><% } %>\r\n                <li class="btn_active"><a href="#detail.booking.note">预订须知</a></li>\r\n                <% if(_.indexOf([11,12,26,34], data.detailInfo.pCategoryId) >=0) { %>\r\n                <li class="btn_active"><a href="#detail.visa">签证/签注</a></li><% } %>\r\n                <% if(productType==="") { %>\r\n                <% if(data.qaNum > 0) { %>\r\n                <li class="detail_question btn_active"><a><span><%=data.qaNum %>条</span>咨询问答</a></li><% } %>\r\n                <%}%>\r\n            </ul>\r\n        </div>\r\n        <% if(!isBook) { %><div class="product_offline_notice">此产品暂不支持在线预订</div><%} %>\r\n        <%} %>\r\n    </div>\r\n\r\n    <div class="route_box js_tab_showbox" style="display: none;">\r\n    </div>\r\n\r\n    <div class="score_box js_tab_showbox" style="display: none;">\r\n    </div>\r\n</div>\r\n\r\n<% if(productType==="") { %>\r\n    <% if(isBook) { %>\r\n        <% if(data.detailInfo.isTel) { %>\r\n<footer class="book_now_double"><a class="telphone_ask_btn js_telphone_btn" href="javascript:void(0);">电话咨询</a><a class="book_now_btn js_in_Footer" href="javascript:void(0);">开始预订</a></footer>\r\n        <% } else { %>\r\n<footer class="book_now js_in_Footer"><a href="javascript:void(0);">开始预订</a></footer>\r\n        <%} %>\r\n    <% } else { %>\r\n<footer class="book_now"><a href="javascript:void(0);" class="js_telphone_btn">拨打免费服务电话</a></footer>\r\n    <%} %>\r\n<%}else{ %>\r\n\r\n    <% if(secKillSetting.cskillStatus === "noStarted") {%>\r\n<footer class="book_now seckill_disable js_dListime"><%= secKillSetting.lastTime.month%>月<%= secKillSetting.lastTime.date%>日开抢</footer>\r\n    <%} else if(secKillSetting.cskillStatus === "upcomingStart") {%>\r\n<footer class="book_now seckill_disable js_dListime">即将开始&nbsp;<%= secKillSetting.lastTime.hour %>:<%= secKillSetting.lastTime.minute %>:<%= secKillSetting.lastTime.second %></footer>\r\n    <%} else if(secKillSetting.cskillStatus === "start") {%>\r\n        <% if(cskillData.Inventory != 0) {%>\r\n<footer class="book_now js_in_Footer js_dListime"><a href="javascript:;">立即抢购</a></footer>\r\n        <% } else { %>\r\n<footer class="book_now seckill_disable js_dListime">抢光了</footer>\r\n        <% } %>\r\n    <%} else {%>\r\n<footer class="book_now seckill_disable js_dListime">抢光了</footer>\r\n    <%}%>\r\n\r\n<%} %>\r\n\r\n\r\n\r\n'
}),
define("text!templates/detail.RouteTab.html", [],
function() {
    return '<div class="route_detail mg_btm60" <%if(data.singlePage){%>style="margin-left:20px;margin-top:10px;margin-right:10px"<%}%>>\r\n<%var traffic=[\'\',\'flight\',\'bus\',\'train\',\'ship\',\'car\']; %>\r\n<%var activeType=[\'餐饮\',\'酒店\',\'航班\',\'景点\',\'购物\',\'自费项目\',\'全天自由活动\',\'自由活动\',\'交通\', \'其它\']; %>\r\n<%var dinner=[\'\',\'早餐\',\'午餐\',\'晚餐\'] %>\r\n<%_.each(data.intros,function(v,k){ %>\r\n    <h2 class="route_day"><span>D<%=v.fewDay %></span><%=v.desc.split(\'_\')[0] %><%if(!!v.trafficType && v.desc.split(\'_\')[1]){ %><i class="<%=traffic[v.trafficType] %>"></i><%=v.desc.split(\'_\')[1] %><%} %>&nbsp;</h2>\r\n    <%_.each(v.dailys,function(w,l){ %>\r\n    <%if(w.activeType!=5){ %>\r\n        <% if(!!w.departTimePre.trim() || !!w.departTime.trim()){%>\r\n        <h3 class="route_time"><% if(!!w.departTimePre.trim()){%><%=w.departTimePre %> <%} %><%if(!!w.departTime.trim()){ %><%=w.departTime %><%} %></h3>\r\n        <%} %>\r\n        <ul class="route_list">\r\n        <%_.each(w.scenics, function(scenicsNode,scenicsIndex){ %>\r\n        <li class="scenics">\r\n			<h4>前往景点:</h4>\r\n			<div class="content"><%=scenicsNode.name %></div>\r\n		</li>\r\n        <%if(scenicsNode.takeTime){ %>\r\n        <li class="scenicstime">\r\n			<h4>活动时间:</h4>\r\n			<div class="content"><%=scenicsNode.takeTime %></div>\r\n		</li>\r\n        <%} %>\r\n        <li>\r\n			<div class="scenic_spot"><%=scenicsNode.desc %></div>\r\n			<div class="scenic_img">\r\n            <%_.each(scenicsNode.imgs,function(scencsImage,ImageIndex){ %>\r\n                <%_.each(scencsImage.imgUrls,function(imgUrl,ImageUrlIndex){ %>\r\n                <a href="<%=imgUrl.value %>"><img data-src="<%=imgUrl.value  %>" src="http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png" alt="<%=scencsImage.imgName %>" data-key="<%=imgUrl.key %>"></a>\r\n                <%}) %>\r\n            <%}) %>	\r\n			</div>  				\r\n		</li>\r\n        <%}) %>\r\n        <%if(w.hotelNames && w.hotelNames.length){ %>\r\n        <li class="hotels">\r\n			<h4>入住酒店:</h4>\r\n			<div class="content"><%_.each(w.hotelNames,function(hotel,hotelIndex){ %><%if(!!hotelIndex){%> 或 <%} %><%=hotel %><%}) %></div>\r\n		</li>\r\n        <%} %>\r\n		<%if(!!w.desc){ %>\r\n        <li>\r\n			<% if(w.activeType!=9 && w.activeType!=3 && w.activeType!=1){%><h4><%=activeType[w.activeType] %>:</h4><%} %>\r\n			<div class="content"><%=w.desc %></div>\r\n		</li>\r\n        <%} %>\r\n        <%if(!!w.distance){ %>\r\n        <li class="distance">\r\n			<h4>行驶距离:</h4>\r\n			<div class="content">约<%=w.distance %>公里</div>\r\n		</li>\r\n        <%} %>\r\n        <%if(w.driveTime!=\'0/0\'){ %>\r\n        <li class="drivertime">\r\n			<h4>行驶时间:</h4>\r\n			<div class="content">约<%=w.driveTime.split(\'/\')[0] %>小时<%=w.driveTime.split(\'/\')[1] %>分</div>\r\n		</li>\r\n        <%} %>\r\n\r\n        <%if(w.dinnerInfo && w.dinnerInfo.desc){ %>\r\n        <li class="dinner">\r\n			<%if(dinner[w.dinnerInfo.dinnerType]){ %><h4><%=dinner[w.dinnerInfo.dinnerType] %>:</h4><%} %>\r\n			<div class="content"><%=w.dinnerInfo.desc %></div>\r\n		</li>\r\n        <%} %>\r\n        <%if(w.saleProduct){ %>\r\n        <li class="saleproduct">\r\n			<h4>营业产品:</h4>\r\n			<div class="content"><%=w.saleProduct %></div>\r\n		</li>\r\n        <%} %>\r\n        <%if(w.referPrice && parseInt(w.referPrice)){ %>\r\n        <li class="referprice">\r\n			<h4>参考价格:</h4>\r\n			<div class="content"><%=w.referPrice %></div>\r\n		</li>\r\n        <%} %>\r\n        <%if(w.takeTime){ %>\r\n        <li class="taketime">\r\n			<h4>占用时间:</h4>\r\n            <div class="content">约<%=w.takeTime.split(\'/\')[0] %>小时<%=w.takeTime.split(\'/\')[1] %>分</div>\r\n		</li>\r\n        <%} %>\r\n	</ul>\r\n    <%} %>\r\n    <%}) %>\r\n<%}) %>\r\n</div>'
}),
define("text!templates/detail.ScoreTab.html", [],
function() {
    return '<div class="mg_btm60" style="margin-bottom:60px">\r\n    <%if(data.pComment){ %>\r\n    <div class="total_score">\r\n        <div class="score_people"><%=data.commentPerson %>人点评</div>\r\n        <ul class="score_ico star_<%=parseInt(data.pComment.tScore) %><%if(data.pComment.tScore%1>0){%>_half<%} %>">\r\n	        <li></li>\r\n	        <li></li>\r\n	        <li></li>\r\n	        <li></li>\r\n	        <li></li>\r\n        </ul>\r\n        <span class="score_num"><%=data.pComment.tScore.toFixed(1) %></span>\r\n    </div>\r\n    <ul class="score_detail">\r\n    <%_.each(data.pComment.comments,function(v,k){ %>\r\n        <li class="detail_wrap">\r\n	        <div class="name_wrap">\r\n		        <span class="date"><%=v.cDate %></span>\r\n		        <span class="name">***<%=v.uName.substr(3,3) %></span>\r\n	        </div>\r\n	        <div class="score_ico_wrap">\r\n		        <ul class="score_ico star_<%=v.grade %>">\r\n			        <li></li>\r\n			        <li></li>\r\n			        <li></li>\r\n			        <li></li>\r\n			        <li></li>\r\n		        </ul>\r\n		        <span class="score_num"><%=v.grade %></span>\r\n	        </div>\r\n	        <dl class="score_txt">\r\n		        <dt><%=v.title %></dt>\r\n		        <dd><%=v.content %></dd>\r\n	        </dl>\r\n        </li>\r\n    <%}) %>\r\n    </ul>\r\n    <%} %>\r\n    <div class="no_more" style="display:none;">没有更多内容了</div>\r\n    <div class="base_loading" style="display:none;"><i></i>加载中</div>\r\n    <div class="no_comment" <%if(data.pComment){ %>style="display:none;"<%} %>>暂无点评</div>\r\n</div>'
}),
define("text!templates/detail.CskillTab.html", [],
function() {
    return '<div class="tab_loading" style="display:none;">\r\n	<div class="cui-breaking-load js_loading" style=""> <div class="cui-i cui-m-logo"></div> <div class="cui-i cui-w-loading"></div></div>\r\n</div>\r\n<div class="seckill_detail">\r\n	<%= data %>\r\n</div>'
}),
define("text!templates/fakeDetail.html", [],
function() {
    return '<div class="body">\r\n    <div class="banner_box" id="js_detail_pic_slide">\r\n        <div class="cui-sliderContainer" style="width: <%=data.picWidth%>px; position: relative; height: <%=data.picHeight%>px;">\r\n            <div class="cui-imageContainer" style="width: 100%;">\r\n                <div class="image-node slider-imageContainerNode" style="position: absolute; left: 0px;">\r\n                    <img style="width: <%=data.picWidth%>px; height: <%=data.picHeight%>px" src="http://pic.c-ctrip.com/vacation_v2/h5/group_travel/pic_none.png" alt="">\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <ul class="detail_tab">\r\n        <li class="current">概要</li>\r\n        <li>&nbsp;&nbsp;行程</li>\r\n        <li>&nbsp;&nbsp;点评</li>\r\n    </ul>\r\n    <div class="profile_box js_tab_showbox">\r\n        <div class="product_wrap">\r\n            <h2></h2>\r\n            <div class="price_box">\r\n                <p class="price"></p>\r\n            </div>\r\n            <div class="corp_box_wrap">\r\n                <div class="corp_box">\r\n                    <span class="start_city"></span>\r\n                    <span class="number">编号:<%=data.pid %></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="recommend_wrap">\r\n            <div class="recommend_detail">\r\n                <div class="recommend_txt">\r\n                    <h3>产品经理推荐</h3>\r\n                </div>\r\n            </div>\r\n            <div class="recommend_detail">\r\n                <div class="recommend_txt">\r\n                    <h3>费用说明</h3>\r\n                </div>\r\n            </div>\r\n            <ul class="more_info">\r\n                <li class="btn_active"><a href="#booking.step1">出发班期与价格日历</a></li>\r\n                <li class="btn_active"><a href="#detail.booking.note">预订须知</a></li>\r\n                <li class="btn_active"><a href="#detail.visa">签证/签注</a></li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    <div class="route_box js_tab_showbox" style="display: none;">\r\n    </div>\r\n    <div class="score_box js_tab_showbox" style="display: none;">\r\n    </div>\r\n</div>\r\n<footer class="book_now js_in_Footer">\r\n    <a href="javascript:void(0);">开始预订</a></footer>\r\n'
}),
define("res/data/area", [],
function() {
    var e = {
        cityToArea: {
            EASTOFCHINA: ["2", "14", "82", "12", "512", "278", "13", "213", "17", "491", "578", "536", "375"],
            NORTHOFCHINA: ["533", "7", "479", "144", "451", "523", "142", "5", "158", "6", "1", "103", "428", "105", "141", "527", "140", "3"],
            SOUTHOFCHINA: ["25", "258", "406", "477", "376", "559", "206", "32", "43", "42", "447", "380", "31", "251", "553", "316", "30", "223"],
            WESTOFCHINA: ["28", "34", "494", "370", "109", "39", "100", "124", "41", "99", "38", "4", "10"]
        },
        areaToCn: {
            EASTOFCHINA: "华东",
            SOUTHOFCHINA: "华南",
            WESTOFCHINA: "华西",
            NORTHOFCHINA: "华北"
        }
    };
    return e
}),
define("views/detail", ["libs", "c", "VaBaseView", "text!templates/detail.html", "text!templates/detail.RouteTab.html", "text!templates/detail.ScoreTab.html", "text!templates/detail.CskillTab.html", "text!templates/fakeDetail.html", "TourModel", "TourStore", "cWidgetFactory", "res/scripts/widget/c.ui.imageSlider", "res/scripts/util", "res/scripts/widget/Timer", "res/data/area", "cUIAlert", "cWidgetGuider", "CommonStore", "cWidgetMember"],
function(e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y) {
    var b = l.create("Guider"),
    w = 10,
    E,
    S,
    x,
    T,
    N,
    C,
    k,
    L,
    A,
    O,
    M,
    D,
    P,
    H,
    B = null,
    j = undefined,
    F,
    I,
    q,
    R,
    U = null,
    z,
    W,
    X,
    V,
    J,
    K,
    Q,
    G,
    Y,
    Z = function(e) {
        var t = f.SourceSignStore.getInstance();
        t.get() && t.remove();
        if (e) for (var n in e) t.setAttr(n, e[n])
    },
    et,
    tt,
    nt,
    rt = new p,
    it = window.screen.width,
    st = it <= 480 ? "M480": "M640",
    ot = f.AreaStore.getInstance(),
    ut = g.UserStore.getInstance(),
    at = l.create("Member"),
    ft = n.extend({
        pageid: t.utility.isInApp() ? "220080": "220003",
        detailModel: a.DetailModel.getInstance(),
        detailPicStore: f.DetailPicStore.getInstance(),
        detailCskillModel: a.CsKillModel.getInstance(),
        inMyCollectionModel: a.InMyCollectionModel.getInstance(),
        addCollectionModel: a.AddCollectionModel.getInstance(),
        removeCollectionModel: a.RemoveCollectionModel.getInstance(),
        isLogin: !1,
        uid: "",
        render: function(e) {
            this.$el.html(e),
            this.slide(),
            this._checkImgPos = $.proxy(this.checkImgPos, this)
        },
        renderSocre: function(e) {
            this.$el.find(".score_box").html(e)
        },
        renderRoute: function(e) {
            this.$el.find(".route_box").html(e),
            this.$el.find(".route_detail").length && ($(window).bind("scroll", this._checkImgPos), $(window).bind("touchmove", this._checkImgPos))
        },
        onCreate: function() {
            ut.isLogin() && (Y = ut.getUser()),
            this.injectHeaderView()
        },
        events: {
            "click #js_detail_pic_slide": "toPicList",
            "click .detail_tab li": "switchTab",
            "click .js_in_Footer": "booking",
            "click .js_more_Content_btn": "moreContent",
            "click .scenic_img": "showImges",
            "click .js_telphone_btn": "showAlert",
            "click .detail_question": "to_question",
            "click #js_collect": "changeCollectState",
            "click #js_share": "share"
        },
        onLoad: function(e) {
            function w() {
                event.preventDefault(),
                z != event.targetTouches[0].clientY ? (W = z - event.targetTouches[0].clientY, window.scrollTo(0, document.body.scrollTop + W), z = event.targetTouches[0].clientY) : W = 0,
                X()
            }
            function T() {
                z = event.targetTouches[0].clientY
            }
            function N() {
                var e = 0,
                t = setInterval(function() {
                    e < 18 ? (W > 0 ? window.scrollTo(0, document.body.scrollTop + 5) : W < 0 && window.scrollTo(0, document.body.scrollTop - 5), X(), e++) : clearInterval(t)
                },
                3)
            }
            this.referrer = e || "";
            var n = this,
            i, s = this.vaStorage.get("detail_url_param") || {},
            o = this.vaStorage.get("detail_return_param");
            R = this.getQuery("tab") || 0,
            B = null;
            var a = this.pid = this.getQuery("productId") || this.getQuery("productid") || "",
            f = !1,
            l = this.saleCityId = this.getQuery("saleCityId") || this.getQuery("salecityid") || 0,
            c = this.departCityId = this.getQuery("departCityId") || this.getQuery("departcityid") || 0;
            V = t.utility.isInApp();
            if (!a && o) {
                location.hash = o,
                this.vaStorage.remove("detail_return_param"),
                window.location.reload();
                return
            }
            var p = [a, l, c];
            tt = this.getQuery("productType") || this.getQuery("producttype") || "";
            var v, m;
            if (ot.get()) v = ot.get().en;
            else {
                m = d.cityToArea;
                for (var g in m) m[g].indexOf(c) > -1 && (v = g)
            }
            U = V ? this.getQuery("share") : this.util.getQueryString("share");
            var y = V ? this.getQuery("sourceid") : this.util.getQueryString("sourceid");
            J = this.getQuery("from") || "";
            if (!a || !l) n.showToast("产品ID/售卖站 错误， 请返回上页重新选择",
            function() {
                n.back()
            });
            else {
                Z({
                    share: U,
                    SourceID: y
                }),
                K = setTimeout(function() {
                    n.setHead(),
                    n.headerview.show(),
                    n.$el.html(_.template(u)({
                        data: {
                            picWidth: document.body.offsetWidth,
                            picHeight: document.body.offsetWidth * 360 / 640,
                            pid: a
                        }
                    })),
                    n.turning(),
                    n.showLoading()
                },
                500),
                this.detailModel.param = {
                    pId: a,
                    scId: l,
                    dcId: c
                },
                this.vaStorage.set("detail_request_param", this.detailModel.param),
                this.vaStorage.set("detail_url_param", {
                    Query: p.join(".")
                });
                if (!j || s.Query != p.join(".")) Q = "",
                G = "http://res.m.ctrip.com/html5/Content/images/144.png",
                this.$el.empty(),
                S = undefined,
                x = undefined,
                this.showLoading(),
                this.detailModel.setParam({
                    reqType: [1]
                }),
                this.detailModel.excute(function(e) {
                    if (e.errno == 0) {
                        var t = e.data;
                        Q = t.detailInfo ? t.detailInfo.title: "";
                        var i = !_.isEmpty(t.detailInfo) && t.detailInfo.cashBackAmount;
                        F = t.commentPerson,
                        h.memoryCache.set("detail_request_data", t),
                        j = h.memoryCache.get("detail_request_data");
                        if (D = t.imgs) G = D[0].imgUrls[0].value.replace(/(\S+)(\.jpg)/i, "$1-m$2");
                        L = t && t.detailInfo && t.detailInfo.pCategoryId && t.detailInfo.pCategoryId == 13,
                        k = t.isBook && (t && t.detailInfo ? !L: 1),
                        A = t.isChildBook,
                        O = t.minPerson,
                        t.showIndex = E || 0,
                        clearTimeout(K),
                        tt === "" ? (f = t.canIntentOrd, this.render(_.template(r)({
                            isBook: k,
                            data: t,
                            productType: tt
                        }))) : (this.pageid = V ? "401007": "104313", this.detailCskillModel.param = {
                            EnvironmentType: st,
                            Zone: v,
                            ProductIDs: a
                        },
                        this.detailCskillModel.excute(function(e) {
                            if (e.ResponseStatus.Ack === "Success") {
                                if (e.data.Products.length === 0) {
                                    this.render(_.template(r)({
                                        isBook: k,
                                        data: t,
                                        productType: ""
                                    })),
                                    this.hideLoading(),
                                    this.turning();
                                    return
                                }
                                var n = e.data,
                                i = n.Products[0].SaleCityId,
                                s = _.indexOf(i, l) === -1 ? i[0] : l;
                                this.hideLoading(),
                                nt = n.Products[0].Schedule,
                                et = n.Products[0].Inventory,
                                this.render(_.template(r)({
                                    isBook: k,
                                    data: t,
                                    cskillData: n.Products[0],
                                    productType: tt,
                                    secKillSetting: rt.getLocalTime(n.SecKillSetting)
                                })),
                                this.turning(),
                                this.vaStorage.setAttr(h.CONST.STORE_BOOKING_CALENDAR, {
                                    selected_date: nt,
                                    productType: tt,
                                    sale_city: s,
                                    fromuri: h.getPath("detail", {
                                        productId: a,
                                        departCityId: c,
                                        saleCityId: s,
                                        productType: tt,
                                        from: J
                                    })
                                }),
                                rt.timered(this.cskillTimeer),
                                V && this.$el.find("#js_share").show()
                            } else this.showToast(e.ResponseStatus.Errors[0].Message)
                        },
                        function() {
                            this.showToast("网络错误，请稍候重试。")
                        },
                        !1, this)),
                        V && this.$el.find("#js_share").show(),
                        this.isLogin = ut.isLogin(),
                        this.isLogin && (this.uid = ut.getUser().UserID, this.getCollectState()),
                        this.vaStorage.set(h.CONST.STORE_BOOKING_STEP1, {
                            isBook: k,
                            ischildbook: A,
                            minperson: O
                        });
                        var s = this.vaStorage.get(h.CONST.STORE_BOOKING_CALENDAR);
                        this.vaStorage.set(h.CONST.STORE_BOOKING_CALENDAR, {
                            nexturi: h.getPath("booking_step1"),
                            type: "single",
                            pid: a,
                            departure_city: c - 1 + 1 || (t.detailInfo ? t.detailInfo.departId || 2 : 2),
                            sale_city: l,
                            isIntentOrder: f,
                            fromuri: h.getPath("detail", {
                                productId: a,
                                departCityId: c,
                                saleCityId: l,
                                productType: tt,
                                from: J
                            })
                        }),
                        this.vaStorage.set(h.CONST.STORE_DETAIL_RETURN_CASH, {
                            returnCashCount: i
                        }),
                        navigator.userAgent.toLowerCase().indexOf("micromessenger") > -1 && n.inWeixinShare()
                    } else clearTimeout(K),
                    j = undefined,
                    this.showToast(e.errmsg);
                    this.setHead(),
                    this.headerview.show(),
                    tt || (this.hideLoading(), this.turning()),
                    R && this.switchTab("", R),
                    M = !!j && !j.commentNum,
                    P = !!j && !j.travelDay
                },
                function() {
                    clearTimeout(K),
                    j = undefined,
                    this.showToast("网络错误，请稍候重试。",
                    function() {
                        n.back()
                    }),
                    this.hideLoading(),
                    this.turning(),
                    M = undefined,
                    P = undefined
                },
                !1, this);
                else {
                    clearTimeout(K),
                    this.setHead(),
                    this.headerview.show(),
                    this.turning(),
                    M = !!j && !j.commentNum,
                    P = !!j && !j.travelDay;
                    var b = this.vaStorage.get(h.CONST.STORE_BOOKING_CALENDAR) || {};
                    b.fromuri = h.getPath("detail", {
                        productId: a,
                        departCityId: c,
                        saleCityId: l,
                        productType: tt,
                        from: J
                    }),
                    this.vaStorage.set(h.CONST.STORE_BOOKING_CALENDAR, b),
                    navigator.userAgent.toLowerCase().indexOf("micromessenger") > -1 && n.inWeixinShare()
                }
            }
            X = function() {
                document.body.scrollTop + 48 > i ? ($(".detail_tab").addClass("detail_tab_fixed"), !V || $(".detail_tab").css("top", 0), $(".js_tab_showbox").each(function(e, t) {
                    $(t).height() && $(t).css("margin-top", "43px")
                })) : ($(".detail_tab").removeClass("detail_tab_fixed").css("top", ""), $(".js_tab_showbox").css("margin-top", ""))
            },
            I = function() {
                n.onWindowScroll(n)
            }
        },
        fixtab: function() {
            var e = t.ui.Tools.getPageScrollPos(),
            n = this.$el.find("#js_detail_pic_slide").height();
            e.top > n ? ($(".detail_tab").addClass("detail_tab_fixed"), !V || $(".detail_tab").css("top", 0), $(".js_tab_showbox").each(function(e, t) {
                $(t).height() && $(t).css("margin-top", "43px")
            })) : ($(".detail_tab").removeClass("detail_tab_fixed").css("top", ""), $(".js_tab_showbox").css("margin-top", ""))
        },
        setHead: function() {
            var e = this,
            n = t.utility.isInApp();
            this.headerview.set({
                title: "产品详情",
                back: !0,
                view: this,
                events: {
                    returnHandler: function() {
                        if (U) this.back("index");
                        else if (J == "nopage") n ? b.backToLastPage({}) : e.back();
                        else if (/\/webapp\/(\S+)\/(\S+)/.test(J)) {
                            var t = J.match(/\/webapp\/(\S+)\/(\S+)/);
                            n ? b.cross({
                                path: t[1],
                                param: t[2]
                            }) : window.location = t[0]
                        } else this.back(J || "#vacationslist")
                    }
                }
            })
        },
        slide: function() {
            var e = [],
            t = [],
            n = this.$el.find("#js_detail_pic_slide");
            _.each(D,
            function(e, n) {
                t.push(D[n].imgUrls[0].value)
            }),
            _.each(t,
            function(t, n) {
                e.push({
                    title: D[n].imgName,
                    src: t,
                    link: ""
                })
            });
            if (!r) {
                var r = new c({
                    container: n,
                    images: e,
                    autoPlay: !1,
                    loop: !0,
                    imageSize: {
                        width: 500,
                        height: 280
                    },
                    defaultImageUrl: "http://pic.c-ctrip.com/vacation_v2/h5/group_travel/pic_none.png"
                });
                r.play()
            }
        },
        toPicList: function() {
            D && this.vaForward({},
            h.getPath("detail_picture_list"))
        },
        switchTab: function(e, t) {
            if (t > 2 || t < 0) t = 0;
            H = this.$el.find(".tab_loading"),
            $(window).unbind("scroll", I),
            H.show();
            var n = e && t == undefined ? $(e.target) : this.$el.find(".detail_tab li").eq(t);
            E = t || this.$el.find(".detail_tab li").index(n),
            n.addClass("current").siblings().removeClass("current"),
            this.$el.find(".js_tab_showbox").hide().eq(E).show(),
            this.fixtab(),
            E == 2 ? tt === "" ? this.showComments() : this.showCskillArticles() : E == 1 ? ($(".route_box").css("background-color", "#f5f5f5"), this.showRoute()) : H.hide()
        },
        booking: function() {
            this.vaForward({},
            h.getPath("booking_step1"))
        },
        share: function() {
            var e = this,
            t = G,
            n = t.substring(t.lastIndexOf(".") + 1),
            r = e.$el.find(".product_wrap h2").html(),
            i = "http://m.ctrip.com/webapp/tour/index.html#detail?productId=" + this.pid + "&saleCityId=" + this.saleCityId + "&departCityId=" + this.departCityId,
            s = Y ? Y.UserID: "",
            o;
            b.encrypt.ctrip_encrypt({
                inStr: s,
                callback: function(e) {
                    i += s ? "&share=" + encodeURIComponent(e.outString) : "",
                    b.downloadData({
                        callback: function(e) {
                            o = e.savedPath
                        },
                        url: t,
                        suffix: n
                    }),
                    CtripUtil.app_call_system_share(o, "这条旅游线路性价比挺高，有谁和我一起去吗？", r, i, !1)
                }
            })
        },
        showAlert: function() {
            var e = this;
            B || (B = new v({
                title: "",
                message: '为节省您的时间，请告知客服<br>此产品的编号 <span style="font-size:16px;font-weight:bold">' + e.pid + "</span>",
                buttons: [{
                    text: "取消",
                    click: function() {
                        this.hide()
                    }
                },
                {
                    text: "确认",
                    click: function() {
                        this.hide()
                    }
                }]
            })),
            B.show();
            var t = L ? 4006517544 : 4000086666;
            if (localStorage.SALES_OBJECT) {
                var n = localStorage.SALES_OBJECT;
                n[0] == "{" && n[n.length - 1] == "}" && (n = JSON.parse(n), n && n.value && n.value.tel && (t = n.value.tel))
            }
            $(".cui-btns-sure").html('<a href="tel:' + t + '" data-num="' + t + '" class="__hreftel__" style="display:block;text-align:center; margin:-10px 0; line-height:38px;">确认</a>'),
            $(".cui-btns-sure a").on("click",
            function(e) {
                var t = $(e.currentTarget).data("num");
                return b.apply({
                    hybridCallback: function() {
                        return e.preventDefault(),
                        b.callPhone({
                            tel: t
                        }),
                        !1
                    },
                    callback: function() {
                        return ! 0
                    }
                })
            })
        },
        moreContent: function(e) {
            var t = $(e.currentTarget);
            t.hide(),
            t.parent().prev().find(".js_more_Content").show()
        },
        showComments: function(e) {
            var t = this;
            this.detailModel.param.reqType = [3],
            this.detailModel.param.start = 0,
            this.detailModel.param.count = w,
            M ? (H.hide(), t.renderSocre(_.template(s)({
                data: {}
            }))) : S ? (H.hide(), this.renderSocre(_.template(s)({
                data: S
            })), q = t.$el.find(".base_loading"), S && S.pComment ? $(window).bind("scroll", I) : $(window).unbind("scroll", I)) : this.detailModel.excute(function(e) {
                H.hide(),
                e.errno == 0 ? (S = e.data, S.commentPerson = F, t.renderSocre(_.template(s)({
                    data: S
                }))) : t.renderSocre(_.template(s)({
                    data: {}
                })),
                S && S.pComment ? $(window).bind("scroll", I) : $(window).unbind("scroll", I),
                q = t.$el.find(".base_loading")
            },
            function(e) {
                H.hide(),
                t.renderSocre(_.template(s)({
                    data: {}
                }))
            },
            !1, this)
        },
        cskillTimeer: function() {
            var e = $(".js_dListime"),
            t = {},
            n = "seckill_disable",
            r = rt.getTimerStatus(),
            i = this;
            switch (r) {
            case "noStarted":
                return;
            case "upcomingStart":
                t = rt.getLastTime(rt.d2),
                $(".js_seckillttime").html("").hide(),
                e.html("即将开始&nbsp;" + t.hour + ":" + t.minute + ":" + t.second);
                break;
            case "start":
                t = rt.getLastTime(rt.d3),
                $(".js_seckillttime").html("距离结束" + t.hour + ":" + t.minute + ":" + t.second).show(),
                et != 0 && (e.hasClass("js_in_Footer") || e.addClass("js_in_Footer").removeClass(n).html('<a href="javascript:;">立即抢购</a>'));
                break;
            case "end":
                $(".js_seckillttime").html("").hide(),
                e.removeClass("js_in_Footer").addClass(n).html("抢光了")
            }
        },
        showCskillArticles: function() {
            var e = this,
            t = this.pid = this.getQuery("productId") || this.getQuery("productid") || "";
            this.detailCskillModel.param = {
                EnvironmentType: st,
                ProductIDs: t,
                RequestOption: "SecKillRule"
            },
            this.detailCskillModel.excute(function(t) {
                var n = t.data;
                e.renderSocre(_.template(o)({
                    data: n.SecKillSetting.SecKillRule
                })),
                H.hide()
            },
            function() {},
            !1, this)
        },
        onWindowScroll: function(e) {
            function t() {
                var t = $("#headerview")[0].clientHeight + $(".banner_box")[0].clientHeight + $(".detail_tab")[0].clientHeight + $(".score_box")[0].clientHeight;
                n + $(window).height() >= t && !T && e.addmore()
            } ! q.height() && !T && q.show();
            if (N) $(".no_more").show(),
            $(window).unbind("scroll", e.commentScroll);
            else {
                var n = document.documentElement.scrollTop || document.body.scrollTop;
                clearTimeout(C),
                C = setTimeout(t, 300)
            }
        },
        addmore: function() {
            var e = this;
            e.detailModel.param.start += w,
            e.detailModel.excute(function(t) {
                if (t.errno == 0) {
                    var n = t.data;
                    T = 1;
                    if ( !! n.pComment && n.pComment.comments && n.pComment.comments.length) {
                        var r = '<%_.each(data.pComment.comments,function(v,k){ %>                            <li class="detail_wrap">                                <div class="name_wrap">                                    <span class="date"><%=v.cDate %></span>                                    <span class="name">***<%=v.uName.substr(3,3) %></span>                                </div>                                <div class="score_ico_wrap">                                    <ul class="score_ico star_<%=v.grade %>">                                        <li></li>                                        <li></li>                                        <li></li>                                        <li></li>                                        <li></li>                                    </ul>                                    <span class="score_num"><%=v.grade %></span>                                </div>                                <dl class="score_txt">                                    <dt><%=v.title %></dt>                                    <dd><%=v.content %></dd>                                </dl>                            </li>                        <%}) %>',
                        i = _.template(r);
                        e.$el.find(".score_detail").append(i({
                            data: n
                        })),
                        S.pComment.comments = S.pComment.comments.concat(n.pComment.comments),
                        n.pComment.comments.length == w ? T = 0 : ($(".no_more").show(), N = 1)
                    } else $(".no_more").show(),
                    N = 1;
                    q.hide()
                }
            },
            function(e) {},
            !1, this)
        },
        showRoute: function() {
            this.detailModel.param.reqType = [2],
            this.detailModel.param.start = undefined,
            this.detailModel.param.count = undefined,
            P ? (H.hide(), this.renderRoute(_.template(i)({
                data: {}
            }))) : x ? (H.hide(), this.renderRoute(_.template(i)({
                data: x
            })), $(".route_box").css("background-color", "")) : this.detailModel.excute(function(e) {
                H.hide(),
                e.errno == 0 ? (x = e.data, this.renderRoute(_.template(i)({
                    data: e.data
                })), $(".route_box").css("background-color", "")) : this.showToast("暂无行程介绍")
            },
            function(e) {
                H.hide(),
                this.showToast("暂无行程介绍")
            },
            !1, this)
        },
        showImges: function(e) {
            e.preventDefault();
            if (e.target != e.currentTarget) {
                var t = this.detailPicStore.get() || {},
                n = $(e.target).closest("a").index() - 1 + 2;
                t.data ? t.data.imgs = [] : t.data = {
                    imgs: []
                };
                var r = $(e.currentTarget).find("img");
                for (var i = 0,
                s = r.length; i < s; i++) t.data.imgs.push({
                    imgName: r[i].alt || "",
                    imgUrls: [{
                        key: $(r[i]).data("key") || "",
                        value: r[i].src || ""
                    }]
                });
                this.detailPicStore.set(t),
                this.forward("#detail.picture.detail?picid=" + n)
            }
        },
        showToast: function(e, n) {
            n || (n = function() {}),
            this.toast || (this.toast = new t.ui.Toast),
            this.toast.show(e, 2, n, !0)
        },
        inWeixinShare: function() {
            function s() {
                WeixinJSBridge.invoke("sendAppMessage", {
                    appid: i,
                    img_url: e,
                    img_width: "200",
                    img_height: "200",
                    link: t,
                    desc: n,
                    title: r
                },
                function(e) {})
            }
            function o() {
                WeixinJSBridge.invoke("shareTimeline", {
                    img_url: e,
                    img_width: "200",
                    img_height: "200",
                    link: t,
                    desc: n,
                    title: r
                },
                function(e) {})
            }
            function u() {
                WeixinJSBridge.invoke("shareWeibo", {
                    content: n,
                    url: t
                },
                function(e) {})
            }
            var e = G,
            t = window.location.href,
            n = "这条旅游线路性价比挺高，有谁和我一起去吗？",
            r = Q ? Q: document.title,
            i = "";
            document.addEventListener("WeixinJSBridgeReady",
            function() {
                WeixinJSBridge.on("menu:share:appmessage",
                function(e) {
                    s()
                }),
                WeixinJSBridge.on("menu:share:timeline",
                function(e) {
                    o()
                }),
                WeixinJSBridge.on("menu:share:weibo",
                function(e) {
                    u()
                })
            },
            !1)
        },
        onShow: function() {
            var e = this;
            Q && (document.title = Q),
            this.referrer !== "vacationslist" && this.restoreScrollPos(),
            h.fixInertia(this),
            this._fixtab = $.proxy(this.fixtab, this),
            setTimeout(function() {
                $(window).bind("touchmove", e._fixtab),
                $(window).bind("scroll", e._fixtab)
            },
            0)
        },
        onHide: function() {
            document.title = "团队游",
            $(window).unbind("scroll"),
            $(window).unbind("touchmove"),
            $(window).unbind("touchend"),
            $("body").unbind("touchstart"),
            B && B.hide()
        },
        to_question: function() {
            var e = "?productId=" + this.pid + "&saleCityId=" + this.saleCityId + "&departCityId=" + this.departCityId;
            this.forward("question" + e)
        },
        getCollectState: function() {
            var e = this.$el.find("#js_collect");
            e.attr("loading", "loading"),
            this.inMyCollectionModel.param = {
                UID: this.uid,
                QueryList: [{
                    BizType: "GROUP_TRAVEL",
                    ProductID: this.pid
                }]
            },
            this.inMyCollectionModel.excute(function(t) {
                t.ResponseStatus.Ack == "Success" ? (t.ResultCode == 0 && t.ResultList.length ? (e.addClass("collected"), this.fid = t.ResultList[0].FavoriteID) : e.removeClass("collected"), e.removeAttr("loading")) : this.showToast(t.ResponseStatus.Errors[0].Message)
            },
            function() {
                this.showToast("网络错误，请稍候重试。")
            },
            !1, this)
        },
        changeCollectState: function(e) {
            if (!this.isLogin) {
                this.login();
                return
            }
            var t = $(e.currentTarget);
            if (t.attr("loading")) return;
            t.attr("loading", "loading"),
            t.hasClass("collected") ? (this.removeCollectionModel.param = {
                UID: this.uid,
                FavoriteIdList: [this.fid]
            },
            this.removeCollectionModel.excute(function(e) {
                e.ResponseStatus.Ack == "Success" ? e.ResultCode == 0 && e.DeletedList.length && (this.showToast("已取消收藏"), t.removeClass("collected")) : this.showToast(e.ResponseStatus.Errors[0].Message),
                t.removeAttr("loading")
            },
            function() {
                this.showToast("网络错误，请稍候重试。"),
                t.removeAttr("loading")
            },
            !1, this)) : (this.addCollectionModel.param = {
                UID: this.uid,
                FavoriteList: {
                    BizType: "GROUP_TRAVEL",
                    ProductID: this.pid,
                    FromCityID: this.departCityId == 0 ? this.saleCityId: this.departCityId,
                    SaleCityID: this.saleCityId
                }
            },
            this.addCollectionModel.excute(function(e) {
                e.ResponseStatus.Ack == "Success" ? e.ResultCode == 0 && e.FavoriteIdList.length && (this.showToast("收藏成功"), t.addClass("collected"), this.fid = e.FavoriteIdList[0]) : this.showToast(e.ResponseStatus.Errors[0].Message),
                t.removeAttr("loading")
            },
            function() {
                this.showToast("网络错误，请稍候重试。"),
                t.removeAttr("loading")
            },
            !1, this))
        },
        login: function() {
            var e = location.pathname,
            t = location.hash;
            this.vaStorage.set("detail_return_param", t),
            at.memberLogin({
                param: "t=1&from=" + e + "#detail",
                callback: function() {
                    window.location.reload()
                }
            })
        },
        checkImgPos: function() {
            var e = this,
            t = this.$el.find(".route_detail");
            if (t.find("img").length) {
                var n = t.find("ul");
                n.each(function(t, n) {
                    document.body.scrollTop + document.body.offsetHeight > $(n).offset().top && e.loadImgsInDom($(n))
                })
            }
        },
        loadImgsInDom: function(e) {
            if (e.length < 1) return;
            $.type(e) != "array" && (e = $(e));
            var t = $("img", e);
            t.each(function(e, t) {
                var n = $(t),
                r = n.attr("data-src");
                n.attr("src") != r && (n.css("display", "none"), t.onload = function() {
                    n.show()
                },
                t.onerror = function() {
                    n.show()
                },
                n.attr("src", r))
            })
        }
    });
    return ft
}),
define("views/BookingBaseView", ["VaBaseView"],
function(e) {
    return e.extend({
        events: {
            "click .js-tip-wrapper .js-tip-title": "onTipTitleClick"
        },
        onTipTitleClick: function(e) {
            var t = $(e.currentTarget),
            n = t.siblings(".js-tip-content"),
            r = t.hasClass("open");
            r ? (t.removeClass("open"), n.addClass("hidden")) : (t.addClass("open"), n.removeClass("hidden"))
        }
    })
}),
define("views/select.calendar", ["libs", "c", "./BookingBaseView", "cWidgetFactory", "cWidgetCalendarPrice", "res/scripts/util", "TourModel"],
function(e, t, n, r, i, s, o) {
    var u = '<div class="select_date_tips"><i class="icon_date"></i>有绿色角标的日期代表已成团</div>',
    a, f;
    i = r.create("Calendar.Price");
    var l = n.extend({
        onCreate: function() {
            this.injectHeaderView()
        },
        _dealData: function(e) {
            var t = e[s.CONST.STORE_BOOKING_CALENDAR] || {};
            return t.title = t.title || "选择日期",
            t.type = t.type || "single",
            e
        },
        vaOnLoad: function(e) {
            this._dealData(e),
            a = e[s.CONST.STORE_BOOKING_CALENDAR] || {},
            this.vaStorage.set(s.CONST.STORE_BOOKING_CALENDAR, a),
            f = t.utility.isInApp();
            if (s.ensureAll(a, ["nexturi"])) {
                var n = this;
                this.vaShowLoading();
                var r;
                if (a.type != "single") return;
                r = o.BookingPriceCalendar.getInstance(),
                r.param = {
                    pId: s.int(a.pid),
                    saleCity: a.sale_city,
                    departureCity: a.departure_city,
                    sDate: "2000-01-01",
                    eDate: "2099-12-31",
                    head: null
                },
                r.vaExec({
                    scope: this,
                    onComplete: function(e, t) {
                        t(s.ensureAll(e, ["dailys"]), "没有可选日期") && (this.headerview.set({
                            title: a.title,
                            back: !0,
                            view: this,
                            events: {
                                returnHandler: function() {
                                    this.hideToast(),
                                    this.vaBack({},
                                    a.fromuri)
                                }
                            }
                        }), this.headerview.show(), this.startDate = s.calendar.strToDate(_.first(e.dailys).date), this.endDate = s.calendar.strToDate(_.last(e.dailys).date), this.diffYear = this.endDate.getFullYear() - this.startDate.getFullYear(), this.diffMonth = this.diffYear * 12 + (this.endDate.getMonth() - this.startDate.getMonth()), this.diffMonth += 1, this.diffMonth > 6 && (this.diffMonth = 6), this.showPriceCalendar(e, a.selected_date), this.turning())
                    },
                    onError: function(e) {
                        this.showToast(e.errmsg || "网络错误，请重试", 3,
                        function() {
                            n.vaBack({},
                            a.fromuri)
                        },
                        !0)
                    },
                    onAlways: function() {
                        this.vaHideLoading()
                    }
                })
            } else {
                var n = this;
                this.showToast("数据不全", 3,
                function() {
                    n.vaBack({},
                    a.fromuri)
                })
            }
        },
        onShow: function() { ! f || $(".cui_cldweek").css("top", 0)
        },
        onHide: function() {},
        showPriceCalendar: function(e, t) {
            var n = this,
            r = _.map(e.dailys,
            function(e) {
                return {
                    date: s.calendar.strToDate(e.date),
                    price: e.price
                }
            }),
            o = r[0].date,
            f = new Date(o - 0);
            f.setDate(1);
            var l = this.$el;
            l.empty(),
            this.calendar = new i({
                date: {
                    start: {
                        title: function(e, t) {
                            var n = t(e);
                            return n
                        },
                        value: t || ""
                    }
                },
                formatPrice: function(e, t) {
                    var n = "";
                    return e !== "" && (e == 0 ? n = "<i>实时计价</i>": n = "<i>¥" + e + "起</i>"),
                    n
                },
                noabsolute: !0,
                rootBox: this.$el,
                curDate: "start",
                validDates: r,
                callback: function(e) {
                    var t = n.vaStorage.get(s.CONST.STORE_BOOKING_CALENDAR);
                    t.selected_date = s.calendar.format(e),
                    n.vaStorage.set(s.CONST.STORE_BOOKING_CALENDAR, t),
                    n.vaBack({},
                    a.nexturi)
                },
                Months: this.diffMonth,
                startMonth: f,
                validStartDate: o,
                msg: "",
                onShow: _.bind(function() {
                    _.each(e.dailys,
                    function(e) {
                        if (e.isGroup) {
                            var t = l.find('li[data-date="' + e.date + '"]');
                            t && t.addClass("cal-is-group")
                        }
                    }),
                    l.find(".cui_cldwrap").prepend(u);
                    var t = l.find(".invalid.cui_cld_day_havetxt");
                    t.removeClass("cui_cld_daypass").removeClass("invalid").addClass("cui_cld_dayfuture").addClass("valid")
                },
                this),
                onHide: _.bind(function() {},
                this)
            }),
            this.calendar.show()
        }
    });
    return l
}),
define("text!templates/booking.step2.html", [],
function() {
    return '<div class="body">\r\n    <!-- 机票 S -->\r\n    <% if(flights && flights.length){ %>\r\n    <div class="book_mod js-flight">\r\n        <h2 class="box_hd">机票</h2>\r\n         <% if(CanDirectFlightChanne){ %>\r\n          <div class="book_notice">抵用券或礼品卡等消费券支付的金额不提供报销凭证</div>\r\n        <% } %>\r\n        <% _.each(flights, function(flight){ %>\r\n        <div class="box_bd plan_list">\r\n            <h3>\r\n                <%= flight.departDateMonth%>月<%=flight.departDateDay%>日 <%=flight.departTime%> - <%=flight.arriveTime%>\r\n                <% if(flight.nextDay != 0){ %>\r\n                <span class="plan_date"><% if(flight.nextDay > 0){ %>+<% } %><%= flight.nextDay %>天</span>\r\n                <% } %>\r\n            </h3>\r\n            <p><%= flight.departAName %> <% if(flight.flightStops){ %><span class="plan_stop">经停</span><% }else{ %><span class="plan_through"></span><% } %> <%= flight.arriveAName %></p>\r\n            <p><%= flight.airName %> <%= flight.flightNo %> <%= flight.className %></p>\r\n            <% if(flight.limtCont){ %>\r\n            <div class="box_hidden js-tip-wrapper">\r\n                <h4 class="js-tip-title">预订限制</h4>\r\n                <div class="hidden js-tip-content"><%= flight.limtCont %></div>\r\n            </div>\r\n            <% } %>\r\n             <% if(flight.IsDirectFlight){ %>\r\n            <div class="box_hidden js-tip-wrapper">\r\n                <h4 class="js-tip-title">直连机票</h4>\r\n                <div class="hidden js-tip-content">请注意您购买机票的免费行李额度，该机票婴儿无法预订。</div>\r\n            </div>\r\n            <% } %>\r\n        </div>\r\n        <% }); %>\r\n    </div>\r\n    <% } %>\r\n    <!-- 机票 E -->\r\n    <!-- 酒店 S -->\r\n    <% if(hotels && hotels.length){ %>\r\n    <div class="book_mod js-hotel">\r\n        <h2 class="box_hd">酒店</h2>\r\n        <% _.each(hotels, function(hotel, i){ %>\r\n        <% var defaultRoom = hotel.rooms[0]; %>\r\n        <div class="box_bd arrows_icon btn_active" data-seg-num="<%= hotel.segmNum %>" data-hotel-id="<%= hotel.hotelId %>" data-room-id="<%= defaultRoom.roomId %>" data-room-count="<%= defaultRoom.selectRoomNum %>">\r\n            <h3><%= hotel.cityName %> <%= hotel.hotelName %></h3>\r\n            <p><%= helper.dateFormat(hotel.checkInDate) %>-<%= helper.dateFormat(hotel.checkOutDate) %> <%= defaultRoom.selectRoomNum %>间</p>\r\n            <p class="grogshop_room"><%= defaultRoom.RoomName %></p>\r\n        </div>\r\n        <% }); %>\r\n    </div>\r\n    <% } %>\r\n    <!-- 酒店 E -->\r\n    <!------------------------------------------- 单选项 BEGIN -------------------------------------------->\r\n    <% if(singleResources && singleResources.length){ %>\r\n\r\n    <% _.each(iterableSingleResource, function(single){ %>\r\n    <% var titleName = single.isTraffic ? \'交通\' : single.cateName %>\r\n    <div class="book_mod js-single-item\r\n    <% if(single.cateId == 19){ %>\r\n    js-train\r\n    <% } else if(single.cateId == 20){ %>\r\n    js-bus\r\n    <% } else if(single.cateId == 21){ %>\r\n    js-ship\r\n    <% } else if(single.cateId == 22){ %>\r\n    js-taocan\r\n    <% } %>\r\n    " data-cat-id="<%= single.cateId %>" data-resource-id="<%= single.resId %>" data-seg-num="<%= single.segmNumb %>">\r\n        <h2 class="box_hd"><%= titleName %></h2>\r\n        <div class="box_bd package_list">\r\n            <% if(single.tCount > 1){ %><a href="javascript:;" class="btn_blue float_right js-btn-select">重选<%= titleName %></a><% } %>\r\n            <h3><%= single.departDate %></h3>\r\n            <p><%= single.name %></p>\r\n            <% if(single.intro){ %>\r\n            <div class="box_hidden js-tip-wrapper">\r\n                <h4 class="js-tip-title">说明</h4>\r\n                <div class="hidden js-tip-content"><%= single.intro %></div>\r\n            </div>\r\n            <% } %>\r\n        </div>\r\n    </div>\r\n    <% }); %>\r\n    <% } %>\r\n    <!------------------------------------------- 单选项 END -------------------------------------------->\r\n    <!------------------------------------------- 可选项 BEGIN -------------------------------------------->\r\n    <% if(haveOptional){ %>\r\n    <!-- 附加产品 S -->\r\n    <div class="book_mod js-optional">\r\n        <h2 class="box_hd">附加产品</h2>\r\n        <% _.each(optionalResources, function(optional){ %>\r\n        <% if(optional.isShown){ %>\r\n        <% var isNumberPicker = optional.opType == \'numberpicker\' %>\r\n        <div data-resource-id="<%= optional.resId %>"\r\n             data-interact-type="<% if(isNumberPicker){ %>numberpicker<% } else { %>switcher<% } %>"\r\n             class="box_bd arrows_icon btn_active js-item">\r\n            <table class="base_tb" width="100%">\r\n                <tr>\r\n                    <th><%= optional.name %></th>\r\n                    <td style="width:120px"><span class="base_price"><dfn>&yen;</dfn><%= optional.choosedInventory.price %></span>×<%= getOptionalCount(optional) %><%= optional.unit %></td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n        <% } %>\r\n        <% }); %>\r\n\r\n    </div>\r\n    <!-- 附加产品 E -->\r\n    <% } %>\r\n    <!------------------------------------------- 可选项 END -------------------------------------------->\r\n</div>\r\n<footer class="book_next">\r\n    <div class="next_col">\r\n        订单总额：<dfn>¥</dfn><%= tPrice %>\r\n        <em class="price_detail js-price-detail">费用明细</em>\r\n        <a href="javascript:;" class="btn_next">下一步</a>\r\n    </div>\r\n</footer>\r\n'
}),
define("text!templates/widget.price.detail.html", [],
function() {
    return '<div class="pop pop_cost js-pop-price-detail" style="display:none;z-index:9999">\r\n    <h2 class="pop_title">费用明细</h2>\r\n    <div class="pop_bd">\r\n        <ul class="base_list order_list">\r\n            <li>\r\n                <h3>基本团费</h3>\r\n                <table class="base_tb" width="100%">\r\n                    <tbody>\r\n                        <tr>\r\n                            <th>成人</th>\r\n                            <td style="width:110px"><span class="base_price"><dfn>¥</dfn><%=Math.floor(priceDetail.aduAmt/adultNum)%>/人x<%=adultNum%></span></td>\r\n                        </tr>\r\n                        <%if(childNum){%>\r\n                        <tr>\r\n                            <th>儿童</th>\r\n                            <td><span class="base_price"><dfn>¥</dfn><%=Math.floor(priceDetail.cAmt/childNum)%>/人x<%=childNum%></span></td>\r\n                        </tr>\r\n                        <%}%>\r\n                    </tbody>\r\n                </table>\r\n            </li>\r\n            <%if(priceDetail.addFreeAmt){%>\r\n            <li>\r\n                <h3>附加费</h3>\r\n                <table class="base_tb" width="100%">\r\n                    <tbody>\r\n                        <tr>\r\n                            <th></th>\r\n                            <td style="width:70px"><span class="base_price"><dfn>¥</dfn><%=priceDetail.addFreeAmt%></span></td>\r\n                        </tr>\r\n                        <%_.each(priceDetail.addFreeLst, function(v,k){%>\r\n                            <%if(v.qty != 0){%>\r\n                            <tr>\r\n                                <th><%=v.proNM%></th>\r\n                                <td><span class="base_price"><%=v.qty+v.unit%></span></td>\r\n                            </tr>\r\n                            <%}%>\r\n                        <%})%>\r\n                    </tbody>\r\n                </table>\r\n            </li>\r\n            <%}%>\r\n            <li class="coupon_li" style="<%=priceDetail.preferPrice ? \'\' : \'display:none;\'%>">\r\n                <h3>优惠</h3>\r\n                <span class="base_price">-<dfn>¥</dfn><span class="discount"><%=Math.abs(priceDetail.preferPrice)%></span></span>\r\n            </li>\r\n        </ul>\r\n        <div class="price_all">订单总额：<span class="base_price"><dfn>¥</dfn><span class="total"><%=Math.floor(tPrice)%></span></span></div>\r\n    </div>\r\n</div>\r\n'
}),
define("views/booking.step2.manager", ["TourStore", "res/scripts/util"],
function(e, t) {
    var n = e.BookStep2Store.getInstance(),
    r = e.BookStep2GUIDStore.getInstance(),
    i = e.BookStep2ChoosedResourceStore.getInstance(),
    s = e.BookStep2HotelStore.getInstance(),
    o = e.BookStep2SingleStore.getInstance(),
    u = e.BookStep2OptionalStore.getInstance();
    return {
        optionalManager: {
            getSelectCount: function(e, t) {
                if (e.select_count === undefined && !t && !e.choosedInventory) throw "not set choosedInventory to optional.";
                return t = t || e.choosedInventory,
                e.select_count === undefined ? t.dQ: e.select_count
            }
        },
        guidManager: {
            cache: r.get() || {},
            clear: function() {
                return this.store(this.cache = {})
            },
            store: function() {
                return r.set(this.cache),
                this
            },
            getKey: function(e) {
                if (t.ensureAll(e, ["departDate", "adultNum", "childNum", "pId"])) return e.departDate + "--" + e.adultNum + "--" + e.childNum + "--" + e.pId;
                throw "GUID 数据不全"
            },
            get: function(e) {
                return this.cache[this.getKey(e)]
            },
            set: function(e, t) {
                return t === null ? delete this.cache[this.getKey(e)] : this.cache[this.getKey(e)] = t,
                this
            }
        },
        choosedResourceManager: {
            _data: i.get(),
            set: function(e) {
                return this._data = e,
                i.set(e),
                this
            },
            get: function() {
                return this._data
            },
            getStr: function() {
                return this._data ? JSON.stringify(this._data) : ""
            },
            dealStoredHotel: function() {
                var e = s.get(),
                t = this._data;
                return t && _.each(e,
                function(e, n) {
                    var r = e.dataAfterEdit,
                    i = r.seg_num,
                    s = _.find(t.ChosedHotelResourceList,
                    function(e) {
                        return e.HotelId == n && e.Segement == i
                    });
                    s && !_.isEmpty(r) && (s.RoomId = r.roomId, s.SelectedRoomNum = r.tranferSelectNum)
                }),
                this
            },
            dealStoredSingle: function() {
                var e = o.get(),
                t = this._data;
                return t && _.each(e,
                function(e, n) {
                    var r = e.dataAfterEdit,
                    i = _.find(t.ChosedSingleResourceList,
                    function(e) {
                        return e.SegmentID == n
                    });
                    i && !_.isEmpty(r) && (i.DepartureDate = r.singleResource.departDate, i.ProductID = r.singleResource.resId)
                }),
                this
            },
            dealStoredOptional: function() {
                var e = u.get(),
                t = this._data;
                return t && _.each(e,
                function(e, n) {
                    var r = e.dataAfterEdit,
                    i = _.find(t.ChosedOptionResourceList,
                    function(e) {
                        return e.ProductID == n
                    });
                    i && !_.isUndefined(r.count) && (i.UseCopies = r.count)
                }),
                this
            }
        }
    }
}),
define("views/booking.step2", ["libs", "c", "./BookingBaseView", "text!templates/booking.step2.html", "text!templates/widget.price.detail.html", "TourModel", "TourStore", "res/scripts/util", "CommonStore", "cWidgetFactory", "cWidgetMember", "./booking.step2.manager"],
function(e, t, n, r, i, s, o, u, a, f, l, c) {
    var h = f.create("Guider"),
    p = o.BookStep2Store.getInstance(),
    d = o.BookStep2GUIDStore.getInstance(),
    v = o.BookStep2BaoxianStore.getInstance(),
    m = o.BookStep2ChoosedResourceStore.getInstance(),
    g = o.BookStep2HotelStore.getInstance(),
    y = o.BookStep2SingleStore.getInstance(),
    b = o.BookStep2OptionalStore.getInstance(),
    w = o.BookStep3OrderData.getInstance(),
    E = s.BookingResourceSearch.getInstance(),
    S = s.AnonymousUserModel.getInstance(),
    x,
    T,
    N = c.guidManager,
    C = c.choosedResourceManager,
    k = c.optionalManager,
    L = t.utility.isInApp(),
    A = !1,
    O = [20, 21, 19],
    M = f.create("Member"),
    D = a.UserStore.getInstance(),
    P,
    H = n.extend({
        pageid: L ? "220082": "220005",
        clearAllStore: function() {
            return T && delete T.defaultORs,
            C.set(null),
            N.clear(),
            d.remove(),
            v.remove(),
            m.remove(),
            g.remove(),
            y.remove(),
            b.remove(),
            this
        },
        events: {
            "click .btn_next": "onNextClick",
            "click .js-hotel .box_bd": "onHotelClick",
            "click .js-single-item .js-btn-select": "onSingleClick",
            "click .js-optional .js-item": "onOptionalClick",
            "click .js-price-detail": "onPriceDetailClick"
        },
        render: function(e) {
            e.getOptionalCount = k.getSelectCount;
            var t = _.template(r),
            n = t(e);
            return this.$el.html(n),
            this
        },
        onCreate: function() {
            P = new t.ui.Mask({
                classNames: "order-layer"
            }),
            this.injectHeaderView()
        },
        vaOnLoad: function(e, t) {
            this.referrer = t || "",
            x = p.get();
            var n = e.type;
            n == "forward" && this.clearAllStore(),
            this.headerview.set({
                title: "确认产品",
                back: !0,
                view: this,
                events: {
                    returnHandler: function() {
                        P && P.hide(),
                        this.vaBack({},
                        u.getPath("booking_step1"))
                    }
                }
            }),
            this.headerview.show();
            if (u.ensureAll(x, ["pid", "departure_city", "depart_date", "adult_num", "child_num", "sale_city", "oc_mode", "guid"])) if (T && n === "back") this.whenGetData();
            else {
                this.vaShowLoading();
                var r = {
                    pId: x.pid,
                    departDate: u.calendar.format(x.depart_date),
                    adultNum: x.adult_num,
                    childNum: x.child_num
                };
                E.param = {
                    pId: x.pid,
                    departCId: x.departure_city,
                    departDate: r.departDate,
                    adultNum: x.adult_num,
                    childNum: x.child_num,
                    saleCId: x.sale_city,
                    ocMode: x.oc_mode,
                    chosedResource: C.dealStoredHotel().dealStoredSingle().dealStoredOptional().getStr(),
                    defaultORs: T && T.defaultORs,
                    reqType: [1, 2],
                    guid: N.get(r) || ""
                },
                E.vaExec({
                    onComplete: function(e, t) {
                        t(u.ensureAll(e, ["chosedResource"]), "没有可选资源") && (T = e, e.chosedResource = JSON.parse(e.chosedResource), this._dealAjaxData(e), t(u.ensureSome(e.chosedResource, ["ChosedFlightResource", "ChosedHotelResourceList", "ChosedOptionResourceList", "ChosedSingleResourceList"]), "没有可选资源") && (N.set(r, e.guid).store(), C.set(e.chosedResource), this.whenGetData()))
                    },
                    onError: function(e) {
                        this.whenError(e.errmsg || "网络错误，请重试")
                    },
                    onAlways: function() {
                        this.vaHideLoading()
                    },
                    scope: this
                })
            } else this.whenError("正在重新加载资源")
        },
        _dealAjaxData: function(e) {
            function s(e) {
                var t = e.isRequired == 1;
                return ! t
            }
            var t = this;
            e.getPath = u.getPath,
            e.helper = u.helper,
            e.optionalResources = _.sortBy(e.optionalResources,
            function(e) {
                return e.cateId != 14
            }),
            _.each(e.flights,
            function(e) {
                var t = e.departDate.split("-");
                e.departDateMonth = t[1],
                e.departDateDay = t[2]
            }),
            _.indexOf(_.pluck(e.flights, "IsDirectFlight"), true) != -1 ? e.CanDirectFlightChanne = !0 : e.CanDirectFlightChanne = !1,
            _.each(e.hotels,
            function(e) {
                var t = g.get() || "";
                _.each(t,
                function(t) {
                    e.roomTCount = t.dataAfterEdit.tranferSelectNum
                })
            }),
            e.singleResources && e.singleResources.length && (e.iterableSingleResource = e.singleResources, e.iterableSingleResource.sort(function(e, t) {
                return e.segmNumb > t.segmNumb
            }), _.each(e.iterableSingleResource,
            function(e) {
                e.isTraffic = _.indexOf(O, e.cateId) >= 0
            }));
            if (e.optionalResources && e.optionalResources.length) {
                var n = [],
                r = [],
                i = 0;
                _.each(e.optionalResources,
                function(i, o) {
                    var u = i.name.indexOf("单房差") >= 0 || i.name.indexOf("单人房差") >= 0;
                    i.opType = u ? "numberpicker": _.indexOf([30, 15], i.cateId) >= 0 ? "numberpicker": "switcher";
                    var a;
                    i.choosedInventory = t._getOptionalDefaultInventory(e, o),
                    a = _.indexOf([14, 30, 15, 17, 18], i.cateId) >= 0,
                    a && (a = s(i), i.cateId == 14 && (n.push(i), a && i.choosedInventory.dQ <= 0 && (a = !1), a && r.push(i))),
                    i.isShown = a,
                    _.each(i.oris,
                    function(e, t) {
                        var n = !i.isRequired;
                        n ? e.js_minQ = 0 : e.js_minQ = e.minQ
                    })
                }),
                r.length < 1 && n.length > 0 ? (n.sort(function(e, t) {
                    return e.sortNum < t.sortNum
                }), _.each(n,
                function(e, t) {
                    t == 0 && (e.isShown = !0)
                })) : r.length > 1 && _.each(r,
                function(e, t) {
                    t > 0 && (e.isShown = !1)
                }),
                e.haveOptional = _.filter(e.optionalResources,
                function(e) {
                    return e.isShown
                }).length > 0
            } else e.haveOptional = !1;
            return this
        },
        _getOptionalDefaultInventory: function(e, t, n) {
            var r, i;
            return t >= 0 && (r = u.date.transform(e.chosedResource.ChosedOptionResourceList[t].UseDate), i = _.find(e.optionalResources[t].oris,
            function(e) {
                return e.date == r
            }) || e.optionalResources[t].oris[0]),
            i
        },
        whenGetData: function() {
            T.flights && T.flights.length || T.hotels && T.hotels.length || T.singleResources && T.singleResources.length || T.haveOptional ? (this.render(T).setPriceDetailContent(_.template(i, T)), this.turning()) : this.onNextClick("e", "?from=booking.step1")
        },
        whenError: function(e) {
            var t = this;
            this.showToast(e, 3,
            function() {
                t.vaBack({},
                u.getPath("booking_step1"))
            })
        },
        setPriceDetailContent: function(e) {
            return this.$el.find(".js-pop-price-detail").remove(),
            this.$el.append(e),
            this
        },
        onPriceDetailClick: function(e) {
            if (P) {
                P.show();
                var t = $(".js-pop-price-detail").show();
                $("#" + P.id).one("click",
                function() {
                    P.hide(),
                    t.hide()
                })
            }
        },
        onHotelClick: function(e) {
            var t = $(e.currentTarget),
            n = t.data("hotel-id"),
            r = t.data("seg-num"),
            i = t.data("room-count"),
            s = _.find(T.hotels,
            function(e, t) {
                return e.hotelId == n && e.segmNum == r
            }),
            o = g.get() || {};
            o[n] = {
                dataWhenEdit: {
                    pId: x.pid,
                    segmNum: s.segmNum,
                    checkInDate: s.checkInDate,
                    checkOutDate: s.checkOutDate,
                    adultNum: x.adult_num,
                    childNum: x.child_num,
                    hotels: s.hotelId,
                    roomCount: s.roomTCount,
                    orderName: "PKG",
                    orderType: "DESC",
                    hotelCount: 8
                },
                dataAfterEdit: o[n] && o[n].dataAfterEdit || {}
            },
            g.set(o),
            this.vaForward({},
            u.getPath("booking_select_hotel", {
                hotelid: s.hotelId,
                roomid: s.rooms[0].roomId,
                seg_num: r,
                roomcount: i
            }))
        },
        onSingleClick: function(e) {
            var t = $(e.currentTarget).parents(".js-single-item"),
            n = t.data("cat-id"),
            r = t.data("resource-id"),
            i = _.find(T.singleResources,
            function(e) {
                return e.resId == r
            }),
            s = i.segmNumb,
            o = y.get() || {},
            a = o[r] && o[r].dataAfterEdit || {};
            o[s] = {
                dataWhenEdit: {
                    resid: r,
                    segmentid: i.segmId,
                    isTraffic: i.isTraffic,
                    departDate: i.departDate,
                    cateName: i.cateName
                },
                dataAfterEdit: o[s] && o[s].dataAfterEdit || {}
            },
            y.set(o),
            this.vaForward({},
            u.getPath("booking_select_single", {
                segnum: s,
                catid: n
            }))
        },
        onOptionalClick: function(e) {
            var t = $(e.currentTarget),
            n = t.data("interact-type"),
            r = t.data("resource-id"),
            i = _.find(T.optionalResources,
            function(e) {
                return e.resId == r
            }),
            s = b.get() || {},
            o = s[r] && s[r].dataAfterEdit || {};
            s[r] = {
                dataWhenEdit: {
                    name: i.name,
                    price: i.choosedInventory.price,
                    unit: i.unit,
                    type: n,
                    cateName: i.cateName,
                    cateId: i.cateId,
                    intro: i.intro,
                    min: i.choosedInventory.js_minQ,
                    max: i.choosedInventory.maxQ,
                    baoxianSwitchCount: i.cateId == 14 && T.defaultORs && T.defaultORs[0] && T.defaultORs[0].oris[0].dQ,
                    step: i.choosedInventory.stepQ,
                    defaultCount: k.getSelectCount(i)
                },
                dataAfterEdit: o
            },
            b.set(s),
            this.vaForward({},
            u.getPath("booking_select_optional", {
                resid: r
            }))
        },
        login: function(e) {
            var t = this;
            t.showLoading();
            if (L) {
                M.nonMemberLogin({
                    param: "from=/webapp/tour/" + u.getPath("order") + "&t=1",
                    callback: function() {
                        t.forward(e)
                    }
                });
                return
            }
            S.excute(function(n) {
                n && n.head && n.head.errcode == 0 && t.forward(e)
            },
            function(e) {
                t.hideLoading(),
                t.showToast(e.errmsg || "网络不给力，请稍后重试")
            })
        },
        onNextClick: function(e, t) {
            var n = t || "",
            r;
            w.set({
                adultNum: x.adult_num,
                childNum: x.child_num,
                departCId: x.departure_city,
                departDate: x.depart_date,
                guid: E.param.guid,
                orderSegms: T.orderSegms,
                pId: x.pid,
                saleCId: x.sale_city,
                unqCd: ""
            }),
            x.isIntentOrder ? r = u.getPath("order_intention") + n: r = u.getPath("order") + n,
            D.isLogin() ? this.vaForward({},
            r) : this.login(r)
        },
        onShow: function() {
            this.restoreScrollPos()
        },
        onHide: function() {}
    });
    return H
}),
define("text!templates/order.html", [],
function() {
    return '<%var store = storeData,ivc = store.oIvc,dly = store.oDy,cp = store.coupon;%>\r\n<div class="body">\r\n    <%if(!isLogin){%>\r\n    <div class="top_login">\r\n        <a href="javascript:;" class="btn_org_s js_login">马上登录</a>\r\n        登录后预订更便捷\r\n    </div>\r\n    <%}%>\r\n	<!-- 旅客 S -->\r\n	<ul class="base_list order_list">\r\n        <li class="add_icon add_passenger btn_active">\r\n            <h3>旅客</h3>\r\n            <div class="passenger_datail">\r\n                <p class="grey"><%=oData.adu%>位成人<%= oData.chl ? \'，\'+oData.chl+\'位儿童\' : \'\'%></p>\r\n            </div>\r\n        </li>\r\n		<%if(store.pInfs){_.each(store.pInfs,function(v,k){var ename = v.eNm;%>\r\n		<li class="arrows_icon passenger_li" data-id="<%=v.pId || v.tempID%>" data-age="<%=v.aegRg%>" data-idtype="<%=v.iCdInf && v.iCdInf.length && v.iCdInf[0].iCdtp%>">\r\n			<div class="passenger_datail">\r\n				<p><%=v.cNm ? v.cNm : (ename && ename.l ? ename.l+\'/\'+ename.f+\' \'+ename.m : \'\')%></p>\r\n				<%if(v.iCdInf && v.iCdInf.length){%>\r\n				<p class="certificate"><span><%=idCardType[v.iCdInf[0].iCdtp]%></span>&nbsp;<em><%=v.iCdInf[0].icdNo%></em></p>\r\n				<%}%>\r\n			</div>\r\n		</li>\r\n		<%})}%>\r\n	</ul>\r\n	<!-- 旅客 E -->\r\n    <ul class="base_list order_list">\r\n        <li class="ctcNm">\r\n            <h3><label for="name">姓名</label></h3>\r\n            <input type="text" class="input_text" placeholder="姓名" value="<%=store.ctcNm%>" id="name">\r\n        </li>\r\n        <li class="mobile">\r\n            <h3><label for="contact">联系手机</label></h3>\r\n            <input type="tel" class="input_text" placeholder="手机号码" value="<%=store.mobile%>" id="contact">\r\n        </li>\r\n        <li class="email">\r\n            <h3><label for="email">电子邮件</label></h3>\r\n            <input type="text" class="input_text" placeholder="用于接收确认单" value="<%=store.email%>" id="email">\r\n        </li>\r\n        <!-- 是否需要发票 -->\r\n        <%if(ivc){%>\r\n        <li>\r\n            <h3>发票</h3>\r\n            <a href="javascript:;" class="btn_invoice btn_on"></a>\r\n        </li>\r\n        <li class="invoice">\r\n            <h3><label for="ivc_title">发票抬头</label></h3>\r\n            <input type="text" class="input_text" placeholder="请填写发票抬头" id="ivc_title" value="<%=ivc.title%>">\r\n        </li>\r\n        <li class="invoice invoice-detail arrows_icon btn_active">\r\n            <h3>发票明细</h3>\r\n            <span class="invoice-detail-input blue text_clip" index="<%=ivcIndex%>" id="ivc_detail"><%=ivc.cont ? ivc.cont : oIvc.ivcCt[0].value%></span>\r\n        </li>\r\n        <li class="invoice book_notice">礼品卡等消费券支付的金额不提供报销凭证</li>\r\n        <%}else{%>\r\n        <li>\r\n            <h3>发票</h3>\r\n            <a href="javascript:;" class="btn_invoice btn_off"></a>\r\n        </li>\r\n        <li class="invoice" style="display:none;">\r\n            <h3><label for="ivc_title">发票抬头</label></h3>\r\n            <input type="text" class="input_text" placeholder="请填写发票抬头" id="ivc_title">\r\n        </li>\r\n        <li class="invoice invoice-detail arrows_icon" style="display:none;">\r\n            <h3>发票明细</h3>\r\n            <span class="invoice-detail-input blue text_clip" id="ivc_detail" index="0"><%=ivc.cont ? ivc.cont : oIvc.ivcCt[0].value%></span>\r\n        </li>\r\n        <li class="invoice book_notice" style="display:none;">礼品卡等消费券支付的金额不提供报销凭证</li>\r\n        <%}%>\r\n        <!-- /////////////配送//////////// -->\r\n        <%if(isDelivery && dly && dly.dType){ var dtype = dly.dType,addr = dly.addr,dp = delivery.postage[dtype];%>\r\n        <li class="arrows_icon select_delivery delivery_item">\r\n            <h3>配送方式</h3>\r\n            <span class="blue selected_delivery btn_active" index="<%=dlyIndex%>" data-type="<%=dtype%>"><%=deliverType[dtype]%></span>\r\n        </li>\r\n        <li class="distribution delivery_item" id="deliveryWrap" index="<%=index%>" >\r\n            <%if(dtype == 2){ var index = _.indexOf(dTpl.slfAddr,addr.addr)%>\r\n            <div class="take_site">\r\n                <h3>自取地址</h3>\r\n                <%_.each(dTpl.slfAddr,function(v,k){%>\r\n                <dl class="selfAddrPick" data-index="<%=k%>">\r\n                    <dt><i class="<%= index == k ? \'cur\':\'\'%>"></i></dt>\r\n                    <dd><%=v%></dd>\r\n                </dl>\r\n                <%})%>\r\n            </div>\r\n            <%}else{%>\r\n            <div class="distribution_col arrows_icon select_address btn_active" data-type="<%=dtype%>">\r\n                <h3>配送地址</h3>\r\n                <div class="delivery_detail">\r\n                    <p><%=addr.rcpt%></p>\r\n                    <p><%=addr.addr%></p>\r\n                    <p><%=addr.mbl ? addr.mbl : addr.tel%></p>\r\n                </div>\r\n            </div>\r\n            <%if(dtype == 3 && dp){%>\r\n            <div class="book_notice">选择EMS邮寄需加收<span class="base_price"><%=dp%></span>元配送费</div>\r\n            <%}else if(dtype == 1 && dp){%>\r\n            <div class="book_notice">选择市内配送，需加收配送费<%=dp%>元起，具体金额以预订员确认为准。</div>\r\n            <%}%>\r\n            <%}%>\r\n        </li>\r\n        <%}else if(isDelivery){var dfdly = dfDelivery || {dType:delivery.ways[0],addr:{}};%>\r\n        <li class="arrows_icon select_delivery delivery_item" style="<%=isDlyShow ? \'\' : \'display:none;\'%>">\r\n            <h3>配送方式</h3>\r\n            <span class="blue selected_delivery btn_active" index="<%=dlyIndex%>" data-type="<%=dfdly.dType%>">\r\n                <%=deliverType[dfdly.dType]%>\r\n            </span>\r\n        </li>\r\n        <li class="distribution delivery_item"  id="deliveryWrap" style="<%=isDlyShow ? \'\' : \'display:none;\'%>" index="0">\r\n            <%if(dfdly.dType == 2){%>\r\n            <div class="take_site">\r\n                <h3>自取地址</h3>\r\n                <%_.each(dTpl.slfAddr,function(v,k){%>\r\n                <dl class="selfAddrPick" data-index="<%=k%>">\r\n                    <dt><i class="<%= !k ? \'cur\':\'\'%>"></i></dt>\r\n                    <dd><%=v%></dd>\r\n                </dl>\r\n                <%})%>\r\n            </div>\r\n            <%}else{%>\r\n            <div class="distribution_col arrows_icon select_address btn_active" data-type="<%=dfdly.dType%>">\r\n                <h3>配送地址</h3>\r\n                <%var dtype = dfdly.dType,dpostage = delivery.postage[dfdly.dType];if(dfdly.addr){ %>\r\n                <div class="delivery_detail">\r\n                    <p><%=dfdly.addr.rcpt%></p>\r\n                    <p><%=dfdly.addr.addr%></p>\r\n                    <p><%=dfdly.addr.tel%></p>\r\n                </div>\r\n                <%}%>\r\n                </div>\r\n            <%if(dtype==1 && dpostage){%>\r\n            <div class="book_notice">选择市内配送，需加收配送费<%=dpostage%>元起，具体金额以预订员确认为准。</div>\r\n            <%}%>\r\n            <%if(dtype==3 && dpostage){%>\r\n            <div class="book_notice">选择EMS邮寄需加收<%=dpostage%>元配送费。</div>\r\n            <%}%>\r\n            <%}%>\r\n        </li>\r\n        <%}%>\r\n        <!-- /////////////配送//////////// -->\r\n        <%if(pmtLst){%>\r\n        <li class="arrows_icon coupon btn_active" data-id="<%=cp ? cp.pmtID : \'\'%>">\r\n            <h3>优惠券</h3>\r\n            <%if(!cp){%>\r\n            <span class="blue">不使用</span>\r\n            <%}else{%>\r\n            <div class="delivery_detail">\r\n                <p><span class="base_price">-<dfn>¥</dfn><%=cp.rdAmt ? cp.rdAmt : \'已选择\'%></span></p>\r\n                <p><%=cp.DspNm%></p>\r\n            </div>\r\n            <%}%>\r\n        </li>\r\n        <%}%>\r\n        <li class="arrows_icon extras btn_active">\r\n            <h3>更多需求</h3>\r\n            <span class="more_demand">\r\n                <%if(store.remk){%>\r\n                <%=store.remk%>\r\n                <%}else{%>\r\n                无\r\n                <%}%>\r\n            </span>\r\n        </li>\r\n    </ul>\r\n	<p class="f14 m10">点击下一步表示已阅读并同意<a href="javascript:;" class="blue" id="booking_note">预订须知和重要条款</a></p>\r\n</div>\r\n<!-- /////////////价格明细///////////// -->\r\n<%var price = oData.oPrc;%>\r\n<footer class="book_next">\r\n	<div class="next_col">\r\n		订单总额：<dfn>¥</dfn><span class="total"><%=prcDtl.amt%></span><em class="price_detail">费用明细</em>\r\n		<a href="javascript:;" class="btn_next">下一步</a>\r\n	</div>\r\n</footer>\r\n<div class="pop pop_cost" style="display:none;z-index:9999">\r\n    <h2 class="pop_title">费用明细</h2>\r\n    <div class="pop_bd">\r\n        <ul class="base_list order_list">\r\n            <li>\r\n                <h3>基本团费</h3>\r\n                <table class="base_tb" width="100%">\r\n                    <tbody>\r\n                        <tr>\r\n                            <th>成人</th>\r\n                            <td style="width:110px"><span class="base_price"><dfn>¥</dfn><%=Math.floor(prcDtl.aduAmt/oData.adu)%>/人x<%=oData.adu%></span></td>\r\n                        </tr>\r\n                        <%if(oData.chl){%>\r\n                        <tr>\r\n                            <th>儿童</th>\r\n                            <td><span class="base_price"><dfn>¥</dfn><%=Math.floor(prcDtl.cAmt/oData.chl)%>/人x<%=oData.chl%></span></td>\r\n                        </tr>\r\n                        <%}%>\r\n                    </tbody>\r\n                </table>\r\n            </li>\r\n            <%if(prcDtl.addFreeAmt){%>\r\n            <li>\r\n                <h3>附加费</h3>\r\n                <table class="base_tb" width="100%">\r\n                    <tbody>\r\n                        <tr>\r\n                            <th></th>\r\n                            <td style="width:70px"><span class="base_price"><dfn>¥</dfn><%=prcDtl.addFreeAmt%></span></td>\r\n                        </tr>\r\n                        <%_.each(prcDtl.addFreeLst,function(v,k){%>\r\n                        <%if(v.qty != 0){%>\r\n                        <tr>\r\n                            <th><%=v.proNM%></th>\r\n                            <td><span class="base_price"><%=v.qty+v.unit%></span></td>\r\n                        </tr>\r\n                        <%}%>\r\n                        <%})%>\r\n                    </tbody>\r\n                </table>\r\n            </li>\r\n            <%}%>\r\n            <li class="delivery_li" style="<%=prcDtl.frght ? \'\' : \'display:none;\'%>">\r\n                <h3>配送费</h3>\r\n                <span class="base_price"><dfn>¥</dfn><span class="postage"><%=prcDtl.frght%></span></span>\r\n            </li>\r\n            <li class="coupon_li" style="<%=prcDtl.dsctAmt ? \'\' : \'display:none;\'%>">\r\n                <h3>优惠</h3>\r\n                <span class="base_price">-<dfn>¥</dfn><span class="discount"><%=prcDtl.dsctAmt%></span></span>\r\n            </li>\r\n        </ul>\r\n        <div class="price_all">订单总额：<span class="base_price"><dfn>¥</dfn><span class="total"><%=Math.floor(prcDtl.amt)%></span></span></div>\r\n    </div>\r\n</div>\r\n'
}),
define("CPageStore", ["cStore", "cBase", "cUtility"],
function(e, t, n) {
    var r = {};
    r.HotelInfoStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "HOTEL_INFO",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.HotelInfoParamStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "HOTEL_INFO_PARAM",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.CommentListParamStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "COMMENTLIST_PARAM",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.ExplainPageStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "EXPLAIN_PAGE",
            this.lifeTime = "30M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.passengerEditStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLIGHT_PASSENGEREDIT",
            this.lifeTime = "1H"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.isBookingEditStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLIGHT_ISBOOKINGEDIT",
            this.lifeTime = "60M"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.passengerQueryStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLIGHT_PASSENGERRESULT",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.passengerChooseStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLIGHT_PASSENGERCHOOSE",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.passPageTypeStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLIGHT_PAGETYPE",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.CountryDataStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "FLTINT_COUNTRYDATA",
            this.lifeTime = "15D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    });
    var i = new t.Class(e, {
        __propertys__: function() {
            this.CONST_TAG = "tag",
            this.CONST_BACKURL = "backurl",
            this.CONST_CALLBACK = "callback",
            this.CONST_CURVALUE = "curvalue"
        },
        initialize: function($super, e) {
            $super(e)
        },
        save: function(e, t) {
            var n = this.get(),
            r = this,
            i = 0;
            $.isArray(n.callback) ? $.each(n.callback,
            function(s, o) {
                r._callFunByStr(o, e, null,
                function() {
                    i++,
                    i === n.callback.length && t && t()
                })
            }) : this._callFunByStr(n.callback, e, null,
            function() {
                t && t()
            })
        },
        setCurrent: function(e, t, n, r) {
            var i = {};
            i[this.CONST_TAG] = e,
            i[this.CONST_BACKURL] = t,
            i[this.CONST_CALLBACK] = n,
            i[this.CONST_CURVALUE] = r,
            this.set(i)
        },
        getCurrent: function() {
            return this.get()
        },
        getValue: function(e) {
            var t = this.get();
            return this._callFunByStr(t.curvalue, null, null, e)
        },
        _callFunByStr: function(e, t, n, i) {
            n = n || r;
            var s = /^(?:(\w*)::)?(\w*):(\w*)$/i.exec(e),
            o,
            u;
            if (s && s.length === 4) if (s[1]) require([s[1]],
            function(e) {
                var n = e[s[2]],
                r = s[3];
                if (n && n.getInstance) {
                    var o = n.getInstance()[r](t);
                    i && i(o)
                }
            });
            else {
                o = n[s[2]],
                u = s[3];
                if (o && o.getInstance) {
                    var a = o.getInstance()[u](t);
                    return i && i(a),
                    a
                }
            }
            return ! 1
        }
    });
    return r.CustomerAddrListStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "CAR_CUSTOMER_ADDR_LIST",
            this.lifeTime = "15D"
        },
        initialize: function($super, e) {
            $super(e)
        },
        addAddr: function(e, t) {
            var n = this.get();
            return n || (n = {
                count: 0,
                addrs: []
            }),
            e.inforId == 0 && (e.inforId = n.addrs.length + 1),
            n.addrs.unshift(e),
            n.count++,
            this.set(n, t),
            e.inforId
        },
        removeAddr: function(e, t) {
            var n = this.get(),
            r = n.addrs,
            i = -1;
            for (var s = 0,
            o = r.length; s < o; s++) if (r[s].inforId == e) {
                i = s;
                break
            }
            i > -1 && (r.splice(i, 1), n.count--),
            this.set(n, t)
        }
    }),
    r.CustomerAddrStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "CAR_CUSTOMER_ADDR",
            this.lifeTime = "30M",
            this.defaultData = {
                addr: "",
                addrId: 1,
                cty: "",
                destCtyId: 1,
                dstr: "",
                dstrId: 1,
                edTime: "",
                fee: 0,
                gua: !1,
                ldTime: "",
                mphone: "",
                phone: "",
                port: "",
                prvn: "",
                recipient: "",
                rmk: "",
                type: 1,
                zip: "",
                prvnId: "",
                inforId: 0,
                ctyName: "",
                dstrName: "",
                prvnName: ""
            }
        },
        initialize: function($super, e) {
            $super(e)
        },
        setAddr: function(e) {
            this.set(e, r.AddressStore.getInstance().getCurrent().tag)
        }
    }),
    r.AddressStore = new t.Class(i, {
        __propertys__: function() {
            this.key = "CAR_ADDRESS",
            this.lifeTime = "1D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.SelectAddrStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "CAR_SELECT_ADDR",
            this.lifeTime = "30M",
            this.rollbackEnabled = !0,
            this.defaultData = {
                addr: "",
                addrId: 1,
                cty: "",
                destCtyId: 1,
                dstr: "",
                dstrId: 1,
                edTime: "",
                fee: 0,
                gua: !1,
                ldTime: "",
                mphone: "",
                phone: "",
                port: "",
                prvn: "",
                recipient: "",
                rmk: "",
                type: 1,
                zip: "",
                prvnId: "",
                inforId: 0,
                ctyName: "",
                dstrName: "",
                prvnName: ""
            }
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.PostCityStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "CAR_POST_CITY_DATA",
            this.lifeTime = "30D"
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r.OperAddrStore = new t.Class(e, {
        __propertys__: function() {
            this.key = "CAR_OPER_ADDR",
            this.lifeTime = "30M",
            this.defaultData = {
                recipient: "",
                addr: "",
                zip: "",
                prvnId: "",
                prvnName: "",
                ctyName: "",
                dstrName: "",
                inforId: 0
            }
        },
        initialize: function($super, e) {
            $super(e)
        }
    }),
    r
}),
define("views/order", ["libs", "c", "VaBaseView", "CommonStore", "text!templates/order.html", "TourModel", "TourStore", "cWidgetFactory", "cWidgetMember", "cUIScrollRadioList", "cUIScrollRadio", "res/data/orderdata", "CPageStore", "cUtilityCrypt", "cUtility"],
function(e, t, n, r, i, s, o, u, a, f, l, c, h, p, d) {
    var v = u.create("Member"),
    m = u.create("Guider"),
    g = o.BookStep2Store.getInstance(),
    y = o.BookStep2ChoosedResourceStore.getInstance(),
    b = o.BookStep3OrderData.getInstance(),
    w = o.OrderParamStore.getInstance(),
    E = o.TempPassengerStore.getInstance(),
    S = o.OrderDefaultStore.getInstance(),
    x = o.OrderDataSaveStore.getInstance(),
    T = S.getAttr("oldDelivery"),
    N = S.getAttr("oldMobile"),
    C = S.getAttr("contactName"),
    k = h.CustomerAddrStore.getInstance(),
    L = h.AddressStore.getInstance(),
    A = r.UserStore.getInstance(),
    O = r.HeadStore.getInstance(),
    M = r.UnionStore.getInstance(),
    D = s.CreateOrderModel.getInstance(),
    P = s.SaveOrderModel.getInstance(),
    H = s.OrderModel.getInstance(),
    B = o.OrderNoRvStrore.getInstance(),
    j = o.OrderCreateStore.getInstance(),
    F = o.SourceSignStore.getInstance(),
    I = s.AnonymousUserModel.getInstance(),
    q = function() {
        var e = A.getUser();
        return !! e && !!e.Auth && e.IsNonUser
    },
    R = {},
    U = t.utility.isInApp(),
    z,
    W = n.extend({
        pageid: U ? "220083": "220006",
        uid: "",
        tmpOrderId: 0,
        ivcIndex: null,
        invoiceInfo: null,
        delivery: {},
        render: function(e) {
            var t = this.$el;
            this.$el.html(e),
            this.cls = {
                passenger: t.find(".add_passenger"),
                mobile: t.find(".mobile"),
                invoice: t.find(".invoice"),
                "invoice-detail": t.find(".invoice-detail"),
                delivery: t.find("#deliveryWrap"),
                contact: t.find("#contact"),
                ivc_title: t.find("#ivc_title"),
                pop_cost: t.find(".pop_cost"),
                email: t.find("#email"),
                name: t.find("#name")
            }
        },
        onCreate: function() {
            z = new t.ui.Mask({
                classNames: "order-layer"
            }),
            this.injectHeaderView(),
            A.isLogin() && (B.getAttr("isNonLogin") && (j.remove(), B.removeAttr("isNonLogin")), R = A.getUser() || {},
            this.uid = R.UserID)
        },
        events: {
            "click .btn_invoice": "swtichInvoice",
            "click .invoice-detail": "showInvoiceDetail",
            "click .add_passenger": "passengerSelect",
            "click .price_detail": "showPriceDetail",
            "click .coupon": "couponPicker",
            "click .select_delivery": "swtichDelivery",
            "click .selfAddrPick": "selfAddrPick",
            "click .extras": "toExtras",
            "click .select_address": "toAddress",
            "click .btn_next": "next",
            "click .passenger_li": "toEdit",
            "click #booking_note": "toBookingNote",
            "click .js_login": "login"
        },
        setHead: function(e) {
            this.headerview.set({
                title: "订单填写",
                back: !0,
                view: this,
                events: {
                    returnHandler: function() {
                        z.hide(),
                        this.back(e)
                    }
                }
            }),
            this.headerview.show()
        },
        onLoad: function(e) {
            var t = this,
            n = q(),
            r = this.isLogin = A.isLogin(),
            s = this.getQuery("from"),
            o = s ? s === "booking.step1" ? "booking.step1": "": "booking.step2";
            this.referrer = e || "",
            this.setHead(o);
            if (!r && !n) {
                this.login();
                return
            } ! n,
            this.showLoading(),
            this.updatePage(function(e) {
                n ? this.handleUserInfo(this.tmpOrdID) : this.handleUserInfo(),
                this.realData = this.formatData(e),
                this.render(_.template(i)($.extend(this.realData, c, {
                    isLogin: r
                }))),
                this.total(this.realData),
                this.turning()
            })
        },
        handleUserInfo: function(e) {
            var t = e || this.uid,
            n = B.getAttr("TOUR-USER-INFO-UID");
            n && t && n !== t && E.remove(),
            B.setAttr("TOUR-USER-INFO-UID", t)
        },
        isNoSameUser: function() {
            var e = this.uid,
            t = B.getAttr("TOUR-USER-INFO-UID");
            return t && e && t !== e
        },
        isNotSameOrder: function(e) {
            var t = e || 0,
            n = B.getAttr("toid");
            return ! t || !n || t != n ? (B.setAttr("toid", t), !0) : !1
        },
        updatePage: function(e) {
            var t = this.getQuery("orderid");
            this.urlpath = t ? "?orderid=" + t: "",
            t ? this.getOrder(t, e) : this.creatOrder(e)
        },
        getOrder: function(e, t) {
            var n = this;
            n.isNotSameOrder(e) && (x.remove(), w.remove(), E.remove()),
            w.setAttr("tempOrderId", this.tmpOrdID = e),
            H.setParam("tmpOrdID", e),
            H.excute(function(e) {
                this.hideLoading(),
                e.errno === 0 ? (this.initPsgs(e.data.oPInfs), e.data.oDy && e.data.oDy.dType == 2 && (x.removeAttr("oDy"), k.remove()), t.call(this, e.data)) : this.showToast(e.errmsg || "出现错误", 3,
                function() {
                    n.back()
                })
            },
            function() {
                this.hideLoading(),
                this.showToast("出现错误")
            },
            !1, this)
        },
        initPsgs: function(e) {
            var t = [];
            e && e.length && $.each(e,
            function(e, n) {
                t.push(String(n.pId))
            }),
            w.setAttr("selectedID", t)
        },
        creatOrder: function(e) {
            var t = this,
            n = w.getAttr("createParam"),
            r = this.isNoSameUser(),
            i = !1,
            s = b.get();
            s ? s.chosedResource = y.get() : this.showToast("数据不全", 3,
            function() {
                t.back("booking.step1");
                return
            }),
            r && E.remove();
            if (!_.isEqual(n, s) && s || r) w.remove(),
            x.remove(),
            w.setAttr("createParam", s),
            i = !0;
            var o = M.get(),
            u = {};
            o && o.AllianceID && o.SID && (u = {
                AllianceID: o.AllianceID ? "" + o.AllianceID: "",
                OUID: o.OUID ? "" + o.OUID: "",
                SID: o.SID ? "" + o.SID: "",
                SourceID: o.SourceID ? "" + o.SourceID: ""
            });
            var a = F.get() || {},
            f = a.share,
            l = a.SourceID ? "_SourceID=" + a.SourceID: "";
            F && f && (u.shareGCStr = f),
            D.setParam($.extend({
                sveFrm: U ? "App_5.6": "H5_5.6" + l,
                unqCd: "",
                orderSegms: s.orderSegms,
                pId: s.pId,
                departCId: s.departCId,
                departDate: s.departDate,
                adultNum: s.adultNum,
                childNum: s.childNum,
                saleCId: s.saleCId,
                guid: s.guid,
                chosedResource: JSON.stringify(s.chosedResource)
            },
            u)),
            D.excute(function(t) {
                this.hideLoading(),
                t.errno === 0 ? (w.setAttr("tempOrderId", this.tmpOrdID = t.data.oData.tmpOrdID), e.call(this, t.data)) : (this.showToast(t.errmsg || "出现错误"), D.clearResult(), this.back("booking.step2"))
            },
            function() {
                this.hideLoading(),
                this.showToast("出现错误!")
            },
            i, this)
        },
        initDataStore: function(e) {
            var t = w.getAttr("intentOrderParam") || {},
            n = this.retCpageAddr(k.get(this.uid)),
            r = e.sltPmt && e.sltPmt.pmtID;
            return this.saveStoreData({
                pInfs: x.getAttr("pInfs") || e.oPInfs,
                mobile: x.getAttr("mobile") || t.mobile || e.oData.mobile || e.oData.moblie || e.oData.tel || R.Mobile,
                ctcNm: x.getAttr("ctcNm") || t.ctcNm || e.oData.ctcNm || R.UserName,
                email: x.getAttr("email") || t.email || e.oData.email || R.Email,
                oIvc: x.getAttr("oIvc") || (e.oIvc && e.oIvc.title ? {
                    cont: e.oIvc.cont,
                    title: e.oIvc.title
                }: ""),
                oDy: n && !$.isEmptyObject(n) && n || x.getAttr("oDy") || e.oDy,
                coupon: x.getAttr("coupon") || r,
                remk: x.getAttr("remk") || e.remk
            })
        },
        retCpageAddr: function(e, t) {
            if (e && e.addr) return {
                dType: t || w.getAttr("deliveryType") || 0,
                addr: {
                    addr: e.prvnName + e.ctyName + e.dstrName + e.addr,
                    cId: e.destCtyId,
                    cNm: e.ctyName,
                    ctnId: e.dstrId,
                    ctnNm: e.dstrName,
                    id: e.inforId,
                    post: e.zip,
                    rcpt: e.recipient,
                    tel: e.mphone || e.phone
                }
            }
        },
        onShow: function() {
            this.referrer !== "booking.step2" && this.restoreScrollPos()
        },
        onHide: function() {},
        setParam: function(e) {
            w.setAttr("oorder", {
                adu: e.oData.adu,
                chl: e.oData.chl,
                pmtLst: e.pmtLst,
                sltPmt: e.sltPmt,
                departDate: e.oData.dDt,
                pType: e.oData.pType
            })
        },
        formatIvc: function(e) {
            var t = this;
            this.invoiceInfo = $.map(e.ivcCt,
            function(n, r) {
                return n.value == e.cont && (t.ivcIndex = r),
                {
                    val: n.value,
                    key: n.key
                }
            })
        },
        formatDly: function(e) {
            var t = {
                flag: e.dlst.length,
                postage: {},
                ways: [],
                mod: [],
                goods: {},
                index: null,
                slfAddr: e.slfAddr,
                city: e.cNm
            };
            return t.mod = $.map(e.dlst[0].dMdl,
            function(e, n) {
                return t.postage[e.dType] = e.dAmt,
                t.ways.push(e.dType),
                {
                    val: c.deliverType[e.dType],
                    key: e.dType
                }
            }),
            $.each(e.dlst,
            function(e, n) {
                t.goods[n.hsIvc] = n.dGoods
            }),
            this.delivery = t
        },
        formatData: function(e) {
            var t = this,
            n = w.getAttr("extras"),
            r,
            i = null,
            s = this.retCpageAddr(k.get(this.uid));
            n && (e.remk = n),
            this.setParam(e),
            e.dTpl ? (i = this.formatDly(e.dTpl), e.oDy && _.indexOf(i.ways, e.oDy.dType) == -1 && (e.oDy = null)) : e.oDy = null;
            var o = this.initDataStore(e),
            u = !!o.oIvc;
            return this.formatIvc(e.oIvc),
            r = i && this.getAddrIndex(i.ways, i.ways[0], o.oDy),
            $.extend(e, {
                delivery: this.delivery,
                dlyIndex: r,
                dfDelivery: T,
                storeData: o,
                isDelivery: i && i.flag,
                isDlyShow: i && (i.flag > 1 || i.flag > 0 && u),
                ivcIndex: this.ivcIndex
            })
        },
        isDelivery: function(e, t) {
            return t > 1 || e && t > 0
        },
        getAddrIndex: function(e, t, n) {
            var r = t || T && T.dType || 0;
            return _.indexOf(e, n && n.dType || r)
        },
        isInvoice: function() {
            return this.$el.find(".btn_invoice").length && this.$el.find(".btn_invoice").hasClass("btn_on")
        },
        swtichInvoice: function(e) {
            var t = $(e.target),
            n = t.hasClass("btn_on"),
            r = this.$el.find(".invoice"),
            i = this.$el.find(".delivery_item"),
            s = this.delivery.flag;
            t.toggleClass("btn_off", n).toggleClass("btn_on", !n);
            if (!n) {
                r.show(),
                w.setAttr("isInvoice", 1);
                if (s) {
                    var o = this.$el.find(".selected_delivery").data("type");
                    i.show()
                }
            } else r.hide(),
            w.removeAttr("isInvoice"),
            s < 2 && i.hide();
            this.total()
        },
        showInvoice: function() {},
        showInvoiceDetail: function() {
            var e = this.$el.find(".invoice-detail-input"),
            t = new f({
                title: "发票明细",
                data: this.invoiceInfo,
                index: parseInt(e.attr("index"), 10) || 0,
                itemClick: function(t) {
                    e.html(t.val),
                    e.attr("index", t.index)
                }
            });
            t.show()
        },
        swtichDelivery: function() {
            var e = this,
            t = this.$el.find(".selected_delivery"),
            n = this.$el.find("#deliveryWrap"),
            r = this.realData,
            i = r.dfDelivery,
            s = r.storeData.oDy,
            o = 0,
            u = function(e) {
                var t = '<%if(switchType === 2){%>                          <div class="take_site">                            <h3>自取地址</h3>                            <%_.each(delivery.slfAddr,function(v,k){%>                            <dl class="selfAddrPick" data-index="<%=k%>">                                <dt><i class="<%= k == curType2 ? \'cur\':\'\'%>"></i></dt>                                <dd><%=v%></dd>                            </dl>                            <%})%>                        </div>                        <%}else{%>                           <div class="distribution_col arrows_icon select_address" data-type="<%=switchType%>">                            <h3>配送地址</h3>                            <%var dly = stdly || dfdly, dtype = (dly && dly.dType) || 0,dpostage = delivery.postage[switchType];if (dly && dly.addr && switchType==dtype) {%>                                <div class="delivery_detail">                                    <p><%=dly.addr.rcpt%></p>                                    <p><%=dly.addr.addr%></p>                                    <p><%=dly.addr.tel%></p>                                </div>                             <%}%>                             </div>                            <%if(switchType == 1 && dpostage){%>                            <div class="book_notice">选择市内配送，需加收配送费<%=dpostage%>元起，具体金额以预订员确认为准。</div>                            <%}%>                            <%if(switchType == 3 && dpostage){%>                            <div class="book_notice">选择EMS邮寄需加收<%=dpostage%>元配送费。</div>                            <%}%>                        <%}%>';
                e == 2 ? (r.oDy && r.oDy.addr.addr && (o = _.indexOf(r.delivery.slfAddr, r.oDy.addr.addr)) && (o = o == -1 ? 0 : o), x.setAttr("oDy", {
                    dType: 2,
                    addr: {
                        addr: r.delivery.slfAddr[o]
                    }
                })) : s && s.dType == e ? x.setAttr("oDy", s) : x.setAttr("oDy", null),
                n.html(_.template(t)($.extend(r, {
                    switchType: e,
                    dfdly: i,
                    stdly: s,
                    curType2: o
                })))
            },
            a = new f({
                title: "选择配送方式",
                data: this.realData.delivery.mod,
                index: parseInt(t.attr("index"), 10) || 0,
                itemClick: function(i) {
                    t.html(i.val),
                    t.attr("index", i.index),
                    n.attr("index", i.index),
                    t.data("type", i.key),
                    u(i.key),
                    e.postage = r.delivery.postage[i.key],
                    e.total()
                }
            });
            a.show()
        },
        saveAddr: function(e) {
            var t = {
                dType: 0,
                addr: {}
            },
            n = this.$el.find(".selected_delivery").data("type"),
            r = this.$el.find("#deliveryWrap").attr("index");
            return n == 2 ? (t.dType = 2, t.addr.addr = e.delivery.slfAddr[r], t.addr.cNm = e.delivery.city) : t = e.storeData.oDy || e.dfDelivery || {},
            t
        },
        selfAddrPick: function(e) {
            var t = $(e.currentTarget),
            n = this.$el.find("#deliveryWrap"),
            r = t.data("index");
            t.find("i").addClass("cur"),
            t.siblings().find("i").removeClass("cur"),
            n.attr("index", t.data("index")),
            x.setAttr("oDy", {
                dType: 2,
                addr: {
                    addr: this.realData.delivery.slfAddr[r]
                }
            })
        },
        couponPicker: function(e) {
            var t = $(e.currentTarget).data("id");
            this.saveData(),
            t ? w.setAttr("couponSelectId", t) : w.removeAttr("couponSelectId"),
            this.forward("order.coupon" + this.urlpath)
        },
        passengerSelect: function() {
            this.saveData(),
            this.forward("passengerSelect" + this.urlpath)
        },
        showPriceDetail: function() {
            var e = this.cls;
            z && z.show(),
            z && (z.show(), $("#" + z.id).one("click",
            function() {
                z.hide(),
                e.pop_cost.hide()
            })),
            e.pop_cost.show()
        },
        toExtras: function() {
            this.saveData(),
            this.forward("order.extras" + this.urlpath)
        },
        toAddress: function(e) {
            var t = this,
            n = $(e.currentTarget).data("type");
            this.saveData(),
            w.setAttr("deliveryType", n),
            L.setCurrent(this.uid, {
                success: "/webapp/tour/index.html#order" + this.urlpath,
                defeated: "/webapp/tour/index.html#order" + this.urlpath
            },
            "CustomerAddrStore:setAddr", "CustomerAddrStore:get"),
            m.apply({
                callback: function() {
                    t.jump("/webapp/cpage/index.html#addresslist")
                },
                hybridCallback: function() {
                    m.cross({
                        path: "cpage",
                        param: "index.html#addresslist"
                    })
                }
            })
        },
        saveStoreData: function(e) {
            return ! e || $.isEmptyObject(e) ? (this.showToast("出现错误，请重试"), !1) : ($.each(e,
            function(e, t) {
                x.setAttr(e, t)
            }), x.get())
        },
        saveData: function() {
            var e = {},
            t = this.realData,
            n = this.saveStoreData,
            r = $.trim,
            i = this.$el,
            s = i.find("#contact"),
            o = i.find("#name"),
            u = i.find("#email");
            s.length && (e.mobile = r(s.val()), e.mobile && S.setAttr("oldMobile", e.mobile)),
            o.length && (e.ctcNm = r(o.val()), e.ctcNm && S.setAttr("contactName", e.ctcNm)),
            u.length && (e.email = r(u.val()));
            var a = i.find(".btn_invoice").length && i.find(".btn_invoice").hasClass("btn_on"),
            f = i.find("#ivc_title").val(),
            l = i.find("#ivc_detail").html();
            return a ? e.oIvc = {
                cont: l,
                title: r(f)
            }: e.oIvc = null,
            this.isDelivery(a, t.delivery.flag),
            n(e),
            x.get()
        },
        toEdit: function(e) {
            var t = $(e.currentTarget),
            n = String(t.data("id")),
            r = n.indexOf("temp") != -1,
            i = t.data("age") == 1 ? "A": "C",
            s = t.data("idtype");
            this.saveData(),
            w.setAttr("edit", {
                id: r ? "": n,
                tempid: r ? n: "",
                idtype: s,
                idage: i
            });
            var o = this.urlpath ? "&orderid=" + this.tmpOrdID: "";
            this.forward("#passengerEdit?from=order" + o)
        },
        total: function(e) {
            var e = this.realData,
            t = this.$el,
            n = e.sltPmt ? e.sltPmt.rdAmt: 0,
            r = {
                total: t.find(".total"),
                postage: t.find(".postage"),
                discount: t.find(".discount"),
                dlyel: t.find(".selected_delivery"),
                deliery_li: t.find(".delivery_li"),
                coupon_li: t.find(".coupon_li")
            },
            i = e.prcDtl.preferPrice ? Math.abs(Math.floor(e.prcDtl.preferPrice)) : 0,
            s = !this.$el.find("#deliveryWrap").length || this.$el.find("#deliveryWrap").css("display") === "none",
            o = s ? 0 : +e.delivery.postage[r.dlyel.data("type")],
            u = o - Math.floor(e.prcDtl.frght),
            a = Math.floor(e.prcDtl.dsctAmt) - Math.floor(n) + i,
            f = a + Math.floor(e.storeData.coupon ? e.storeData.coupon.rdAmt: 0),
            l = Math.floor(e.prcDtl.amt) + u - f + i;
            r.total.html(l),
            r.postage.html(o),
            r.deliery_li.toggle(o),
            r.discount.html(f),
            r.coupon_li.toggle(f)
        },
        next: function() {
            var e = this,
            t = this.saveData(),
            n = []; (!t.pInfs || !t.pInfs.length) && n.push({
                el: "passenger",
                tip: "请选择旅客"
            }),
            t.ctcNm || n.push({
                el: "name",
                input: "name",
                tip: "请填写联系人姓名"
            }),
            t.mobile || n.push({
                el: "mobile",
                input: "contact",
                tip: "请填写联系手机"
            }),
            /^0?1[3458]\d{9}$/.test($.trim(t.mobile)) || n.push({
                el: "mobile",
                input: "contact",
                tip: "请填写正确的手机号码"
            }),
            t.email || n.push({
                el: "email",
                input: "email",
                tip: "请填写电子邮件"
            }),
            t.email && !/^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(t.email) && n.push({
                el: "email",
                input: "email",
                tip: "请填写正确的电子邮件"
            }),
            this.isInvoice() && (t.oIvc.title || n.push({
                el: "invoice",
                input: "ivc_title",
                tip: "请添加发票抬头"
            }), t.oIvc.cont || n.push({
                el: "invoice-detail",
                tip: "请填写发票明细"
            })),
            this.$el.find("#deliveryWrap").length && this.$el.find("#deliveryWrap").css("display") !== "none" ? (!t.oDy || !t.oDy.dType || !t.oDy.addr.addr) && n.push({
                el: "delivery",
                tip: "请填写配送地址"
            }) : t.oDy = null;
            if (n.length) {
                var r = n[0],
                i = this.cls[r.el].offset().top - 48;
                window.scrollTo(0, i),
                r.input && this.cls[r.input].focus(),
                this.showToast(r.tip);
                return
            }
            this.verfyLogin(t,
            function(t) {
                e.saveOrder(t)
            })
        },
        saveOrder: function(e) {
            P.param = e,
            P.setParam("tmpOrdID", this.tmpOrdID || this.getQuery("orderid")),
            P.setParam("canBkOpt", 1),
            P.excute(function(e) {
                this.hideLoading(),
                e.errno === 0 ? this.pay(e) : this.showToast(e.errmsg)
            },
            function() {
                this.hideLoading(),
                this.showToast("订单保存失败，请重试")
            },
            !1, this)
        },
        pay: function(e) {
            var t = this.util.getEnvCode(d),
            n = this.realData.oData.proID,
            r,
            i,
            s,
            o,
            u,
            a = this.isInvoice(),
            f = ["secure.fat19.qa.nt.ctripcorp.com", "10.8.5.10", "secure.ctrip.com"];
            r = location.protocol + "//" + location.host,
            U ? (s = "tour/index.html#order.sback", o = "tour/index.html#order.detail?orderid=" + e.data.tmpOrdID + "&ordertype=2") : (s = r + "/webapp/tour/index.html#order.sback", o = r + "/webapp/tour/index.html#order.detail?orderid=" + e.data.tmpOrdID + "&ordertype=2"),
            t === 0 ? i = "https://secure.fat19.qa.nt.ctripcorp.com": t === 1 ? i = "https://10.8.5.10": t === 2 ? i = "https://secure.uat.sh.ctriptravel.com": i = "https://secure.ctrip.com";
            var l = {
                oid: e.data.tmpOrdID,
                bustype: 1002,
                needInvoice: a,
                sback: s,
                thirdback: o,
                eback: r + "/webapp/tour/index.html#order.eback?orderid=" + e.data.tmpOrdID + "&pid=" + n,
                auth: e.head.auth,
                title: e.data.payPar.title,
                amount: e.data.payPar.amount
            };
            l = encodeURIComponent(p.Base64.encode(JSON.stringify(l))),
            w.setAttr("tempOrderId", this.tmpOrdID),
            w.setAttr("orderInfo", {
                amount: e.data.payPar.amount,
                title: e.data.payPar.title
            }),
            u = ["oid=", e.data.tmpOrdID, "&bustype=1002&token=", l].join(""),
            U ? m.cross({
                path: "payment",
                param: "index.html#index?" + u
            }) : this.jump(i + "/webapp/payment/index.html#?" + u)
        },
        verfyLogin: function(e, t) {
            var n = this;
            this.showLoading();
            if (this.isLogin || q) {
                t.call(this, e);
                return
            }
            I.excute(function(r) {
                e.head = O.get(),
                e.head.auth = r.auth,
                B.setAttr("isNonLogin", 1),
                t.call(n, e)
            },
            function(e) {
                this.hideLoading(),
                this.showToast(e.errmsg || "网络不给力，请稍后重试", 3,
                function() {
                    n.back()
                })
            })
        },
        toBookingNote: function() {
            this.saveData(),
            this.forward("order.contract")
        },
        login: function() {
            var e = location.pathname;
            v.memberLogin({
                param: "t=1&from=" + e + "#order",
                callback: function() {
                    A.isLogin() && window.location.reload()
                }
            })
        }
    });
    return W
}),
define("text!templates/passengerselect.html", [],
function() {
    return '<ul class="base_list add_list">\r\n    <li class="passenger_add arrows_icon btn_active">新增旅客</li>\r\n    <%_.each(passengers,function(v,k){var pid,tempid;var dfinfo=v.dfIdcard;%>\r\n        <%if(v.tempid) {%>\r\n            <%tempid=v.tempid; %>\r\n        <%}else{ %>\r\n           <% pid=v.InfoID;%>\r\n        <%} %>\r\n        <%var cur; cur=_.indexOf(selected,String(pid)) !=-1 || _.indexOf(selected,tempid) !=-1 ? \'cur\':\'\'%>\r\n        <li class="passenger_select">\r\n            <div class="passenger_datail passenger_pick <%=cur%>" data-id="<%=pid%>" data-tempid="<%=tempid%>" data-age="<%=v.PassengerType%>" data-phone="<%=v.MobilePhone%>" data-idtype="<%=dfinfo && dfinfo.id%>">\r\n                <i></i>\r\n                <p><%if(v.CNName){%><%=v.CNName%>&nbsp;&nbsp;&nbsp;&nbsp;<%}%><%if(v.ENLastName){%><%=v.ENLastName%><%}%><%if(v.ENFirstName){%><%=\'/\'+v.ENFirstName%>&nbsp;&nbsp;<%}%><%if(v.ENMiddleName){%><%=v.ENMiddleName%><%}%></p>\r\n                <!--\r\n        <%if(v.iCdInf && v.iCdInf.length){var flag;%>\r\n        <%_.each(v.iCdInf,function(val,key){%>\r\n            <%if(val.icdNo && !flag){%>\r\n            <p class="certificate">\r\n                <span><%=idCardType[val.iCdtp]%></span>&nbsp;\r\n                <em><%=val.icdNo%></em>\r\n            </p>\r\n            <%flag=1;}%>\r\n        <%})%>\r\n        <%}%>\r\n        -->\r\n                <%if(dfinfo){%>\r\n                <p class="certificate">\r\n                    <span><%=idCardType[dfinfo.id]%></span>&nbsp;\r\n                    <em><%=dfinfo.no%></em>\r\n                </p>\r\n                <%}%>\r\n            </div>\r\n            <i class="edit_icon edit_passenger" data-id="<%=pid%>" data-tempid="<%=tempid%>" data-idtype="<%=dfinfo && dfinfo.id%>"></i>\r\n        </li>\r\n    <%})%>\r\n</ul>\r\n'
}),
define("res/scripts/utils/ParseID", [],
function() {
    var e = function(e, t, n) {
        var r, i;
        n == null && (n = 0),
        i = e.length,
        n < 0 && (n += i),
        r = Math.max(n, 0);
        while (r < i) {
            if (e[r] === t) return r; ++r
        }
        return - 1
    },
    t = "11@22@35@44@53@12@23@36@45@54@13@31@37@46@61@14@32@41@50@62@15@33@42@51@63@21@34@43@52@64@65@71@81@82@91";
    return {
        checkId: function(n) {
            var r, i, s, o, u, a, f, l = n.split(""),
            c = !0;
            e(t.split("@"), n.substr(0, 2)) === -1 && (c = !1);
            switch (n.length) {
            case 15:
                (parseInt(n.substr(6, 2)) + 1900) % 4 == 0 || (parseInt(n.substr(6, 2)) + 1900) % 100 == 0 && (parseInt(n.substr(6, 2)) + 1900) % 400 == 0 ? r = /^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/: r = /^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,
                r.test(n) || (c = !1);
                break;
            case 18:
                parseInt(n.substr(6, 4)) % 4 == 0 || parseInt(n.substr(6, 4)) % 100 == 0 && parseInt(n.substr(6, 4)) % 4 == 0 ? r = /^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/: r = /^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,
                r.test(n) ? (u = (parseInt(l[0]) + parseInt(l[10])) * 7 + (parseInt(l[1]) + parseInt(l[11])) * 9 + (parseInt(l[2]) + parseInt(l[12])) * 10 + (parseInt(l[3]) + parseInt(l[13])) * 5 + (parseInt(l[4]) + parseInt(l[14])) * 8 + (parseInt(l[5]) + parseInt(l[15])) * 4 + (parseInt(l[6]) + parseInt(l[16])) * 2 + parseInt(l[7]) * 1 + parseInt(l[8]) * 6 + parseInt(l[9]) * 3, i = u % 11, a = "F", s = "10x98765432", o = "10X98765432", a = s.substr(i, 1), f = o.substr(i, 1), a != l[17] && f != l[17] && (c = !1)) : c = !1;
                break;
            default:
                c = !1
            }
            return c
        },
        parseId: function(e) {
            var t, n;
            return e.length == 15 ? (t = parseInt(e.charAt(14), 10) % 2 ? "M": "F", n = e.replace(/^\d{6}(\d{2})(\d{2})(\d{2}).+$/, "19$1-$2-$3")) : (t = parseInt(e.charAt(16), 10) % 2 ? "M": "F", n = e.replace(/^\d{6}(\d{4})(\d{2})(\d{2}).+$/, "$1-$2-$3")),
            {
                sex: t,
                age: n
            }
        }
    }
}),
define("views/passengerselect", ["libs", "c", "VaBaseView", "CommonStore", "TourModel", "TourStore", "text!templates/passengerselect.html", "res/data/orderdata", "res/scripts/utils/ParseID", "cUIAlert"],
function(libs, c, pageview, commonstore, model, store, html, commondata, ParseID, uiAlert) {
    var aduPicked = 0,
    childPicked = 0,
    totalPicked = 0,
    isPhoned = 0,
    psgIdSelected = [],
    psgInfoSelected = [],
    orderParam = store.OrderParamStore.getInstance(),
    TempPassengerStore = store.TempPassengerStore.getInstance(),
    userStore = commonstore.UserStore.getInstance(),
    _model = model.PassengersModel.getInstance(),
    _modelist = model.PassengersListModel.getInstance(),
    orderData = store.OrderDataSaveStore.getInstance(),
    dataNow,
    View = pageview.extend({
        passengersObj: {},
        render: function(e) {
            this.$el.html(e),
            this.initSelect()
        },
        events: {
            "click .passenger_add": "onPassengerAdd",
            "click .edit_passenger": "onPassengerEdit",
            "click .passenger_pick": "onPassengerSelect"
        },
        updatePage: function(e, t) {
            var n = this;
            this.vaShowLoading(),
            _model.setParam("tmpOrdID", e),
            _model.excute(function(e) {
                e.errno === 0 ? (t.call(this, e.data), n.getpassengers(), n.vaHideLoading()) : (this.showToast("出现错误"), n.vaHideLoading())
            },
            function() {},
            !1, this)
        },
        getpassengers: function() {
            var e = this;
            dataNow = this.getServerDate() || new Date;
            var t = t = this.tempPsgObj = TempPassengerStore.getAttr("tempPassengers") || {},
            n = {},
            r = userStore ? userStore.getUser() : null;
            if (r && r.UserID) {
                var i = TempPassengerStore.getAttr("passengers");
                i ? (this.passengersObj = n = i, this.render(_.template(html)($.extend(commondata, {
                    passengers: this.setSelectedTop(psgIdSelected, $.extend(t, n)),
                    selected: psgIdSelected,
                    that: this
                }))), this.turning()) : (_modelist.setParam({
                    UID: r.UserID,
                    BizType: "Vacation",
                    PageSize: 0
                }), _modelist.excute(function(r) {
                    r.MemberUserBaseInfos && (r.MemberUserBaseInfos.length && $.map(r.MemberUserBaseInfos,
                    function(t, n) {
                        e.passengersObj[t.InfoID] = t
                    }), TempPassengerStore.setAttr("passengers", n = e.passengersObj), this.render(_.template(html)($.extend(commondata, {
                        passengers: this.setSelectedTop(psgIdSelected, $.extend(t, n)),
                        selected: psgIdSelected,
                        that: this
                    }))), this.turning())
                },
                function() {
                    this.showToast("网络错误，请重试"),
                    this.turning()
                },
                !0, this))
            } else this.render(_.template(html)($.extend(commondata, {
                passengers: this.setSelectedTop(psgIdSelected, $.extend(t)),
                selected: psgIdSelected,
                that: this
            }))),
            this.turning()
        },
        retdate: function(e) {
            return this.dateformat(e)
        },
        onCreate: function() {
            this.injectHeaderView()
        },
        setHead: function() {
            var e = this;
            this.headerview.set({
                title: "选择出行人",
                back: !0,
                home: !1,
                view: this,
                tel: null,
                btn: {
                    title: "完成",
                    id: "confirmBtn",
                    classname: "rightblue"
                },
                commit: {
                    id: "confirmBtn",
                    callback: $.proxy(e.onCommit, e)
                },
                events: {
                    returnHandler: function() {
                        this.back()
                    }
                }
            }),
            this.headerview.show()
        },
        onLoad: function() {
            var e = this,
            t, n = orderParam.getAttr("tempOrderId");
            this.oorder = orderParam.getAttr("oorder"),
            n || this.showToast("数据不全，请重新选择",
            function() {
                e.back()
            }),
            aduPicked = childPicked = totalPicked = isPhoned = 0,
            psgInfoSelected = [],
            psgIdSelected = (t = orderParam.getAttr("selectedID")) ? t: [],
            this.updatePage(n,
            function(e) {
                this.vaHideLoading(),
                this.setHead(),
                this.realData = this.formatData(e),
                this.fis = this.filterIDCards()
            })
        },
        onShow: function() {},
        onHide: function() {},
        setSelectedTop: function(e, t) {
            var n = [],
            r = [],
            i = _.clone(t),
            s = this;
            if (!e || !i) {
                this.showToast("数据出错");
                return
            }
            return $.isEmptyObject(i) ? n: ($.each(e,
            function(e, t) {
                i[t].dfIdcard = s.getIDCardInfo(i[t]),
                i[t].PassengerType = s.resetAge(i[t]),
                r.push(i[t]),
                delete i[t]
            }), $.each(i,
            function(e, t) {
                t.dfIdcard = s.getIDCardInfo(t),
                t.PassengerType = s.resetAge(t),
                n.push(t)
            }), r.reverse().concat(n.reverse()))
        },
        resetAge: function(e) {
            var t = e.dfIdcard,
            n = this.customTpl,
            r = typeof e.PassengerType == "undefined" ? "A": e.PassengerType;
            if (!t) return r;
            if (t.id == 1 && n.icdNo && t.no) return this.getAge(ParseID.parseId(t.no).age) > 12 ? "A": "C";
            if (t.id == 100) return "U";
            if (n.btd && e.Birthday) {
                var i = this.dateformat(e.Birthday);
                return this.getAge(i) > 12 ? "A": "C"
            }
            return r
        },
        getAge: function(e) {
            var t = this.getServerDate() || new Date,
            n = new Date(Date.parse(e.replace(/-/g, "/"))),
            r = t.getMonth(),
            i = t.getDate(),
            s = t.getFullYear() - e.substring(0, 4) - 1;
            return (n.getMonth() < r || n.getMonth() == r && n.getDate() <= i) && s++,
            s
        },
        getIDCardInfo: function(e) {
            var t = this,
            n = this.oorder.pType,
            r = null,
            i, s = this.fis[0];
            if (!this.fis.length || !s) return r;
            if (n == 1) s = 1;
            else if (n == 2 || n == 3) s = 2;
            return s = e.defaultIdType || s,
            e && !e.MemberUserIDCardInfos ? {
                id: s,
                no: "",
                ivt: ""
            }: ($.each(e.MemberUserIDCardInfos,
            function(e, n) { (i = _.indexOf(t.fis, n.IDCardType)) !== -1 && (!r || i < r.id) && (r = {
                    id: n.IDCardType,
                    no: n.IDCardNo,
                    ivt: n.IDCardTimelimit
                });
                if (_.indexOf(t.fis, n.IDCardType) !== -1 && n.IDCardType === s) return r = {
                    id: n.IDCardType,
                    no: n.IDCardNo,
                    ivt: n.IDCardTimelimit
                },
                !1
            }), r)
        },
        filterIDCards: function() {
            var e = commondata.idSort,
            t = this.objIdCards || {},
            n = [];
            return $.isEmptyObject(t) ? !1 : ($.each(e,
            function(e, r) {
                t[r] && n.push(r)
            }), n)
        },
        initSelect: function() {
            var e = this.$el.find(".passenger_datail"),
            t;
            e.each(function() {
                var e = $(this);
                e.hasClass("cur") && (e.data("age") == "C" ? childPicked++:e.data("age") == "A" ? (aduPicked++, e.data("phone") && isPhoned++) : e.data("phone") && isPhoned++, totalPicked++)
            })
        },
        onPassengerAdd: function(e) {
            orderParam.setAttr("selectedID", psgIdSelected),
            this.forward("passengerEdit")
        },
        onPassengerEdit: function(e, t) {
            var n = t || $(e.target),
            r = n.data("id"),
            i = n.data("tempid"),
            s = n.data("idtype");
            orderParam.setAttr("selectedID", psgIdSelected),
            orderParam.setAttr("edit", {
                id: r,
                tempid: i,
                idtype: s
            }),
            this.forward("passengerEdit")
        },
        showTip: function(e) {
            var t = this;
            this.alert = new uiAlert({
                title: e.title || "提示信息",
                message: e.msg || "",
                buttons: [{
                    text: "取消",
                    click: function() {
                        this.hide()
                    }
                },
                {
                    text: "继续",
                    click: function() {
                        e.cb.call(t),
                        this.hide()
                    }
                }]
            }),
            this.alert.show()
        },
        onPassengerSelect: function(e) {
            var t = $(e.currentTarget),
            n = String(t.data("id")) || t.data("tempid"),
            r = t.data("age"),
            i = t.data("phone");
            if (!this.isInfoComplete(n)) {
                this.showTip({
                    title: "",
                    msg: "请填写旅客信息",
                    cb: $.proxy(function() {
                        this.onPassengerEdit(e, t)
                    },
                    this)
                });
                return
            }
            var s = this.getIDCardInfo(this.passengersObj[n] || this.tempPsgObj[n]);
            t.toggleClass("cur"),
            t.hasClass("cur") ? (psgIdSelected.push(n), r == "C" ? childPicked++:r == "A" ? (aduPicked++, i && isPhoned++) : i && isPhoned++, totalPicked++) : (psgIdSelected = _.without(psgIdSelected, n), r == "C" ? childPicked--:r == "A" ? (aduPicked--, i && isPhoned--) : i && isPhoned--, totalPicked--)
        },
        formatData: function(e) {
            this.tpl = e.psgTpl,
            this.formatCustomTpl(this.tpl)
        },
        formatCustomTpl: function(e) {
            var t = this,
            n = {
                iCdInf: []
            },
            r = "name|cNm|eNm|ntl|iCdtp|icdNo|icdVdt|gd|btd|hmPc|mbp",
            i = {
                UserName: "name",
                ChineseName: "cNm",
                EnglishName: "eNm",
                Nationality: "ntl",
                IDType: "iCdtp",
                IDNumber: "icdNo",
                CardValidUntil: "icdVdt",
                Sex: "gd",
                Birthday: "btd",
                BirthPlace: "hmPc",
                ContactPhone: "mbp"
            };
            return this.objIdCards = {},
            $.map(r.split("|"),
            function(e, t) {
                n[e] = ""
            }),
            $.map(e.cItms,
            function(e, r) {
                e.iMdl === 1 ? n[i[e.iType]] = e: (e.iType == 1 && e.note && (n.restrictions = e.note), orderParam.setAttr("objIdCards", t.objIdCards[e.iType] = e), n.iCdInf.push(e))
            }),
            n.iCdInf.length && (this.idCards = n.iCdInf),
            orderParam.setAttr("customTpl", n),
            this.customTpl = n
        },
        isInfoComplete: function(e) {
            var t = this,
            n = this.passengersObj[e] || this.tempPsgObj[e],
            r = this.customTpl,
            i = !1,
            s = [];
            this.Tips = [];
            if (!n) {
                this.showToast("数据有误");
                return
            }
            var o = function(e) {
                var t = !0;
                return $.each(r,
                function(r, i) {
                    if (r === "undefined" || !i || r === "mbp" || r === "iCdtp" || r === "icdNo" || r === "icdVdt" || r === "iCdInf") return ! 0;
                    if (r !== "gd" || !!e && _.indexOf(e, r) !== -1) if (r === "name") ! n.CNName && (!n.ENFirstName || !n.ENLastName) && (t = !1);
                    else if (r !== "cNm" || !!e && _.indexOf(e, r) !== -1) {
                        if (r !== "eNm" || !!e && _.indexOf(e, r) !== -1) if (r !== "btd" || !!e && _.indexOf(e, r) !== -1) if (r !== "hmPc" || !!e && _.indexOf(e, r) !== -1) if (r !== "ntl" || !!e && _.indexOf(e, r) !== -1) {
                            if (!n[r] && (!e || _.indexOf(e, r) === -1)) return t = !1
                        } else n.NationalityCode || (t = !1);
                        else n.BirthPlace || (t = !1);
                        else n.Birthday || (t = !1);
                        else if (!n.ENFirstName || !n.ENLastName) t = !1
                    } else n.CNName || (t = !1);
                    else n["Gender"] == -1 && (t = !1)
                }),
                t
            };
            if (r.iCdtp) {
                if (!n.MemberUserIDCardInfos || !n.MemberUserIDCardInfos.length) return ! 1;
                $.each(n.MemberUserIDCardInfos, $.proxy(function(e, t) {
                    if (this.objIdCards[t.IDCardType]) {
                        t.IDCardType == 1 ? s = ["eNm", "btd", "gd", "hmPc", "ntl"] : t.IDCardType == 100 ? s = ["btd", "hmPc", "ntl"] : s = [];
                        if (o(s) && this.isIDcomplete(t)) return i = !0,
                        !1
                    }
                },
                this))
            } else i = o();
            return i
        },
        IDcardSelected: function(e, t) {
            var n = this,
            r = {},
            i = orderParam.getAttr("idCardSelected"),
            t = t || this.objIdCards;
            return e.MemberUserIDCardInfos && $.each(e.MemberUserIDCardInfos,
            function(e, i) {
                var s = i.IDCardType == 1 || !n.customTpl.icdVdt || i.IDCardTimelimit,
                o = i.IDCardType == 100 && t[i.IDCardType];
                if (i.IDCardType && i.IDCardNo && t[i.IDCardType] && s || o) return r.iCdtp = i.IDCardType,
                r.icdNo = i.IDCardNo,
                r.icdVdt = n.dateformat(i.IDCardTimelimit),
                !1
            }),
            r
        },
        isIDcomplete: function(e) {
            var t = e.IDCardType;
            if (t == 1) return e.IDCardNo;
            if (t == 100) return ! 0;
            if (e.IDCardNo) {
                var n = this.dateformat(e.IDCardTimelimit);
                return ! this.customTpl.icdVdt || n && this.testVdt(n)
            }
            return ! 1
        },
        filterData: function(e, t) {
            var n = {},
            r = this;
            $.inArray(e, psgIdSelected) != -1 && ($.each(r.customTpl,
            function(i, s) {
                if (i === "iCdInf" || i === "icdVdt" || i === "icdNo") return ! 0;
                i == "iCdtp" ? n.iCdInf = r.IDcardSelected(t) ? [r.IDcardSelected(t)] : null: i == "eNm" ? t.ENFirstName && t.ENLastName && (n[i] = {
                    f: t.ENFirstName,
                    m: t.ENMiddleName,
                    l: t.ENLastName
                }) : i == "name" ? t.CNName ? n[i] = n.cNm = t.CNName: t.ENFirstName && t.ENLastName && (n[i] = n.eNm = {
                    f: t.ENFirstName,
                    m: t.ENMiddleName,
                    l: t.ENLastName
                }) : i == "cNm" ? n[i] = t.CNName: i == "ntl" ? n[i] = t.NationalityCode: i == "gd" ? n[i] = t.Gender == "M" ? 0 : 1 : i == "btd" ? n[i] = r.dateformat(t.Birthday) : i == "hmPc" ? n[i] = t.BirthPlace: i == "mbp" ? n[i] = t.MobilePhone: n[i] = t[i],
                String(e).indexOf("temp") != -1 ? (n.tempID = e, n.pId = 0) : n.pId = e
            }), typeof n.aegRg == "undefined" && (n.aegRg = t.PassengerType == "A" ? 1 : t.PassengerType == "C" ? 0 : 2), psgInfoSelected.push(n))
        },
        isAgeTest: function() {
            return this.customTpl.btd || this.idCards && this.idCards.length && this.objIdCards[1]
        },
        isPeopleNumFat: function() {
            var e = psgIdSelected.length,
            t = this.oorder.adu,
            n = this.oorder.chl;
            return totalPicked !== t + n ? !1 : t < aduPicked || n < childPicked ? !1 : !0
        },
        saveData: function() {
            var e = this,
            t = psgIdSelected.length,
            n = this.oorder.adu,
            r = this.oorder.chl,
            i = this.getQuery("orderid") ? "?orderid=" + this.getQuery("orderid") : "",
            s;
            t ? totalPicked !== n + r ? s = "您所选择的旅客人数与查询时不一致": this.isAgeTest() && !this.isPeopleNumFat() ? s = "您所选择的成人、儿童人数与查询时不一致": isPhoned || (s = "请至少填写一位成人旅客的联系电话") : s = "请选择旅客";
            if (s) return this.showToast(s),
            s;
            $.each(psgIdSelected,
            function(t, n) {
                e.filterData(n, e.passengersObj[n] || e.tempPsgObj[n])
            }),
            orderData.setAttr("pInfs", this.resetAge2(psgInfoSelected)),
            this.back("order" + i)
        },
        resetAge2: function(e) {
            var t = e || [],
            n = this.oorder.adu || 0,
            r = this.oorder.chl || 0,
            i = 0,
            s = 0,
            o = 0;
            if ((i = n - aduPicked) > 0) {
                s = 0;
                while (s < i && o < t.length) t[o].aegRg == 2 && (t[o].aegRg = 1, s++),
                o++
            }
            if ((i = r - childPicked) > 0) {
                s = 0;
                while (s < i && o < t.length) t[o].aegRg == 2 && (t[o].aegRg = 0, s++),
                o++
            }
            return t
        },
        testVdt: function(e) {
            var t = this.oorder.departDate || this.getServerDate() || new Date,
            n = this.util.helper.strdate,
            r = (n(e) - n(t)) / 864e5;
            return e ? r <= 0 ? (this.showToast("您的证件已经过了有效期，会影响您正常登机。建议重新办理后再预订。"), !1) : (r < 180 ? this.Tips.push("从旅行日期计算，您的证件有效期已不足六个月，可能无法顺利出入境，建议您核实确认。") : r < 360 && this.Tips.push("从旅行日期计算，您的证件有效期已不足一年，建议您核实确认。"), !0) : (this.showToast("请填写信息"), !1)
        },
        dateformat: function(str) {
            var ret, tempdate;
            if (str && str.indexOf("/") > -1) {
                var mystr = str.replace(new RegExp("/", "g"), ""),
                re = /Date\((\S+)\)/ig;
                tempdate = new Date(eval(re.exec(mystr)[1])),
                ret = tempdate.getFullYear() + "-" + (tempdate.getMonth() + 1) + "-" + tempdate.getDate()
            } else ret = str;
            return ret
        },
        onCommit: function() {
            var e = this.saveData();
            e || orderParam.setAttr("selectedID", psgIdSelected)
        }
    });
    return View
}),
define("text!templates/passengerEdit.html", [],
function() {
    return '<%var option = defaultIdCard && defaultIdCard.IDCardType == 1,later = defaultIdCard && defaultIdCard.IDCardType == 100;%>\r\n<ul class="base_list passenger_list">\r\n    <%if(tpl.name){%>\r\n    <li class="passenger_name">\r\n        <h3><label for="forname"><%=tpl.name.nm%></label></h3>\r\n        <input id="forname" type="text" class="input_text name" value="<%=data.CNName ? data.CNName : (data.ENLastName && data.ENFirstName ? data.ENLastName+\'/\'+data.ENFirstName+\' \'+data.ENMiddleName : \'\')%>" placeholder="请填写姓名" <%if(canEditName){%>readonly<%}%>>\r\n        <%if(!canEditName){%>\r\n        <i class="passenger_tips" data-type="name"></i>\r\n        <%}%>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.cNm){%>\r\n    <li class="passenger_name">\r\n        <h3><label for="forcname"><%=tpl.cNm.nm%></label></h3>\r\n        <input id="forcname" type="text" class="input_text cname" value="<%=data.CNName%>" placeholder="请填写中文姓名">\r\n        <i class="passenger_tips" data-type="cname"></i>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.eNm){%>\r\n    <%if(option){%>\r\n    <li class="passenger_name psg_ename option" style="display:none" data-hide="1">\r\n    <%}else{%>\r\n        <li class="passenger_name psg_ename option">\r\n    <%}%>\r\n        <h3><label for="forename"><%=tpl.eNm.nm%></label></h3>\r\n            <input type="text" id="forename" class="input_text ename" placeholder="xing/ming或last/frist" value="<%=data.ENLastName ? data.ENLastName+\'/\'+data.ENFirstName+\' \'+data.ENMiddleName: \'\'%>" />\r\n            <i class="passenger_tips" data-type="ename"></i>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.iCdtp){%>\r\n    <li class="arrows_icon idtype_select btn_active">\r\n        <h3><%=tpl.iCdtp.nm%></h3>\r\n        <%if(defaultIdCard.IDCardType){%>\r\n        <span class="blue idtype" index="<%=idindexs.length ? _.indexOf(idindexs,defaultIdCard.IDCardType) : \'\'%>" type="<%=defaultIdCard.IDCardType%>"><%=idCardType[defaultIdCard.IDCardType]%></span>\r\n        <%}else{%>\r\n        <span class="blue idtype" ></span>\r\n        <%}%>\r\n    </li>\r\n    <%if(later){%>\r\n    <li class="later idNoLi" style="display:none" data-hide="1">\r\n    <%}else{%>\r\n    <li class="later idNoLi">\r\n    <%}%>\r\n        <h3><label for="foridno">证件号码</label></h3>\r\n        <input type="text" id="foridno" class="input_text idno" value="<%=defaultIdCard.IDCardNo%>">\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.ntl){%>\r\n    <%if(option || later){%>\r\n    <li class="arrows_icon nation_select option later btn_active" data-hide="1" style="display:none;">\r\n        <%}else{%>\r\n    <li class="arrows_icon nation_select option later btn_active">\r\n        <%}%>\r\n        <h3><%=tpl.ntl.nm%></h3>\r\n        <span class="natl" data-val="<%=data.NationalityCode%>"><%=data.NationalityName%></span>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.gd){%>\r\n    <%if(option){%>\r\n    <li class="arrows_icon gender_select option btn_active" style="display:none" data-hide="1">\r\n    <%}else{%>\r\n    <li class="arrows_icon gender_select option btn_active">\r\n        <%}%>\r\n        <h3><%=tpl.gd.nm%></h3>\r\n        <span class="gender" index="<%=data.Gender%>"><%=data.Gender ==　\'M\'  ? \'男\' : (data.Gender ==　\'F\' ? \'女\':\'\') %></span>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.btd){%>\r\n\r\n    <%if(option || later){%>\r\n    <li class="arrows_icon birth_select option later btn_active" style="display:none" data-hide="1">\r\n    <%}else{%>\r\n    <li class="arrows_icon birth_select option later btn_active">\r\n        <%}%>\r\n        <h3><%=tpl.btd.nm%></h3>\r\n        <%var mydate; %>\r\n        <%if(data.Birthday) {%>\r\n            <%var databtd; %>\r\n            <%if(data.Birthday.indexOf(\'/\')<0){ %>\r\n                <%mydate=data.Birthday; %>\r\n            <%}else{ %>\r\n                <%var mybtd=data.Birthday.replace(new RegExp("\\/", "g"), \'\'); %>\r\n                <%var re = /Date\\((\\S+)\\)/ig; %>\r\n                <%databtd=new Date(eval(re.exec(mybtd)[1])); %>\r\n                <%mydate=databtd.getFullYear()+\'-\'+(databtd.getMonth()+1)+\'-\'+databtd.getDate() %>\r\n            <%} %>\r\n        <%} %>\r\n        <span class="birth" index="<%=birthIndex%>"><%=mydate %></span>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.hmPc){%>\r\n    <%if(option || later){%>\r\n    <li class="hmPc option later" style="display:none" data-hide="1">\r\n    <%}else{%>\r\n    <li class="hmPc option later">\r\n    <%}%>\r\n        <h3><label for="forhm"><%=tpl.hmPc.nm%></label></h3>\r\n        <input id="forhm" type="text" class="input_text bplace" value="<%=data.BirthPlace%>">\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.icdVdt){%>\r\n    <%if(option || later){%>\r\n    <li class="arrows_icon iCdInf_select option later btn_active" style="display:none" data-hide="1">\r\n        <%}else{%>\r\n    <li class="arrows_icon iCdInf_select option later btn_active">\r\n        <%}%>\r\n        <h3><%=tpl.icdVdt.nm%></h3>\r\n        <%var mylimitdate; %>\r\n        <%if(defaultIdCard.IDCardTimelimit) {%>\r\n            <%var limit; %>\r\n            <%if(defaultIdCard.IDCardTimelimit.indexOf(\'/\')<0) {%>\r\n                <%mylimitdate=defaultIdCard.IDCardTimelimit %>\r\n            <%}else{ %>\r\n                <%var mylimit=defaultIdCard.IDCardTimelimit.replace(new RegExp("\\/", "g"), \'\'); %>\r\n                <%var re = /Date\\((\\S+)\\)/ig; %>\r\n                <%limit=new Date(eval(re.exec(mylimit)[1]));%>\r\n                <%mylimitdate=limit.getFullYear()+\'-\'+(limit.getMonth()+1)+\'-\'+limit.getDate(); %>\r\n            <%} %>\r\n        <%} %>\r\n        <span class="iCdInf" index="0-0-0"><%=mylimitdate %></span>\r\n    </li>\r\n    <%}%>\r\n    <%if(tpl.mbp){%>\r\n    <li>\r\n        <h3><label for="formobile">手机号码</label></h3>\r\n        <input type="tel" id="formobile" class="input_text mphone" value="<%=data.MobilePhone%>">\r\n    </li>\r\n    <%}%>\r\n</ul>\r\n'
}),
define("views/passengeredit", ["libs", "c", "VaBaseView", "CommonStore", "TourModel", "TourStore", "text!templates/passengerEdit.html", "cUIScrollRadioList", "cUIScrollRadio", "res/data/orderdata", "res/data/nationaldata", "cUIAlert", "res/scripts/utils/ParseID"],
function(libs, c, pageview, CommonStore, tourModel, tourStore, html, radioList, radio, commonData, nationaldata, uiAlert, ParseID) {
    var userStore = CommonStore.UserStore.getInstance(),
    orderParam = tourStore.OrderParamStore.getInstance(),
    passengersStore = tourStore.PassengersStore.getInstance(),
    TempPassengerStore = tourStore.TempPassengerStore.getInstance(),
    orderdata = tourStore.OrderDataSaveStore.getInstance(),
    orderModification = tourStore.OrderModificationStore.getInstance(),
    modificationData,
    passengerEditStore = tourStore.PassengerEditStore.getInstance(),
    passengerEditModel = tourModel.PassengerEditModel.getInstance(),
    theDate,
    ndata = {},
    oorder = orderParam.getAttr("oorder") || {},
    departDate = oorder.departDate,
    ptype = oorder.pType,
    Tips = [],
    getRangeDate = function(e, t, n) {
        var r = function(e, t, r) {
            return _.map(_.range(e, t),
            function(e, t) {
                return n ? e: {
                    key: e,
                    val: e + r
                }
            })
        },
        i = r(e, t, "年"),
        s = r(1, 13, "月"),
        o = r(1, 32, "日");
        return [i, s, o]
    },
    getRandom = function() {
        return "tempid" + (new Date).getTime()
    },
    cReg = {
        hasCnChar: function(e) {
            return /[\u0100-\uffff]/.test(e)
        },
        isCnChar: function(e) {
            return /^[\u4e00-\u9fa5]+$/.test(e)
        },
        isEnChar: function(e) {
            return /^[A-Za-z][A-Za-z\s]*[A-Za-z]$/.test(e)
        },
        isEnName: function(e) {
            return /^[^\/]+\/[^\/]+$/.test(e)
        },
        hasEnChar: function(e) {
            return /[A-Za-z]/.test(e)
        }
    },
    userInfo = userStore ? userStore.getUser() : null,
    View = pageview.extend({
        render: function(e) {
            var t = this.$el;
            t.html(e),
            this.cls = {
                idtype_select: t.find(".idtype_select"),
                idtype: t.find(".idtype"),
                gender_select: t.find(".gender_select"),
                gender: t.find(".gender"),
                birth_select: t.find(".birth_select"),
                birth: t.find(".birth"),
                iCdInf_select: t.find(".iCdInf_select"),
                iCdInf: t.find(".iCdInf"),
                name: t.find(".name"),
                cname: t.find(".cname"),
                ename: t.find(".ename"),
                psg_ename: t.find(".psg_ename"),
                idno: t.find(".idno"),
                natl: t.find(".natl"),
                bplace: t.find(".bplace"),
                hmPc: t.find(".hmPc"),
                mphone: t.find(".mphone"),
                option: t.find(".option"),
                later: t.find(".later"),
                idNoLi: t.find(".idNoLi"),
                nation_select: t.find(".nation_select")
            }
        },
        events: {
            "click .idtype_select": "selectIdType",
            "click .gender_select": "selectGender",
            "click .birth_select": "selectBirth",
            "click .iCdInf_select": "selectPeriod",
            "click .nation_select": "selectNation",
            "click .passenger_tips": "nameTip"
        },
        updatePage: function(e) {
            var t, n = this,
            r = "50-0-0",
            i = [],
            s;
            this.psgIcdInf = null,
            this.title = e.defaultIdType ? "编辑旅客": "新增旅客",
            this.setHead(this.title),
            this.custtpl = this.getCustomTpl() || {},
            this.custtpl.iCdInf && (this.idCardsArr = $.map(this.custtpl.iCdInf,
            function(e, t) {
                return i.push( + e.iType),
                n.updateKey(e, {
                    nm: "val",
                    iType: "key"
                })
            }), e.MemberUserIDCardInfos && (this.psgIcdInf = this.getPsgIdObj(e.MemberUserIDCardInfos)), s = this.getIdCard(e, i, ptype));
            if (e.Birthday) {
                var o = this.dateformat(e.Birthday).split("-"),
                u = getRangeDate(1930, theDate.getFullYear(), !0),
                a = _.indexOf(u[0], +o[0]);
                r = [a == -1 ? 50 : a, _.indexOf(u[1], +o[1]), _.indexOf(u[2], +o[2])].join("-")
            } (t = this.pageParam.national) ? (e.NationalityCode = t.val, e.NationalityName = t.name, orderParam.removeAttr("national")) : e.NationalityCode && $.trim(e.NationalityCode) && (e.NationalityName = ndata[e.NationalityCode][1]),
            this.render(_.template(html)($.extend(commonData, {
                tpl: this.custtpl,
                data: e,
                birthIndex: r,
                idindexs: i,
                defaultIdCard: s || {},
                canEditName: n.orderID ? !0 : !1
            }))),
            this.turning()
        },
        onCreate: function() {
            var e;
            this.injectHeaderView(),
            $.map(nationaldata.all.split("@"),
            function(t, n) {
                e = t.split("|"),
                ndata[e[2]] = e
            })
        },
        onLoad: function() {
            var e = this;
            e.orderID = e.request.fullhash.split("orderid=")[1],
            this.modification = orderModification.getAttr("Passengers") || {},
            this.DataControlPE = {
                BaseInfo: {
                    InfoID: "",
                    PassengerType: "",
                    CNName: "",
                    ENFirstName: "",
                    ENMiddleName: "",
                    ENLastName: "",
                    UpdatedDate: "",
                    Birthday: "",
                    Gender: "",
                    NationalityName: "",
                    NationalityCode: "",
                    CityName: "",
                    DetailAddress: "",
                    PostCode: "",
                    MobilePhone: "",
                    ContactTel: "",
                    ContactFax: "",
                    ContractEmail: "",
                    MobilePhoneHK: "",
                    MobilePhoneForeign: "",
                    CorpCustID: null,
                    ConfirmType: "CSM",
                    ContractUpdateDate: "",
                    Passport_signDate: "",
                    IsFlt: "",
                    PhoneCountryfix: "",
                    CurCountry: null,
                    MobileCountryfix: "",
                    IsENName: "",
                    BirthPlace: "",
                    ShortMobilePhone: "",
                    BookingUser: "",
                    MemberUserInfoTime: [],
                    MemberUserInfoUsage: [],
                    MemberUserFFPInfos: [],
                    MemberUserIDCardInfos: []
                }
            },
            this.pageParam = orderParam.get(),
            this.getPsgInfo(this.updatePage)
        },
        getPsgInfo: function(e) {
            var t = this;
            theDate = this.getServerDate() || new Date;
            var n = {};
            this.pageParam = this.pageParam ? this.pageParam: {};
            var r = this.modification;
            if (!$.isEmptyObject(r)) this.pageParam.psdEdit ? n = i.psdEdit: (this.ctpl = r.psgTpl, n.defaultIdType = 0, _.isNumber(r.passengers.aegRg) && (n.PassengerType = r.passengers.aegRg == 1 ? "A": "C"), r.passengers.btd && (n.Birthday = r.passengers.btd), r.passengers.cNm && (n.CNName = r.passengers.cNm), r.passengers.eNm && !$.isEmptyObject(r.passengers.eNm) && (n.ENFirstName = r.passengers.eNm.f, n.ENLastName = r.passengers.eNm.l, n.ENMiddleName = r.passengers.eNm.m), _.isNumber(r.passengers.gd) && (n.Gender = r.passengers.gd == 0 ? "M": "F"), r.passengers.hmPc && (n.BirthPlace = r.passengers.hmPc), r.passengers.iCdInf && r.passengers.iCdInf.length > 0 && (n.MemberUserIDCardInfos = [], $.each(r.passengers.iCdInf,
            function(e, t) {
                var r = {};
                r.IDCardNo = t.icdNo ? t.icdNo: "",
                r.IDCardType = t.iCdtp ? t.iCdtp: "",
                r.IDCardTimelimit = t.icdVdt ? t.icdVdt: "",
                n.MemberUserIDCardInfos.push(r)
            }), n.defaultIdType = n.MemberUserIDCardInfos[0].IDCardType), r.passengers.mbp && (n.MobilePhone = r.passengers.mbp), r.passengers.ntl && (n.NationalityCode = r.passengers.ntl));
            else {
                var i = this.pageParam,
                s = i.edit,
                o = this.passengerId = s && s.id || 0,
                u = this.tempPassengerId = s && s.tempid || 0,
                a = s && s.idtype || 0,
                f = TempPassengerStore.getAttr("passengers"),
                l = TempPassengerStore.getAttr("tempPassengers");
                i.psdEdit ? n = i.psdEdit: o ? n = f ? f[o] : {}: u && (n = l ? l[u] : {})
            }
            var c = theDate.getFullYear() + "-" + (theDate.getMonth() + 1) + "-" + theDate.getDate();
            userInfo && userInfo.UserID ? (this.DataControlPE.UID = userInfo.UserID, $.isEmptyObject(n) ? this.DataControlPE.BaseInfo.UpdatedDate = c: (n.UpdatedDate = c, this.DataControlPE.BaseInfo = n)) : $.isEmptyObject(n) ? this.DataControlPE.BaseInfo.UpdatedDate = c: (n.UpdatedDate = c, this.DataControlPE.BaseInfo = n),
            a && $.isEmptyObject(n) ? this.getPassengers(function(r) {
                n = r[o] || {},
                n.defaultIdType = a,
                t.DataControlPE.BaseInfo = n,
                e.call(t, t.passengerInfo = n)
            }) : (n.defaultIdType = n.defaultIdType ? n.defaultIdType: a, e.call(t, t.passengerInfo = n))
        },
        getPassengers: function(e) {
            var t = this,
            n = tourModel.PassengersModel.getInstance();
            n.setParam("tmpOrdID", orderParam.getAttr("tempOrderId") || 0),
            this.showLoading(),
            n.excute(function(e) {
                this.hideLoading(),
                e.errno === 0 ? t.ctpl = e.data.psgTpl: this.showToast("出现错误")
            },
            function() {
                this.hideLoading()
            },
            !1, this);
            var r = tourModel.PassengersListModel.getInstance();
            r.setParam({
                UID: userInfo.UserID,
                BizType: "Vacation",
                PageSize: 0
            }),
            r.excute(function(n) {
                this.hideLoading();
                if (n.MemberUserBaseInfos && n.MemberUserBaseInfos.length) {
                    var r = {};
                    $.map(n.MemberUserBaseInfos,
                    function(e, t) {
                        r[e.InfoID] = e
                    }),
                    TempPassengerStore.setAttr("passengers", t.customPsg = r),
                    e.call(t, r)
                } else this.showToast("出现错误")
            },
            function() {
                this.hideLoading()
            },
            !0, this)
        },
        setHead: function(e) {
            var t = this;
            this.headerview.set({
                title: e,
                back: !0,
                home: !1,
                view: this,
                tel: null,
                btn: {
                    title: "完成",
                    id: "confirmBtn",
                    classname: "rightblue"
                },
                events: {
                    returnHandler: function() {
                        this.back(),
                        orderParam.removeAttr("edit")
                    }
                },
                commit: {
                    id: "confirmBtn",
                    callback: $.proxy(t.onCommit, t)
                }
            }),
            this.headerview.show()
        },
        getCustomTpl: function() {
            return this.pageParam.customTpl || this.formatCustomTpl()
        },
        formatCustomTpl: function(e) {
            var e = e || this.ctpl,
            t = this,
            n = {
                iCdInf: []
            },
            r = "name|cNm|eNm|ntl|iCdtp|icdNo|icdVdt|gd|btd|hmPc|mbp",
            i = {
                UserName: "name",
                ChineseName: "cNm",
                EnglishName: "eNm",
                Nationality: "ntl",
                IDType: "iCdtp",
                IDNumber: "icdNo",
                CardValidUntil: "icdVdt",
                Sex: "gd",
                Birthday: "btd",
                BirthPlace: "hmPc",
                ContactPhone: "mbp"
            };
            return this.objIdCards = {},
            $.map(r.split("|"),
            function(e, t) {
                n[e] = ""
            }),
            $.map(e.cItms,
            function(e, r) {
                e.iMdl === 1 ? n[i[e.iType]] = e: (e.iType == 1 && e.note && (n.restrictions = e.note), orderParam.setAttr("objIdCards", t.objIdCards[e.iType] = e), n.iCdInf.push(e))
            }),
            n.iCdInf.length && (this.idCards = n.iCdInf),
            orderParam.setAttr("customTpl", n),
            this.customTpl = n
        },
        getPsgIdObj: function(e) {
            var t = {};
            return ! e || !e.length ? !1 : ($.each(e,
            function(e, n) {
                t[n.IDCardType] = n
            }), t)
        },
        getIdCard: function(e, t, n) {
            var r = {
                IDCardType: t[0],
                IDCardTimelimit: "",
                IDCardNo: ""
            },
            i = this.psgIcdInf;
            if (!t) return this.showToast("数据出错！"),
            !1;
            if (this.pageParam.psdEdit && e.MemberUserIDCardInfos && e.MemberUserIDCardInfos.length) return orderParam.removeAttr("psdEdit"),
            $.each(e.MemberUserIDCardInfos,
            function(e, n) {
                if (_.indexOf(t, n.IDCardType) !== -1) return r = n,
                !1
            }),
            r;
            if (e.tempDefaultIdType) return i[e.tempDefaultIdType];
            if (e.defaultIdType && i) return i[e.defaultIdType];
            if (n) {
                if (n == 1) return _.indexOf(t, 1) !== -1 ? i && i[1] ? i[1] : (r.type = 1, r) : r;
                if (n == 2 || n == 3) return _.indexOf(t, 2) !== -1 || _.indexOf(t, 3) !== -1 ? i && i[2] ? i[2] : (r.type = 2, r) : r
            }
            return r
        },
        selectIdType: function() {
            var e = this,
            t = this.cls.idtype,
            n = new radioList({
                title: "选择证件",
                data: this.idCardsArr,
                index: parseInt(t.attr("index"), 10),
                itemClick: function(n) {
                    t.html(n.val),
                    t.attr("type", n.key),
                    t.attr("index", n.index),
                    e.chooseIdType(n.key),
                    e.cls.idtype_select.length && e.cls.nation_select.length && e.setNation.call(e, ptype, n.key);
                    if (e.psgIcdInf && e.psgIcdInf[n.key]) {
                        e.cls.idno.val(e.psgIcdInf[n.key].IDCardNo);
                        if (e.psgIcdInf[n.key].IDCardTimelimit) {
                            var r = e.dateformat(e.psgIcdInf[n.key].IDCardTimelimit);
                            e.cls.iCdInf.html(r)
                        }
                    } else e.cls.idno.val(""),
                    e.cls.iCdInf.html("")
                }
            });
            n.show()
        },
        selectGender: function() {
            var e = this.cls.gender,
            t = e.attr("index"),
            n = new radioList({
                title: "选择性别",
                data: [{
                    key: "M",
                    val: "男"
                },
                {
                    key: "F",
                    val: "女"
                }],
                index: t == -1 ? null: t,
                itemClick: function(t) {
                    e.html(t.val),
                    e.attr("index", t.key)
                }
            });
            n.show()
        },
        selectBirth: function() {
            var e = this.cls.birth,
            t = new radio({
                title: "选择日期",
                data: getRangeDate(1930, theDate.getFullYear()),
                index: e.attr("index").split("-") || [0, 0, 0],
                okClick: function(t) {
                    e.html(t[0].key + "-" + t[1].key + "-" + t[2].key),
                    e.attr("index", [t[0].index, t[1].index, t[2].index].join("-"))
                }
            });
            t.show()
        },
        selectPeriod: function() {
            var e = theDate.getFullYear(),
            t = this.cls.iCdInf,
            n = new radio({
                title: "选择有效期",
                data: getRangeDate(e, e + 50),
                index: t.attr("index").split("-") || [0, 0, 0],
                okClick: function(e) {
                    t.html(e[0].key + "-" + e[1].key + "-" + e[2].key),
                    t.attr("index", [e[0].index, e[1].index, e[2].index].join("-"))
                }
            });
            n.show()
        },
        selectNation: function() {
            var e = this.cls.natl.data("val"),
            t = this.cls.natl.data("sp"),
            n = t ? "order.national?sp=1": "order.national";
            this.save(),
            e && orderParam.setAttr("currentNational", {
                val: e,
                name: this.cls.natl.html()
            }),
            this.forward(n)
        },
        save: function(e) {
            var t = this.getQuery("from"),
            n = this.custtpl,
            r = this.cls,
            i = $.trim,
            s = e ? {}: this.passengerInfo,
            o = {},
            u = 0,
            a = TempPassengerStore.getAttr("tempPassengers") || {},
            f = TempPassengerStore.getAttr("passengers") || {};
            Tips = [];
            if (n.name) {
                s.name = i(r.name.val());
                if (e && !this.checkName(s.name)) u++;
                else if (cReg.hasCnChar(s.name)) s.CNName = s.name,
                this.DataControlPE.BaseInfo.CNName = s.CNName,
                o.cNm = s.CNName,
                this.DataControlPE.BaseInfo.ENLastName = s.ENLastName = "",
                this.DataControlPE.BaseInfo.ENFirstName = s.ENFirstName = "",
                this.DataControlPE.BaseInfo.ENMiddleName = s.ENMiddleName = "",
                o.eNm = {};
                else {
                    var l = s.name.split("/"),
                    c = l[1] ? l[1].split(/\s+/) : "";
                    this.DataControlPE.BaseInfo.ENLastName = s.ENLastName = l[0],
                    this.DataControlPE.BaseInfo.ENFirstName = s.ENFirstName = c ? c[0] : "",
                    this.DataControlPE.BaseInfo.ENMiddleName = s.ENMiddleName = c[1] ? c[1] : "",
                    o.eNm = {
                        f: s.ENFirstName,
                        m: s.ENMiddleName,
                        l: s.ENLastName
                    },
                    this.DataControlPE.BaseInfo.CNName = s.CNName = "",
                    o.cNm = ""
                }
            }
            if (n.cNm) {
                s.CNName = i(r.cname.val()),
                this.DataControlPE.BaseInfo.CNName = s.CNName,
                o.cNm = s.CNName;
                var h = r.natl,
                p = !r.nation_select.data("hide") && h.length && h.data("val") && h.data("val").toLowerCase(),
                d = p === "cn" || p === "hk" || p === "mo" || p === "tw"; ! u && e && (!p || d) && !this.checkCnName(s.CNName) && u++
            }
            if (n.eNm && !r.psg_ename.data("hide")) {
                var v = i(r.ename.val()),
                m,
                g;
                v && (m = v.split("/"), g = m[1] ? m[1].split(/\s+/) : "", this.DataControlPE.BaseInfo.ENLastName = s.ENLastName = m[0], this.DataControlPE.BaseInfo.ENFirstName = s.ENFirstName = g ? g[0] : "", this.DataControlPE.BaseInfo.ENMiddleName = s.ENMiddleName = g[1] ? g[1] : "", o.eNm = {
                    f: s.ENFirstName,
                    m: s.ENMiddleName,
                    l: s.ENLastName
                }),
                !u && e && !this.checkEnName(v) && u++
            }
            if (n.iCdtp) {
                s.MemberUserIDCardInfos = [{
                    IDCardType: r.idtype.attr("type") && parseInt(r.idtype.attr("type"), 10),
                    IDCardNo: i(r.idno.val()),
                    IdCardSavePath: "",
                    IsCredit: !0,
                    IsFlightI: !0,
                    IsFlightN: !0,
                    IsIDCardPic: !1,
                    IsTrain: !0,
                    PassportType: ""
                }],
                o.iCdInf = [{
                    iCdtp: r.idtype.attr("type") && parseInt(r.idtype.attr("type"), 10),
                    icdNo: i(r.idno.val())
                }];
                if (!u && e && (!this.checkNull(r.idtype.html(), "证件类型") || !r.idNoLi.data("hide") && !this.checkIdCard(s.MemberUserIDCardInfos[0].IDCardNo, +s.MemberUserIDCardInfos[0].IDCardType))) u++;
                else if (s.MemberUserIDCardInfos[0].IDCardType == 1 && s.MemberUserIDCardInfos[0].IDCardNo) {
                    var y = ParseID.parseId(s.MemberUserIDCardInfos[0].IDCardNo);
                    s.Birthday = y.age,
                    s.Gender = y.sex,
                    s.NationalityCode = "CN",
                    s.NationalityName = "中国大陆",
                    this.DataControlPE.BaseInfo.Birthday = s.Birthday,
                    this.DataControlPE.BaseInfo.Gender = s.Gender,
                    this.DataControlPE.BaseInfo.NationalityCode = "CN",
                    this.DataControlPE.BaseInfo.NationalityName = "中国大陆"
                }
            }
            n.ntl && !r.nation_select.data("hide") && (s.NationalityCode = r.natl.data("val"), s.NationalityName = r.natl.text(), this.DataControlPE.BaseInfo.NationalityCode = s.NationalityCode, this.DataControlPE.BaseInfo.NationalityName = r.natl.text(), o.ntl = s.NationalityCode, !u && e && !this.checkNull(r.natl.html(), "国籍") && u++),
            n.gd && !r.gender_select.data("hide") && (s.Gender = r.gender.attr("index"), this.DataControlPE.BaseInfo.Gender = s.Gender, o.gd = s.Gender == "M" ? 0 : 1, !u && e && !this.checkNull(r.gender.html(), "性别") && u++),
            n.btd && !r.birth_select.data("hide") && (s.Birthday = r.birth.html(), this.DataControlPE.BaseInfo.Birthday = s.Birthday, o.btd = s.Birthday, !u && e && (this.checkNull(s.Birthday, "出生日期") ? n.icdVdt && !this.checkBirth(s.Birthday) && u++:u++)),
            n.hmPc && !r.hmPc.data("hide") && (s.BirthPlace = i(r.bplace.val()), this.DataControlPE.BaseInfo.BirthPlace = s.BirthPlace, o.hmPc = s.BirthPlace, !u && e && !this.checkNull(s.BirthPlace, "出生地", "bplace") && u++),
            n.icdVdt && !r.iCdInf_select.data("hide") && (s.MemberUserIDCardInfos[0].IDCardTimelimit = r.iCdInf.html(), o.iCdInf[0].icdVdt = r.iCdInf.html(), !u && e && (this.checkNull(s.MemberUserIDCardInfos[0].IDCardTimelimit, "证件有效期") ? this.testVdt(s.MemberUserIDCardInfos[0].IDCardTimelimit) || u++:u++)),
            n.mbp && (s.MobilePhone = i(r.mphone.val()), this.DataControlPE.BaseInfo.MobilePhone = s.MobilePhone, o.mbp = s.MobilePhone, !u && e && s.MobilePhone && !this.checkMobile(s.MobilePhone) && u++);
            var b = this.passengerId;
            b ? s.infoid = b: this.tempPassengerId && (s.tempID = this.tempPassengerId);
            var w = function(t, n, r, i) {
                if (!t) return r;
                var s = i ? "pId": "tempID";
                o[s] = t,
                r[s] = t,
                r.aegRg = n[t].PassengerType;
                var u = {};
                return n[t].MemberUserIDCardInfos && r.MemberUserIDCardInfos && ($.each(n[t].MemberUserIDCardInfos,
                function(e, t) {
                    r.MemberUserIDCardInfos[0].IDCardType != t.IDCardType && r.MemberUserIDCardInfos.push(t)
                }), e ? r.defaultIdType = r.MemberUserIDCardInfos[0].IDCardType: r.tempDefaultIdType = r.MemberUserIDCardInfos[0].IDCardType),
                n[t] = r,
                r
            },
            E,
            S,
            x;
            b ? (E = b, S = f, x = 1) : (E = this.tempPassengerId, S = a, x = 0),
            s = w.call(this, E, S, s, x),
            this.DataControlPE.BaseInfo.MemberUserIDCardInfos = s.MemberUserIDCardInfos,
            this.DataControlPE.BaseInfo.defaultIdType = s.defaultIdType,
            this.DataControlPE.BaseInfo.tempDefaultIdType = s.tempDefaultIdType,
            modificationData = o;
            if (e) {
                var T;
                if (s.Birthday) {
                    T = this.isAdu(s.Birthday) ? "A": "C";
                    if (t && this.pageParam.edit.idage != T) {
                        this.showToast("更改年龄有误，请重新填写");
                        return
                    }
                    s.aegRg = T
                } else t && t === "order" && this.pageParam.edit.idage ? s.aegRg = this.pageParam.edit.idage: s.aegRg = "U";
                o.aegRg = s.aegRg === "A" ? 1 : 0,
                modificationData = o,
                this.DataControlPE.BaseInfo.PassengerType = s.aegRg;
                var N; ! b && !this.tempPassengerId && !u && (s.tempID = this.tempPassengerId || getRandom(), this.DataControlPE.BaseInfo.InfoID = s.tempID, this.DataControlPE.BaseInfo.tempid = s.tempID, E = s.tempID, a[s.tempID] = s, orderParam.removeAttr("psdEdit"));
                if (!u) {
                    var C = function() {
                        var e = this;
                        t && (N = orderdata.getAttr("pInfs"), $.each(N,
                        function(t, n) {
                            if (b && n.pId == b || e.tempPassengerId && n.tempID == e.tempPassengerId) N[t] = o
                        }), orderdata.setAttr("pInfs", N));
                        var n = this.pageParam.selectedID || [],
                        r = String(s.pId || s.tempID);
                        _.indexOf(n, r) === -1 && (n.push(r), orderParam.setAttr("selectedID", n)),
                        $.isEmptyObject(e.modification) ? (S[E] = e.DataControlPE.BaseInfo, x === 1 ? TempPassengerStore.setAttr("passengers", S) : TempPassengerStore.setAttr("tempPassengers", S), userInfo && userInfo.UserID ? (passengerEditStore.setAttr("UID", userInfo.UserID), passengerEditStore.setAttr("BizType", "Vacation"), passengerEditStore.setAttr("BookingChannel", "Online"), passengerEditStore.setAttr("BaseInfo", e.DataControlPE.BaseInfo), e.vaShowLoading(), passengerEditModel.excute(function(t) {
                            if (x === 0) {
                                S[E].InfoID = t.InfoID,
                                TempPassengerStore.setAttr("tempPassengers", S);
                                var n = orderParam.getAttr("selectedID");
                                _.indexOf(n, E) === -1 && (n.push(E), orderParam.setAttr("selectedID", n))
                            }
                            e.DataControlPE.BaseInfo = {},
                            passengerEditStore.remove(),
                            orderParam.removeAttr("edit"),
                            e.vaHideLoading(),
                            e.back()
                        },
                        function() {
                            e.showToast("网络连接失败请重试"),
                            e.vaHideLoading()
                        },
                        !0, e)) : (orderParam.removeAttr("edit"), e.back())) : (modificationData.pId = e.modification.passengers.pId, e.updateModification(modificationData), orderParam.removeAttr("edit"), e.back())
                    };
                    Tips.length ? this.showTip({
                        title: "确认旅客信息",
                        msg: Tips.join("<br/>"),
                        cb: C
                    }) : C.call(this)
                }
            } else orderParam.setAttr("psdEdit", this.DataControlPE.BaseInfo)
        },
        updateModification: function(e) {
            var t = $.extend(this.modification.passengers, e);
            if (t) {
                var n = orderModification.getAttr(this.orderID);
                if (!_.isEmpty(n)) {
                    modpeople = n.orderInfo.passengers;
                    for (var r = 0,
                    i = modpeople.length; r < i; r++) if (modpeople[r].pId == t.pId) {
                        modpeople[r] = t;
                        break
                    }
                    orderModification.setAttr(this.orderID, n)
                }
            }
        },
        showTip: function(e) {
            var t = this;
            this.alert = new uiAlert({
                title: e.title || "提示信息",
                message: e.msg || "",
                buttons: [{
                    text: "修改",
                    click: function() {
                        this.hide()
                    }
                },
                {
                    text: "继续提交",
                    click: function() {
                        e.cb.call(t),
                        this.hide()
                    }
                }]
            }),
            this.alert.show()
        },
        onShow: function() {},
        onHide: function() {
            orderModification.removeAttr("Passengers")
        },
        isAdu: function(e) {
            return this.getAge(e) >= 12
        },
        getAge: function(e) {
            var t = theDate,
            n = new Date(Date.parse(e.replace(/-/g, "/"))),
            r = t.getMonth(),
            i = t.getDate(),
            s = t.getFullYear() - e.substring(0, 4) - 1;
            return (n.getMonth() < r || n.getMonth() == r && n.getDate() <= i) && s++,
            s
        },
        updateKey: function(e, t) {
            for (var n in t) n in e && (e[t[n]] = e[n], delete e[n]);
            return e
        },
        checkCnName: function(e) {
            var t;
            return "" === e ? t = "请填写中文名": cReg.isCnChar(e) && e.length === 1 ? t = "中文姓名不可少于2个汉字": cReg.isEnChar(e) || cReg.isEnName(e) ? t = "请保持姓名与证件上的姓名一致": /^[\u4e00-\u9fa5a-zA-Z-]+$/.test(e) ? (cReg.hasEnChar(e) && Tips.push("请确认填写的姓名与证件上姓名是否一致，生僻字可用拼音代替"), /\u5c0f\u59d0|\u5148\u751f|\u592a\u592a|\u592b\u4eba/.test(e) && Tips.push("您提交的姓名中含有称谓，请确认是否为您证件上的姓名")) : t = "中文姓名只能包含汉字（至少一个）、字母和连字符，生僻字可用拼音代替",
            t ? (this.cls.cname.focus(), this.showToast(t), !1) : !0
        },
        checkEnName: function(e) {
            var t;
            "" === e ? t = "请填写英文姓名，姓名格式为姓/名，姓与名之间用 / 分隔，如Green/Jim King": e.length < 2 ? t = "英文姓名不可少于2个英文单词。姓与名之间必须用/隔开": cReg.isEnName(e) ? /[^a-zA-Z. \/'-]/.test(e) && (t = "英文姓名中包含非法字符，请检查") : t = "请填写正确的英文姓名，姓名格式为姓 / 名，姓与名之间用 / 分隔，如Green/Jim King";
            var n = e.split("/");
            return /[^a-zA-Z]/.test(n[0]) ? t = "英文的姓中只能包含字母": /^[a-zA-Z]/.test(n[1]) || (t = "英文的名必须以字母开头"),
            t ? (this.cls.ename.focus(), this.showToast(t), !1) : !0
        },
        checkIdCard: function(e, t) {
            var n = "1@身份证|2@护照|3@学生证|4@军官证|6@驾驶证|7@回乡证|8@台胞证|10@港澳通行证|11@国际海员证|20@外国人永久居留证|21@旅行证|22@台湾通行证|23@士兵证|24@临时身份证|25@户口簿|26@警官证|99@其它",
            r = {},
            i;
            return $.map(n.split("|"),
            function(e, t) {
                var n = e.split("@");
                r[ + n[0]] = n[1]
            }),
            t ? "" === e ? i = "请填写" + r[t] + "号码": t === 1 ? ParseID.checkId(e) || (i = "请输入正确的" + r[t] + "号码") : t === 8 ? /[^A-Za-z0-9()（）]/.test(e) && (i = "请填写正确的台胞证号码：号码中只能包含数字、字母或括号") : t === 4 || t === 13 ? /[^\u4e00-\u9fa5a-zA-Z0-9]/.test(e) && (i = "请填写正确的军人证号码，号码中只能包含汉字、数字和字母") : /[^A-Za-z0-9]/.test(e) && (i = "请填写正确的" + r[t] + "号码，号码中只能包含数字或字母") : i = "请填写证件类型",
            i ? (this.cls.idno.focus(), this.showToast(i), !1) : !0
        },
        checkName: function(e, t, n) {
            var r, i = this.cls.idtype.attr("type") && parseInt(this.cls.idtype.attr("type"), 10);
            if ("" === e) r = "请填写姓名";
            else if (i && i == 1) cReg.isCnChar(e) || (r = "姓名只能为中文");
            else {
                if (cReg.hasCnChar(e)) return t == "national" && n == "中国大陆" && (r = "非中国国籍请填写英文姓名"),
                this.checkCnName(e);
                if (t != "ID" || n != 1) return this.checkEnName(e);
                r = "请保持姓名与证件上的姓名一致"
            }
            return r ? (this.cls.name.focus(), this.showToast(r), !1) : !0
        },
        checkNull: function(e, t, n) {
            return e ? !0 : (n && this.cls[n].focus(), this.showToast("请填写" + t), !1)
        },
        checkMobile: function(e) {
            return /^0?1[3458]\d{9}$/.test(e) ? !0 : (this.cls.mphone.focus(), this.showToast("请填写正确的手机号码"), !1)
        },
        testVdt: function(e) {
            var t = departDate || theDate,
            n = this.util.helper.strdate,
            r = (n(e) - n(t)) / 864e5;
            return e ? r <= 0 ? (this.showToast("您的证件已经过了有效期，会影响您正常登机。建议重新办理后再预订。"), !1) : (r < 180 ? Tips.push("从旅行日期计算，您的证件有效期已不足六个月，可能无法顺利出入境，建议您核实确认。") : r < 360 && Tips.push("从旅行日期计算，您的证件有效期已不足一年，建议您核实确认。"), !0) : (this.showToast("请填写信息"), !1)
        },
        checkBirth: function(e) {
            var t = departDate || theDate,
            n = this.util.helper.strdate;
            return e ? this.cls.iCdInf_select.length && n(e) >= n(t) ? (this.showToast("出生日期不得晚于出发日期"), !1) : !0 : (this.showToast("请填写信息"), !1)
        },
        chooseIdType: function(e) {
            var t = this.cls;
            e == 1 ? t.option.hide().data("hide", 1) : t.option.show().data("hide", 0),
            e == 100 ? t.later.hide().data("hide", 1) : $.each(t.later,
            function(e, t) { ! $(this).hasClass("option") && $(this).show().data("hide", 0)
            })
        },
        setNation: function(e, t) {
            var n = this.cls.natl,
            r = n.length && n.data("val"),
            i;
            if (!e) return;
            e == 1 && n.length && (t == 2 ? (n.data("sp", 1), !r || r !== "HK" && r !== "TW" && r !== "MO" ? i = 1 : n.html("").data("val", "")) : t == 7 ? n.html("中国香港").data("val", "HK") : t == 8 ? n.html("中国台湾").data("val", "TW") : i = 1, i && (n.html(this.passengerInfo.NationalityName || ""), n.data("val", this.passengerInfo.NationalityCode)))
        },
        nameTip: function(e) {
            var t = $(e.target).data("type");
            this.save(),
            this.forward("order.nameTip?type=" + t)
        },
        dateformat: function(str) {
            var ret, tempdate;
            if (str && str.indexOf("/") > -1) {
                var mystr = str.replace(new RegExp("/", "g"), ""),
                re = /Date\((\S+)\)/ig;
                tempdate = new Date(eval(re.exec(mystr)[1])),
                ret = tempdate.getFullYear() + "-" + (tempdate.getMonth() + 1) + "-" + tempdate.getDate()
            } else ret = str;
            return ret
        },
        onCommit: function() {
            this.save(!0)
        }
    });
    return View
}),
is_weixin() && (CtripTool.app_is_in_ctrip_app = function() {
    return ! 1
});
var is_inapp = typeof CtripTool != "undefined" && CtripTool.app_is_in_ctrip_app();
is_inapp ? (require.config({
    baseUrl: "./",
    paths: {
        TourModel: "front/models/tourModel",
        TourStore: "front/models/tourStore",
        VaBaseView: "res/scripts/views/BaseView",
        views: "front/views",
        templates: "front/templates",
        CPageStore: "../cpage/models/cpagestore"
    }
}), window.appInstance = !1, window.localStorage.setItem("ISINAPP", "1"), window.app = {},
window.app.callback = function(e) {
    var t = {
        web_view_finished_load: function() {
            if (window.localStorage) {
                var t = e.param;
                t && window.localStorage.setItem("APPINFO", JSON.stringify(t))
            }
            CtripUtil.app_init_member_H5_info()
        },
        init_member_H5_info: function(e) {
            require(["libs", "App", "CommonStore", "cLog"],
            function(t, n, r, i) {
                window.appInstance = !0,
                i.applog("init_member_H5_info", e);
                if (window.localStorage && e) {
                    if (e && e.clientID) {
                        var s = r.HeadStore.getInstance(),
                        o = s.get();
                        o.cid = e.clientID,
                        s.set(o)
                    }
                    if (e && e.userInfo) try {
                        var u = r.UserStore.getInstance(),
                        a = u.getUser();
                        e.userInfo.data.BMobile = e.userInfo.data.BindMobile,
                        u.setUser(e.userInfo.data);
                        var s = r.HeadStore.getInstance(),
                        o = s.get();
                        o.auth = e.userInfo.data.Auth,
                        s.set(o)
                    } catch(f) {
                        alert("set data error")
                    } else {
                        var u = r.UserStore.getInstance();
                        u.removeUser()
                    }
                    if (e && e.device) {
                        var l = {
                            device: e.device
                        };
                        window.localStorage.setItem("DEVICEINFO", JSON.stringify(l))
                    }
                    if (e && e.appId) {
                        var c = {
                            version: e.version,
                            appId: e.appId,
                            serverVersion: e.serverVersion,
                            platform: e.platform
                        };
                        window.localStorage.setItem("APPINFO", JSON.stringify(c))
                    }
                    if (e && e.timestamp) {
                        var h = new Date,
                        p = {
                            server: e.timestamp,
                            local: h.getTime()
                        };
                        window.localStorage.setItem("SERVERDATE", JSON.stringify(p))
                    }
                    if (e && e.sourceId) {
                        var s = r.HeadStore.getInstance(),
                        o = s.get();
                        o.sid = e.sourceId,
                        s.set(o),
                        window.localStorage.setItem("SOURCEID", e.sourceId)
                    }
                    e && e.isPreProduction && window.localStorage.setItem("isPreProduction", e.isPreProduction)
                }
                var d = '!function () { var a, b, c, d, e, f, g, i; if (true) { for (a = document.getElementsByTagName("script") || [], b = /_bfa.min.js/i, c = 0; c < a.length; c++) if (b.test(a[c].src)) return; if (!(window.$_bf || window.$LAB || window.CtripJsLoader)) { d = new Date, e = "?v=" + d.getFullYear() + d.getMonth() + "_" + d.getDate() + ".js", f = document.createElement("script"), f.type = "text/javascript", f.charset = "utf-8", f.async = !0; try { g = "https:" == document.location.protocol } catch (h) { g = "https:" == document.URL.match(/[^:]+/) + ":" } f.src = g ? "https://s.c-ctrip.com/_bfa.min.js" + e : "http://webresource.c-ctrip.com/code/ubt/_bfa.min.js" + e, i = document.getElementsByTagName("script")[0], i.parentNode.insertBefore(f, i) } } } ();',
                v = $("<script>" + d + "//<" + "/scrtip>");
                $("body").append(v),
                new n({
                    defaultView: "index",
                    viewRootPath: "views/",
                    animatSwitch: !1
                })
            })
        },
        app_h5_need_refresh: function() {
            require(["libs", "App"],
            function(e, t) {
                new t({
                    defaultView: "index",
                    viewRootPath: "views/",
                    animatSwitch: !1
                })
            })
        }
    };
    e && typeof t[e.tagname] == "function" && t[e.tagname](e.param)
}) : (require.config({
    baseUrl: "./",
    paths: {
        TourModel: "front/models/tourModel",
        TourStore: "front/models/tourStore",
        VaBaseView: "res/scripts/views/BaseView",
        views: "front/views",
        templates: "front/templates",
        CPageStore: "../cpage/models/cpagestore"
    },
    urlArgs: "v=" + window.TOUR_VER
}), require(["libs", "App"],
function(e, t) {
    new t({
        defaultView: "index",
        viewRootPath: "views/",
        animatSwitch: !1
    })
})),
define("main",
function() {});